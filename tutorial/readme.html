<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2022-01-17 Mon 09:03 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Django tutorial</title>
<meta name="generator" content="Org Mode" />
<style>
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
</style>
</head>
<body>
<div id="content" class="content">
<h1 class="title">Django tutorial</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org0f7eff8">1. Django tutorial Readme</a>
<ul>
<li><a href="#org89d856c">1.1. Introduction</a></li>
<li><a href="#org2b9618d">1.2. Pre-requisites</a></li>
<li><a href="#org513bb32">1.3. Virtual environment</a></li>
<li><a href="#org9e5c097">1.4. What we&rsquo;ll be doing</a></li>
</ul>
</li>
<li><a href="#org4dd32f5">2. Creating a project</a>
<ul>
<li><a href="#org582725e">2.1. Project layout</a></li>
<li><a href="#orgdc29110">2.2. App folder structure</a></li>
<li><a href="#orgc5b69a6">2.3. User model</a></li>
<li><a href="#orgbf2128f">2.4. Create a database</a></li>
</ul>
</li>
<li><a href="#org5138adb">3. First views and templates</a>
<ul>
<li><a href="#orgf34bf28">3.1. Article model</a></li>
<li><a href="#orgeea35ae">3.2. Django admin</a></li>
<li><a href="#org3cff654">3.3. Home view</a></li>
<li><a href="#org1e6dd7d">3.4. Templates folder</a></li>
<li><a href="#orgeb9cd03">3.5. Base template</a></li>
<li><a href="#org0bb2d8f">3.6. Home template</a></li>
<li><a href="#org886c0fc">3.7. Navbar</a></li>
</ul>
</li>
<li><a href="#org7329f39">4. Viewing articles</a>
<ul>
<li><a href="#orgaa352d4">4.1. Article view</a></li>
<li><a href="#org62138f5">4.2. Article template</a></li>
<li><a href="#org4bb5150">4.3. Slugs</a></li>
</ul>
</li>
<li><a href="#orgf12181b">5. Creating, editing, and deleting articles</a>
<ul>
<li><a href="#org3fd5558">5.1. Creating Articles</a></li>
<li><a href="#orgc80c338">5.2. Editing Articles</a></li>
<li><a href="#orgcd272af">5.3. Deleting Articles</a></li>
</ul>
</li>
<li><a href="#org567855c">6. Comments</a>
<ul>
<li><a href="#org0dcea7c">6.1. Model</a></li>
<li><a href="#org07669cb">6.2. Viewing comments</a></li>
<li><a href="#org3b8e1c8">6.3. Creating comments</a></li>
<li><a href="#orga1d9a52">6.4. Deleting comments</a></li>
</ul>
</li>
<li><a href="#org394336a">7. Users and Profiles</a>
<ul>
<li><a href="#org2758186">7.1. Introduction</a></li>
<li><a href="#org114f339">7.2. User model</a></li>
<li><a href="#orga280739">7.3. Profile model</a></li>
</ul>
</li>
<li><a href="#org7a4c364">8. Authentication</a>
<ul>
<li><a href="#orgeee1896">8.1. Auth views</a></li>
<li><a href="#org7818a9c">8.2. Auth urls</a></li>
<li><a href="#org4ded453">8.3. Auth templates</a></li>
</ul>
</li>
<li><a href="#org3a0f17d">9. Securing the app</a>
<ul>
<li><a href="#orgf027ee8">9.1. Nav</a></li>
<li><a href="#org0645c22">9.2. LoginRequiredMixin</a></li>
<li><a href="#org642d371">9.3. Only allow authors to edit or delete their articles and comments</a></li>
<li><a href="#orga48a01a">9.4. Testing signup and login</a></li>
</ul>
</li>
<li><a href="#org7f838de">10. Profile features</a>
<ul>
<li><a href="#org08be8ad">10.1. Viewing Profiles</a></li>
<li><a href="#orgb57ac3b">10.2. Viewing Articles written by each User</a></li>
<li><a href="#org22a5162">10.3. Links to Profiles in templates</a></li>
</ul>
</li>
<li><a href="#org6e57854">11. Editing profiles</a>
<ul>
<li><a href="#orgffb5659">11.1. Introduction</a></li>
<li><a href="#org2f7b110">11.2. Forms</a></li>
<li><a href="#orgb53a886">11.3. Views</a></li>
<li><a href="#orgdfad997">11.4. Templates</a></li>
</ul>
</li>
<li><a href="#orgc898d7f">12. Follows</a>
<ul>
<li><a href="#orga623f5d">12.1. Creating a few new users and articles</a></li>
<li><a href="#orgd3c1870">12.2. Model</a></li>
<li><a href="#orgd1c4a48">12.3. ProfileDetailView</a></li>
<li><a href="#org358f718">12.4. ArticleDetailView</a></li>
<li><a href="#org6625222">12.5. Redirect URL</a></li>
<li><a href="#org6e491c4">12.6. Feeds</a></li>
</ul>
</li>
<li><a href="#orgd54add1">13. Favourites</a>
<ul>
<li><a href="#orgcea6123">13.1. Model</a></li>
<li><a href="#org52f9b5d">13.2. ArticleFavoriteView</a></li>
<li><a href="#org301fa03">13.3. ArticleDetailView</a></li>
<li><a href="#orgbaec4bd">13.4. ArticlePreviewView</a></li>
<li><a href="#org77f29ed">13.5. Feeds</a></li>
</ul>
</li>
<li><a href="#org6fe587b">14. Tags</a>
<ul>
<li><a href="#orgfd2e22a">14.1. Model</a></li>
<li><a href="#org6ecff5d">14.2. Views</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-org0f7eff8" class="outline-2">
<h2 id="org0f7eff8"><span class="section-number-2">1.</span> Django tutorial Readme</h2>
<div class="outline-text-2" id="text-1">
</div>
<div id="outline-container-org89d856c" class="outline-3">
<h3 id="org89d856c"><span class="section-number-3">1.1.</span> Introduction</h3>
<div class="outline-text-3" id="text-1-1">
<p>
We&rsquo;ll build the <a href="https://github.com/gothinkster/django-realworld-example-app.git">Thinkster&rsquo;s Django RealWorld Example App</a> from the ground up, which you can see running at <a href="https://demo.realworld.io">https://demo.realworld.io</a>. The app is called Conduit and is a Medium clone.
</p>

<p>
Instead of only building the backend in Django, we&rsquo;ll do both frontend and backend, to show that SSR is still going strong.
</p>

<p>
We&rsquo;ll be following a simplified version of the <a href="https://github.com/cookiecutter/cookiecutter-django/">cookiecutter/cookiecutter-django</a> architecture (made famous by the excellent book <a href="https://www.feldroy.com/books/two-scoops-of-django-3-x">Two Scoops of Django 3.x</a>), but you don&rsquo;t need to have read it to follow.
</p>
</div>
</div>
<div id="outline-container-org2b9618d" class="outline-3">
<h3 id="org2b9618d"><span class="section-number-3">1.2.</span> Pre-requisites</h3>
<div class="outline-text-3" id="text-1-2">
<ul class="org-ul">
<li><p>
<a href="https://github.com/DjangoGirls/tutorial">DjangoGirls tutorial</a>
</p>

<p>
You should have followed the <a href="https://github.com/DjangoGirls/tutorial">DjangoGirls tutorial</a> before starting this one: it is excellent for getting you up to speed, and covers most of the introductory material you&rsquo;ll need, like HTML, CSS, and, of course, Django. We&rsquo;ll assume you have completed that tutorial and won&rsquo;t go into the specifics of anything that has already been covered there.
</p></li>
<li>Python 3.9</li>
<li>Django 3.2 (or higher)</li>
<li><a href="https://docs.conda.io/en/latest/miniconda.html">conda</a> or <a href="https://virtualenv.pypa.io/">virtualenv</a> for virtual environments</li>
<li>Optional
<ul class="org-ul">
<li><p>
<a href="https://github.com/git-guides/install-git">git</a>, to keep track of your work
</p>

<p>
We assume that you know the basics of git. You should <code>git commit</code> at the end of every chapter.
</p></li>

<li><a href="https://github.com/joke2k/faker">faker</a>, to avoid creating fake users, articles, etc. manually</li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-org513bb32" class="outline-3">
<h3 id="org513bb32"><span class="section-number-3">1.3.</span> Virtual environment</h3>
<div class="outline-text-3" id="text-1-3">
<p>
Let&rsquo;s start this tutorial in earnest.
</p>

<p>
Before doing anything else, we need to create our virtual environment.
</p>

<p>
We&rsquo;re working with <code>conda</code> (<a href="https://docs.conda.io/en/latest/miniconda.html">tutorial</a>), but you can work with <code>virtualenv</code> (<a href="https://realpython.com/python-virtual-environments-a-primer/">tutorial</a>).
</p>

<div class="org-src-container">
<pre class="src src-shell">conda create --name django
conda activate django
conda install django
</pre>
</div>

<p>
Now, you have a virtual environment with <code>django</code> installed.
</p>
</div>
</div>
<div id="outline-container-org9e5c097" class="outline-3">
<h3 id="org9e5c097"><span class="section-number-3">1.4.</span> What we&rsquo;ll be doing</h3>
<div class="outline-text-3" id="text-1-4">
<p>
First, we&rsquo;ll decide on a project and folder structure, to keep the project&rsquo;s complexity in check. We will then do the groundwork required by Django before we can get our app running online.
</p>

<p>
We&rsquo;ll then dive into the tutorial proper: we&rsquo;ll  make models,
</p>
</div>
</div>
</div>
<div id="outline-container-org4dd32f5" class="outline-2">
<h2 id="org4dd32f5"><span class="section-number-2">2.</span> Creating a project</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-org582725e" class="outline-3">
<h3 id="org582725e"><span class="section-number-3">2.1.</span> Project layout</h3>
<div class="outline-text-3" id="text-2-1">
<p>
We&rsquo;ll be following the folder structure presented as best practice in <a href="https://www.feldroy.com/books/two-scoops-of-django-3-x">Two Scoops of Django</a> by Daniel and Audrey Feldroy, which will yield something like the following:
</p>

<pre class="example">
folder_name
├── config/
│   ├── __init__.py
│   ├── asgi.py
│   ├── settings/
│   ├── urls.py
│   └── wsgi.py
├── project_name/
│   ├── app_1/
│   ├── app_2/
│   ├── static/
│   └── templates/
├── .gitignore
├── manage.py
└── db.sqlite3
</pre>

<p>
Let&rsquo;s create a folder for our project: we&rsquo;ll name it <code>django_tutorial</code>.
</p>

<div class="org-src-container">
<pre class="src src-shell">(django) ~$ mkdir conduit
</pre>
</div>

<p>
We now create our project, <code>conduit</code>:
</p>
<div class="org-src-container">
<pre class="src src-shell">(django) ~$ cd conduit
(django) django_tutorial$ django-admin startproject conduit .
</pre>
</div>

<p>
Our folder structure should look like this at this point:
</p>

<pre class="example">
django_tutorial
├── conduit
│   ├── asgi.py
│   ├── __init__.py
│   ├── settings.py
│   ├── urls.py
│   └── wsgi.py
├── db.sqlite3
└── manage.py
</pre>

<p>
We&rsquo;ll move all the files in the <code>conduit</code> folder into the <code>django_tutorial/config</code> folder, as we explained above. The project layout should now be:
</p>

<pre class="example">
.
├── conduit
│── config
│   ├── asgi.py
│   ├── __init__.py
│   ├── settings.py
│   ├── urls.py
│   └── wsgi.py
└── manage.py
</pre>

<p>
Because we&rsquo;re deviating from Django&rsquo;s generic project layout, we&rsquo;ll have to update some lines.
</p>

<p>
You might wonder why we have to fiddle with the settings before even starting to code, but this small effort has the benefit of making the structure of our project easier to understand and of separating the config from the code, which is a good rule of thumb.
</p>

<p>
In <code>asgi.py</code> and <code>wsgi.py</code>:
</p>

<div class="org-src-container">
<pre class="src src-python">os.environ.setdefault(<span style="color: #008000;">"DJANGO_SETTINGS_MODULE"</span>, <span style="color: #008000;">"config.settings"</span>)
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">from os.environ.setdefault("DJANGO_SETTINGS_MODULE", "conduit.settings")</span>
</pre>
</div>

<p>
In <code>settings.py</code>:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #BA36A5;">ROOT_URLCONF</span> = <span style="color: #008000;">"config.urls"</span>
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">from ROOT_URLCONF = "conduit.urls"</span>

<span style="color: #BA36A5;">WSGI_APPLICATION</span> = <span style="color: #008000;">"config.wsgi.application"</span>
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">from WSGI_APPLICATION = "conduit.wsgi.application"</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgdc29110" class="outline-3">
<h3 id="orgdc29110"><span class="section-number-3">2.2.</span> App folder structure</h3>
<div class="outline-text-3" id="text-2-2">
<p>
Our app will have a lot of moving parts (articles, profiles, tags, etc.). To keep the structure of our app clear, we&rsquo;ll host the logic for each of these parts in separate folders.
</p>

<p>
We&rsquo;ll build Conduit step by step.
The most basic function that the app should have is the ability to post and read articles. Let&rsquo;s start with that (you&rsquo;ll notice that this part is basically a repeat of Django Girls tutorial&rsquo;s blog app).
</p>

<div class="org-src-container">
<pre class="src src-shell">(django) django_tutorial$ cd conduit
(django) conduit$ django-admin startapp articles
(django) conduit$ cd articles
</pre>
</div>

<p>
Our folder structure now looks like this:
</p>

<div class="org-src-container">
<pre class="src src-shell">django_tutorial
&#9500;&#9472;&#9472; conduit
&#9474;   &#9500;&#9472;&#9472; articles
&#9474;   &#9474;   &#9500;&#9472;&#9472; admin.py
&#9474;   &#9474;   &#9500;&#9472;&#9472; apps.py
&#9474;   &#9474;   &#9500;&#9472;&#9472; __init__.py
&#9474;   &#9474;   &#9500;&#9472;&#9472; migrations
&#9474;   &#9474;   &#9474;   &#9492;&#9472;&#9472; __init__.py
&#9474;   &#9474;   &#9500;&#9472;&#9472; models.py
&#9474;   &#9474;   &#9500;&#9472;&#9472; tests.py
&#9474;   &#9474;   &#9492;&#9472;&#9472; views.py
&#9500;&#9472;&#9472; config
&#9474;   &#9500;&#9472;&#9472; asgi.py
&#9474;   &#9500;&#9472;&#9472; __init__.py
&#9474;   &#9500;&#9472;&#9472; settings.py
&#9474;   &#9500;&#9472;&#9472; urls.py
&#9474;   &#9492;&#9472;&#9472; wsgi.py
&#9500;&#9472;&#9472; db.sqlite3
&#9492;&#9472;&#9472; manage.py
</pre>
</div>

<p>
We change the <code>name</code> line in the file <code>apps.py</code> in the <code>articles</code> folder:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #0000FF;">from</span> django.apps <span style="color: #0000FF;">import</span> AppConfig


<span style="color: #0000FF;">class</span> <span style="color: #6434A3;">ArticlesConfig</span>(AppConfig):
    <span style="color: #BA36A5;">default_auto_field</span> = <span style="color: #008000;">'django.db.models.BigAutoField'</span>
    <span style="color: #BA36A5;">name</span> = <span style="color: #008000;">'conduit.articles'</span>
</pre>
</div>

<p>
We also add the line <code>'conduit.articles',</code> to INSTALLED_APPS in <code>settings.py</code>:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #BA36A5;">INSTALLED_APPS</span> = [
    <span style="color: #008000;">'django.contrib.admin'</span>,
    <span style="color: #008000;">'django.contrib.auth'</span>,
    <span style="color: #008000;">'django.contrib.contenttypes'</span>,
    <span style="color: #008000;">'django.contrib.sessions'</span>,
    <span style="color: #008000;">'django.contrib.messages'</span>,
    <span style="color: #008000;">'django.contrib.staticfiles'</span>,

    <span style="color: #008000;">'conduit.articles'</span>, <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">add this line</span>
]
</pre>
</div>
</div>
</div>
<div id="outline-container-orgc5b69a6" class="outline-3">
<h3 id="orgc5b69a6"><span class="section-number-3">2.3.</span> User model</h3>
<div class="outline-text-3" id="text-2-3">
<p>
<a href="https://docs.djangoproject.com/en/3.0/topics/auth/customizing/#substituting-a-custom-user-model">The Django docs warn you</a>: &ldquo;<i>If you&rsquo;re starting a new project, it&rsquo;s highly recommended to set up a custom user model, even if the default User model is sufficient for you. [&#x2026;] Changing AUTH_USER_MODEL after you&rsquo;ve created database tables is significantly more difficult [&#x2026;]. This change can&rsquo;t be done automatically and requires manually fixing your schema, moving your data from the old user table, and possibly manually reapplying some migrations.</i>&rdquo;. Scary stuff. Let&rsquo;s just follow the advice.
</p>

<p>
First, we need to create the app where we&rsquo;ll do everything that has to do with users.
</p>

<div class="org-src-container">
<pre class="src src-shell">(django) conduit$ django-admin startapp users
</pre>
</div>

<p>
We then change the <code>name</code> line in the file <code>apps.py</code> in the <code>articles</code> folder:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #0000FF;">from</span> django.apps <span style="color: #0000FF;">import</span> AppConfig


<span style="color: #0000FF;">class</span> <span style="color: #6434A3;">UsersConfig</span>(AppConfig):
    <span style="color: #BA36A5;">default_auto_field</span> = <span style="color: #008000;">'django.db.models.BigAutoField'</span>
    <span style="color: #BA36A5;">name</span> = <span style="color: #008000;">'conduit.users'</span>
</pre>
</div>

<p>
Now, in <code>users/models.py</code>, add the following:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #0000FF;">from</span> django.contrib.auth.models <span style="color: #0000FF;">import</span> AbstractUser
<span style="color: #0000FF;">from</span> django.db <span style="color: #0000FF;">import</span> models


<span style="color: #0000FF;">class</span> <span style="color: #6434A3;">User</span>(AbstractUser):
    <span style="color: #036A07;">"""User model"""</span>

    <span style="color: #0000FF;">pass</span>
</pre>
</div>

<p>
What we&rsquo;re doing here is take the <code>AbstractUser</code> model and save it as is. This way, we can add any modifications we need later on.
</p>

<p>
In <code>users/models.py</code> we also need to create a <code>Profile</code> model: we&rsquo;ll explain it in more detail later, but suffice it to say that the <code>Profile</code> will deal with the everything about our users that is not authentication (logging in and out).
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #0000FF;">class</span> <span style="color: #6434A3;">Profile</span>(models.Model):
    <span style="color: #036A07;">"""Profile model"""</span>

    <span style="color: #BA36A5;">user</span> = models.OneToOneField(User)
</pre>
</div>

<p>
Now, create a superuser in the terminal, so as to be able to access Django&rsquo;s admin app later on:
</p>

<div class="org-src-container">
<pre class="src src-shell">(django) django_tutorial$ python manage.py createsuperuser
</pre>
</div>

<p>
And one last dark magic trick that you just need to do without asking why (detailed explanations will be provided in a later section, promise): in your terminal, in the <code>django_tutorial</code> folder, run the following commands:
</p>

<pre class="example">
(django) django_tutorial$ python manage.py shell
</pre>

<p>
And once you&rsquo;re in the IPython shell:
</p>

<div class="org-src-container">
<pre class="src src-python">Python <span style="color: #D0372D;">3.9</span>.<span style="color: #D0372D;">7</span> | packaged by conda-forge | (default, Sep <span style="color: #D0372D;">29</span> <span style="color: #D0372D;">2021</span>, <span style="color: #D0372D;">19</span>:<span style="color: #D0372D;">20</span>:<span style="color: #D0372D;">46</span>)
Type <span style="color: #008000;">'copyright'</span>, <span style="color: #008000;">'credits'</span> <span style="color: #0000FF;">or</span> <span style="color: #008000;">'license'</span> <span style="color: #0000FF;">for</span> more information
IPython <span style="color: #D0372D;">7.30</span>.<span style="color: #D0372D;">1</span> -- An enhanced Interactive Python. Type <span style="color: #008000;">'?'</span> <span style="color: #0000FF;">for</span> <span style="color: #006FE0;">help</span>.

In [<span style="color: #D0372D;">1</span>]: <span style="color: #0000FF;">from</span> conduit.users.models <span style="color: #0000FF;">import</span> User, Profile

In [<span style="color: #D0372D;">2</span>]: <span style="color: #BA36A5;">user</span> = User.objects.get(username=<span style="color: #008000;">'admin'</span>)

In [<span style="color: #D0372D;">3</span>]: <span style="color: #BA36A5;">user.profile</span> = Profile.objects.create(user=user)
</pre>
</div>

<p>
Finally, we need to tell Django that we&rsquo;re not using the default User model. In <code>settings.py</code>, add your <code>users</code> app to <code>INSTALLED_APPS</code> and point <code>AUTH_USER_MODEL</code> to it:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">other settings</span>

<span style="color: #BA36A5;">INSTALLED_APPS</span> = [
    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">other apps</span>
    <span style="color: #008000;">'conduit.users'</span>                  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">new</span>
]

<span style="color: #BA36A5;">AUTH_USER_MODEL</span> = <span style="color: #008000;">'users.User'</span>    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">new</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgbf2128f" class="outline-3">
<h3 id="orgbf2128f"><span class="section-number-3">2.4.</span> Create a database</h3>
<div class="outline-text-3" id="text-2-4">
<p>
Make the migrations and start the server:
</p>

<div class="org-src-container">
<pre class="src src-shell">(django) django_tutorial$ python manage.py makemigrations
(django) django_tutorial$ python manage.py migrate
(django) django_tutorial$ python manage.py runserver
</pre>
</div>

<p>
Our app, Conduit, is online!
</p>
</div>
</div>
</div>
<div id="outline-container-org5138adb" class="outline-2">
<h2 id="org5138adb"><span class="section-number-2">3.</span> First views and templates</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-orgf34bf28" class="outline-3">
<h3 id="orgf34bf28"><span class="section-number-3">3.1.</span> Article model</h3>
<div class="outline-text-3" id="text-3-1">
<p>
We&rsquo;ll start by making a model for our articles.
The articles need a title, a body (the text), a description, an author, and a creation date.
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #0000FF;">from</span> django.db <span style="color: #0000FF;">import</span> models


<span style="color: #0000FF;">class</span> <span style="color: #6434A3;">Article</span>(models.Model):
    <span style="color: #BA36A5;">title</span> = models.CharField(db_index=<span style="color: #D0372D;">True</span>, max_length=<span style="color: #D0372D;">255</span>)
    <span style="color: #BA36A5;">description</span> = models.TextField(max_length=<span style="color: #D0372D;">2000</span>)
    <span style="color: #BA36A5;">body</span> = models.TextField()
    <span style="color: #BA36A5;">author</span> = models.ForeignKey(
        <span style="color: #008000;">"users.Profile"</span>,
        on_delete=models.CASCADE,
        related_name=<span style="color: #008000;">"articles"</span>,
    )
    <span style="color: #BA36A5;">created_at</span> = models.DateTimeField(auto_now_add=<span style="color: #D0372D;">True</span>)

    <span style="color: #0000FF;">def</span> <span style="color: #006699;">__str__</span>(<span style="color: #0000FF;">self</span>):
        <span style="color: #0000FF;">return</span> <span style="color: #0000FF;">self</span>.title

    <span style="color: #0000FF;">def</span> <span style="color: #006699;">get_absolute_url</span>(<span style="color: #0000FF;">self</span>):
        <span style="color: #0000FF;">return</span> reverse(<span style="color: #008000;">"article_detail"</span>, kwargs={<span style="color: #008000;">"pk"</span>: <span style="color: #0000FF;">self</span>.pk})
</pre>
</div>

<p>
The <code>ForeignKey</code> allows us to have multiple articles for every user.
<code>on_delete=models.CASCADE</code> means that the article will be deleted if the user is deleted.
<code>related_name="articles"</code> allows us to access a user&rsquo;s articles through an <code>articles</code> attribute.
</p>

<p>
Let&rsquo;s sync the database again:
</p>

<div class="org-src-container">
<pre class="src src-shell">(django) django_tutorial$ python manage.py makemigrations
(django) django_tutorial$ python manage.py migrate
</pre>
</div>
</div>
</div>
<div id="outline-container-orgeea35ae" class="outline-3">
<h3 id="orgeea35ae"><span class="section-number-3">3.2.</span> Django admin</h3>
<div class="outline-text-3" id="text-3-2">
<p>
In order to have something to work with for the rest of the tutorial, we need to create some posts. Because we can&rsquo;t yet do it through Conduit, we will do so through Django admin.
</p>

<p>
First, register the <code>Article</code> model in <code>articles/admin.py</code> by adding the following line:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #0000FF;">from</span> django.contrib <span style="color: #0000FF;">import</span> admin
<span style="color: #0000FF;">from</span> .models <span style="color: #0000FF;">import</span> Article

admin.site.register(Article)            <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">new</span>
</pre>
</div>

<p>
The server should still be running (otherwise restart it). Log in as the superuser you just created and create 3 articles.
</p>
</div>
</div>
<div id="outline-container-org3cff654" class="outline-3">
<h3 id="org3cff654"><span class="section-number-3">3.3.</span> Home view</h3>
<div class="outline-text-3" id="text-3-3">
<p>
The default view that the unauthenticated user has is the global feed, or the list of all articles.
</p>

<p>
We add the following line in <code>django_tutorial/conduit/urls.py</code>, so that the project-level <code>urls.py</code> is aware of the urls defined in <code>articles/urls.py</code>:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #0000FF;">from</span> django.contrib <span style="color: #0000FF;">import</span> admin
<span style="color: #0000FF;">from</span> django.urls <span style="color: #0000FF;">import</span> path, include

<span style="color: #BA36A5;">urlpatterns</span> = [
    path(<span style="color: #008000;">'admin/'</span>, admin.site.urls),
    path(<span style="color: #008000;">''</span>, include(<span style="color: #008000;">'conduit.articles.urls'</span>)),                         <span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">new</span>
]
</pre>
</div>

<p>
Let&rsquo;s create a <code>urls.py</code> file in the <code>articles</code> folder, and add the following:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #0000FF;">from</span> django.urls <span style="color: #0000FF;">import</span> path
<span style="color: #0000FF;">from</span> . <span style="color: #0000FF;">import</span> views

<span style="color: #BA36A5;">urlpatterns</span> = [path(<span style="color: #008000;">""</span>, Home.as_view(), name=<span style="color: #008000;">"home"</span>)]
</pre>
</div>

<p>
In <code>views.py</code>, we add the following:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #0000FF;">from</span> .models <span style="color: #0000FF;">import</span> Article


<span style="color: #0000FF;">class</span> <span style="color: #6434A3;">Home</span>(TemplateView):
    <span style="color: #036A07;">"""all published articles"""</span>

    <span style="color: #BA36A5;">template_name</span> = <span style="color: #008000;">"home.html"</span>

    <span style="color: #0000FF;">def</span> <span style="color: #006699;">get_context_data</span>(<span style="color: #0000FF;">self</span>, **kwargs):
        <span style="color: #BA36A5;">context</span> = <span style="color: #006FE0;">super</span>().get_context_data(**kwargs)
        <span style="color: #BA36A5;">context</span>[<span style="color: #008000;">"articles"</span>] = Article.objects.order_by(<span style="color: #008000;">"-created_at"</span>)
        <span style="color: #0000FF;">return</span> context
</pre>
</div>
</div>
</div>
<div id="outline-container-org1e6dd7d" class="outline-3">
<h3 id="org1e6dd7d"><span class="section-number-3">3.4.</span> Templates folder</h3>
<div class="outline-text-3" id="text-3-4">
<p>
We need a template now, but before this we need to create a folder for templates and for static files (icons, CSS, etc.).
</p>

<p>
It&rsquo;s easier to have all templates in one place, instead of in each separate app, and the same is true for static files. Let&rsquo;s create the <code>templates</code> and <code>static</code> folders:
</p>

<div class="org-src-container">
<pre class="src src-shell">(django) conduit$ mkdir templates
(django) conduit$ mkdir static
</pre>
</div>

<p>
We need to modify <code>settings.py</code> so Django is aware of our project&rsquo;s architecture.
Let&rsquo;s define the APPS_DIR below BASE_DIR first:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #BA36A5;">BASE_DIR</span> = Path(__file__).resolve().parent.parent
<span style="color: #BA36A5;">APPS_DIR</span> = BASE_DIR / <span style="color: #008000;">"conduit"</span>
</pre>
</div>

<p>
Let&rsquo;s change the <code>DIRS</code> line in the <code>TEMPLATES</code> section in <code>settings.py</code> like this:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #036A07;">"DIRS"</span>: [APPS_DIR / <span style="color: #036A07;">"templates"</span>], <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">changed from "DIRS": []</span>
</pre>
</div>

<p>
Similarly, let&rsquo;s define the <code>STATIC_ROOT</code> directory below the <code>STATIC</code> line like this:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #BA36A5;">STATIC_URL</span> = <span style="color: #008000;">"/static/"</span>
<span style="color: #BA36A5;">STATIC_ROOT</span> = BASE_DIR / <span style="color: #008000;">"staticfiles"</span>
<span style="color: #BA36A5;">STATICFILES_DIRS</span> = [APPS_DIR / <span style="color: #008000;">"static"</span>]
</pre>
</div>
</div>
</div>
<div id="outline-container-orgeb9cd03" class="outline-3">
<h3 id="orgeb9cd03"><span class="section-number-3">3.5.</span> Base template</h3>
<div class="outline-text-3" id="text-3-5">
<p>
Let&rsquo;s create the base template now.
</p>

<div class="org-src-container">
<pre class="src src-shell">(django) conduit$ touch templates/base.html
</pre>
</div>

<p>
This template will contain the following:
</p>

<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #0000FF;">!doctype</span> html&gt;
{% load static %}
&lt;<span style="color: #006699;">html</span> <span style="color: #BA36A5;">lang</span>=<span style="color: #008000;">"en"</span>&gt;
    &lt;<span style="color: #006699;">head</span>&gt;
        &lt;<span style="color: #006699;">meta</span> <span style="color: #BA36A5;">charset</span>=<span style="color: #008000;">"utf-8"</span>&gt;
        &lt;<span style="color: #006699;">link</span> <span style="color: #BA36A5;">rel</span>=<span style="color: #008000;">"icon"</span> <span style="color: #BA36A5;">href</span>=<span style="color: #008000;">"{%  static '/icons/favicon.ico' %}"</span>&gt;
        &lt;<span style="color: #006699;">meta</span> <span style="color: #BA36A5;">name</span>=<span style="color: #008000;">"viewport"</span> <span style="color: #BA36A5;">content</span>=<span style="color: #008000;">"width=device-width, initial-scale=1"</span>&gt;
        <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">favicon </span><span style="color: #8D8D84;">--&gt;</span>
        <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">Thinkster's CSS </span><span style="color: #8D8D84;">--&gt;</span>
        &lt;<span style="color: #006699;">link</span> <span style="color: #BA36A5;">rel</span>=<span style="color: #008000;">"stylesheet"</span> <span style="color: #BA36A5;">href</span>=<span style="color: #008000;">"//demo.productionready.io/main.css"</span>&gt;
        <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">icons for later </span><span style="color: #8D8D84;">--&gt;</span>
        &lt;<span style="color: #006699;">link</span> <span style="color: #BA36A5;">href</span>=<span style="color: #008000;">"//code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css"</span> <span style="color: #BA36A5;">rel</span>=<span style="color: #008000;">"stylesheet"</span> <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"text/css"</span>&gt;
        <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">fonts </span><span style="color: #8D8D84;">--&gt;</span>
        &lt;<span style="color: #006699;">link</span> <span style="color: #BA36A5;">href</span>=<span style="color: #008000;">"//fonts.googleapis.com/css?family=Titillium+Web:700|Source+Serif+Pro:400,700|Merriweather+Sans:400,700|Source+Sans+Pro:400,300,600,700,300italic,400italic,600italic,700italic&amp;display=swap"</span> <span style="color: #BA36A5;">rel</span>=<span style="color: #008000;">"stylesheet"</span> <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"text/css"</span>&gt;
        {% block title %}
            &lt;<span style="color: #006699;">title</span>&gt;<span style="color: #000000; font-weight: bold; text-decoration: underline;">Conduit: Django + HTMX</span>&lt;/<span style="color: #006699;">title</span>&gt;
        {% endblock %}
    &lt;/<span style="color: #006699;">head</span>&gt;
    &lt;<span style="color: #006699;">body</span>&gt;
        &lt;<span style="color: #006699;">main</span>&gt;
            {% block content %}
            {% endblock %}
        &lt;/<span style="color: #006699;">main</span>&gt;
    &lt;/<span style="color: #006699;">body</span>&gt;
&lt;/<span style="color: #006699;">html</span>&gt;
</pre>
</div>

<p>
We&rsquo;ll also download the favicon referenced in our template: download the file located at the URL below to <code>conduit/articles/static/icons/favicon.ico</code>:
<a href="https://github.com/gothinkster/react-redux-realworld-example-app/blob/master/public/favicon.ico">https://github.com/gothinkster/react-redux-realworld-example-app/blob/master/public/favicon.ico</a>
</p>
</div>
</div>
<div id="outline-container-org0bb2d8f" class="outline-3">
<h3 id="org0bb2d8f"><span class="section-number-3">3.6.</span> Home template</h3>
<div class="outline-text-3" id="text-3-6">
<p>
Now we&rsquo;ll make the <code>home.html</code> template, which for now only needs to display our &ldquo;global feed&rdquo;.
</p>

<p>
Let&rsquo;s create the template  and add the following to it:
</p>

<div class="org-src-container">
<pre class="src src-html">{% extends 'base.html' %}
{% block content %}
  &lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"home-page"</span>&gt;
    &lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"banner"</span>&gt;
      &lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"container"</span>&gt;
        &lt;<span style="color: #006699;">h1</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"logo-font"</span>&gt;<span style="color: #000000; font-weight: bold; text-decoration: underline;">conduit</span>&lt;/<span style="color: #006699;">h1</span>&gt;
        &lt;<span style="color: #006699;">p</span>&gt;A place to share your knowledge.&lt;/<span style="color: #006699;">p</span>&gt;
      &lt;/<span style="color: #006699;">div</span>&gt;
    &lt;/<span style="color: #006699;">div</span>&gt;
    &lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"container page"</span>&gt;
      &lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"row"</span>&gt;
        &lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"col-md-9"</span>&gt;
          {% if articles|length_is:"0" %}
            &lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"article-preview"</span>&gt;
              No articles are here... yet.
            &lt;/<span style="color: #006699;">div</span>&gt;
          {% else %}
            &lt;<span style="color: #006699;">div</span>&gt;
              {% for article in articles %}
                &lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"article-preview"</span>&gt;
                  &lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"article-meta"</span>&gt;
                    &lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"info"</span>&gt;
                      &lt;<span style="color: #006699;">span</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"author"</span>&gt;
                        {{ article.author.user.username }}
                      &lt;/<span style="color: #006699;">span</span>&gt;
                      &lt;<span style="color: #006699;">span</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"date"</span>&gt;
                        {{ article.created_at|date:"D M d Y" }}
                      &lt;/<span style="color: #006699;">span</span>&gt;
                    &lt;/<span style="color: #006699;">div</span>&gt;
                  &lt;/<span style="color: #006699;">div</span>&gt;
                  &lt;<span style="color: #006699;">a</span> <span style="color: #BA36A5;">href</span>=<span style="color: #008000;">"{{ article.get_absolute_url }}"</span> <span style="color: #BA36A5;">rel</span>=<span style="color: #008000;">"prefetch"</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"preview-link"</span>&gt;
                    &lt;<span style="color: #006699;">h1</span>&gt;<span style="color: #000000; font-weight: bold; text-decoration: underline;">{{ article.title }}</span>&lt;/<span style="color: #006699;">h1</span>&gt;
                    &lt;<span style="color: #006699;">p</span>&gt;{{ article.description }}&lt;/<span style="color: #006699;">p</span>&gt;
                    &lt;<span style="color: #006699;">span</span>&gt;Read more...&lt;/<span style="color: #006699;">span</span>&gt;
                  &lt;/<span style="color: #006699;">a</span>&gt;
                &lt;/<span style="color: #006699;">div</span>&gt;
              {% endfor %}
            &lt;/<span style="color: #006699;">div</span>&gt;
          {% endif %}
        &lt;/<span style="color: #006699;">div</span>&gt;
      &lt;/<span style="color: #006699;">div</span>&gt;
    &lt;/<span style="color: #006699;">div</span>&gt;
  &lt;/<span style="color: #006699;">div</span>&gt;
{% endblock %}
</pre>
</div>

<p>
The HTML is adapted from other realworld projects (especially the <a href="https://github.com/sveltejs/realworld/">SvelteKit implementation of the RealWorld app</a>, because Svelte is unexpectedly close to Django&rsquo;s templating language).
Because the HTML is little more than a copy-paste, we won&rsquo;t explain its structure and classes: suffice it to say that this is required to have something that looks like the actual Realworld app.
</p>


<div id="org67d6d69" class="figure">
<p><img src="./assets/home - global feed.png" alt="home - global feed.png" width="600" />
</p>
<p><span class="figure-number">Figure 1: </span>home - global feed in our app</p>
</div>


<div id="org1a65e11" class="figure">
<p><img src="./assets/home - global feed - realworld.png" alt="home - global feed - realworld.png" width="600" />
</p>
<p><span class="figure-number">Figure 2: </span>home - global feed in the canonical RealWorld app</p>
</div>

<p>
It&rsquo;s starting to look like something, but we can improve the template a bit.
</p>

<p>
We want to keep our templates as modular as possible, to simplify the structure of our project and make it easier to think about. In this case, we could move the <code>&lt;div class="article-preview"&gt;</code> to a separate file. Let&rsquo;s move all the code in the <code>{% for article in articles %}</code> for loop into the file <code>article_preview.html</code> (which we need to create).
</p>

<p>
In <code>templates/home.html</code>, we change the following lines:
</p>

<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"container page"</span>&gt;
  &lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"row"</span>&gt;
    &lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"col-md-9"</span>&gt;
      {% include 'article_list.html' %}  <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">from {% if articles|length%}...{% end%} </span><span style="color: #8D8D84;">--&gt;</span>
    &lt;/<span style="color: #006699;">div</span>&gt;
  &lt;/<span style="color: #006699;">div</span>&gt;
&lt;/<span style="color: #006699;">div</span>&gt;
</pre>
</div>

<p>
Our <code>templates/article_list.html</code> file should look like this:
</p>

<div class="org-src-container">
<pre class="src src-html">{% block content %}
  {% if articles|length_is:"0" %}
    &lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"article-preview"</span>&gt;
      No articles are here... yet.
    &lt;/<span style="color: #006699;">div</span>&gt;
  {% else %}
    &lt;<span style="color: #006699;">div</span>&gt;
      {% for article in articles %}
        {% include 'article_preview.html' %} <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">from &lt;div class="article-preview"&gt;...&lt;/div&gt;</span><span style="color: #8D8D84;">--&gt;</span>
      {% endfor %}
    &lt;/<span style="color: #006699;">div</span>&gt;
  {% endif %}
{% endblock %}
</pre>
</div>

<p>
The <code>templates/article_preview.html</code> file should look like this:
</p>

<div class="org-src-container">
<pre class="src src-html">{% block content %}
  &lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"article-preview"</span>&gt;
    &lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"article-meta"</span>&gt;
      &lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"info"</span>&gt;
        &lt;<span style="color: #006699;">span</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"author"</span>&gt;
          {{ article.author.user.username }}
        &lt;/<span style="color: #006699;">span</span>&gt;
        &lt;<span style="color: #006699;">span</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"date"</span>&gt;
          {{ article.created_at|date:"D M d Y" }}
        &lt;/<span style="color: #006699;">span</span>&gt;
      &lt;/<span style="color: #006699;">div</span>&gt;
    &lt;/<span style="color: #006699;">div</span>&gt;
    &lt;<span style="color: #006699;">a</span> <span style="color: #BA36A5;">href</span>=<span style="color: #008000;">"{{ article.get_absolute_url }}"</span> <span style="color: #BA36A5;">rel</span>=<span style="color: #008000;">"prefetch"</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"preview-link"</span>&gt;
      &lt;<span style="color: #006699;">h1</span>&gt;<span style="color: #000000; font-weight: bold; text-decoration: underline;">{{ article.title }}</span>&lt;/<span style="color: #006699;">h1</span>&gt;
      &lt;<span style="color: #006699;">p</span>&gt;{{ article.description }}&lt;/<span style="color: #006699;">p</span>&gt;
      &lt;<span style="color: #006699;">span</span>&gt;Read more...&lt;/<span style="color: #006699;">span</span>&gt;
    &lt;/<span style="color: #006699;">a</span>&gt;
  &lt;/<span style="color: #006699;">div</span>&gt;
{% endblock %}
</pre>
</div>

<p>
You might wonder why we&rsquo;re adopting this template structure: it actually comes from the Svelte implementation of the RealWorld app, and, since it makes a lot of sense and avoids us having to reinvent the wheel, we are taking advantage of it.
</p>
</div>
</div>
<div id="outline-container-org886c0fc" class="outline-3">
<h3 id="org886c0fc"><span class="section-number-3">3.7.</span> Navbar</h3>
<div class="outline-text-3" id="text-3-7">
<p>
Let&rsquo;s create a simple navigation bar. Because we have yet to implement authentication and profiles, the navbar will just contain a link to <code>Home</code>.
</p>

<p>
Let&rsquo;s add the following lines to <code>base.html</code>:
</p>

<div class="org-src-container">
<pre class="src src-html">    &lt;<span style="color: #006699;">body</span>&gt;
        {% include 'nav.html' %}            <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">new </span><span style="color: #8D8D84;">--&gt;</span>
        &lt;<span style="color: #006699;">main</span>&gt;
            {% block content %}
            {% endblock %}
        &lt;/<span style="color: #006699;">main</span>&gt;
</pre>
</div>

<p>
Let&rsquo;s create <code>nav.html</code> in our <code>templates</code> folder and add the following to it:
</p>

<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #006699;">nav</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"navbar navbar-light"</span>&gt;
  &lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"container"</span>&gt;
    &lt;<span style="color: #006699;">a</span> <span style="color: #BA36A5;">rel</span>=<span style="color: #008000;">"prefetch"</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"navbar-brand"</span> <span style="color: #BA36A5;">href</span>=<span style="color: #008000;">"/"</span>&gt;conduit&lt;/<span style="color: #006699;">a</span>&gt;
    &lt;<span style="color: #006699;">ul</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"nav navbar-nav pull-xs-right"</span>&gt;
      &lt;<span style="color: #006699;">li</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"nav-item"</span>&gt;
        &lt;<span style="color: #006699;">a</span>
          <span style="color: #BA36A5;">href</span>=<span style="color: #008000;">"{% url 'home' %}"</span>
          <span style="color: #BA36A5;">rel</span>=<span style="color: #008000;">"prefetch"</span>
          <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"nav-link"</span>
        &gt;
          Home
        &lt;/<span style="color: #006699;">a</span>&gt;
      &lt;/<span style="color: #006699;">li</span>&gt;
    &lt;/<span style="color: #006699;">ul</span>&gt;
  &lt;/<span style="color: #006699;">div</span>&gt;
&lt;/<span style="color: #006699;">nav</span>&gt;
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org7329f39" class="outline-2">
<h2 id="org7329f39"><span class="section-number-2">4.</span> Viewing articles</h2>
<div class="outline-text-2" id="text-4">
</div>
<div id="outline-container-orgaa352d4" class="outline-3">
<h3 id="orgaa352d4"><span class="section-number-3">4.1.</span> Article view</h3>
<div class="outline-text-3" id="text-4-1">
<p>
Next we&rsquo;ll implement the article view.
</p>

<p>
We&rsquo;ll be working with Class-Based Views: the <i>Django Girls</i> tutorial only presents Function-Based Views, which are arguably a more intuitive option, but CBVs are considered to be best practice, at least according to <i>Two Scoops of Django</i>, and simplify a lot of work.
</p>

<p>
First, we create a view in <code>views.py</code>:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #0000FF;">from</span> django.views.generic <span style="color: #0000FF;">import</span> TemplateView, DetailView


<span style="color: #0000FF;">class</span> <span style="color: #6434A3;">ArticleDetailView</span>(DetailView):
    <span style="color: #036A07;">"""detail view for individual articles"""</span>

    <span style="color: #BA36A5;">model</span> = Article
    <span style="color: #BA36A5;">template_name</span> = <span style="color: #008000;">"article_detail.html"</span>
</pre>
</div>

<p>
Then, we modify the <code>articles/urls.py</code> file:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #0000FF;">from</span> .views <span style="color: #0000FF;">import</span> Home, ArticleDetailView

<span style="color: #BA36A5;">urlpatterns</span> = [
    path(<span style="color: #008000;">""</span>, Home.as_view(), name=<span style="color: #008000;">"home"</span>),
    path(<span style="color: #008000;">"article/&lt;int:pk&gt;"</span>, ArticleDetailView.as_view(), name=<span style="color: #008000;">"article_detail"</span>),
]
</pre>
</div>
</div>
</div>
<div id="outline-container-org62138f5" class="outline-3">
<h3 id="org62138f5"><span class="section-number-3">4.2.</span> Article template</h3>
<div class="outline-text-3" id="text-4-2">
<p>
Now, we create the <code>article_detail.html</code> file in our <code>templates</code> folder and add the following to it:
</p>

<div class="org-src-container">
<pre class="src src-html">{% extends 'base.html' %}
{% block title %}
    &lt;<span style="color: #006699;">title</span>&gt;<span style="color: #000000; font-weight: bold; text-decoration: underline;">{{ article.title }} - Conduit: Django + HTMX</span>&lt;/<span style="color: #006699;">title</span>&gt;
{% endblock %}
{% block content %}
    &lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"article-page"</span>&gt;
        &lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"banner"</span>&gt;
            &lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"container"</span>&gt;
                &lt;<span style="color: #006699;">h1</span>&gt;<span style="color: #000000; font-weight: bold; text-decoration: underline;">{{ article.title }}</span>&lt;/<span style="color: #006699;">h1</span>&gt;
                &lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"article-meta"</span>&gt;
                    &lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"info"</span>&gt;
                        &lt;<span style="color: #006699;">span</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"author"</span>&gt;
                            {{ article.author.user.username }}
                        &lt;/<span style="color: #006699;">span</span>&gt;
                        &lt;<span style="color: #006699;">span</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"date"</span>&gt;
                            {{ article.created_at|date:"D M d Y" }}
                        &lt;/<span style="color: #006699;">span</span>&gt;
                    &lt;/<span style="color: #006699;">div</span>&gt;
                &lt;/<span style="color: #006699;">div</span>&gt;
            &lt;/<span style="color: #006699;">div</span>&gt;
        &lt;/<span style="color: #006699;">div</span>&gt;
        &lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"container page"</span>&gt;
            &lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"row article-content"</span>&gt;
                &lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"col-xs-12"</span>&gt;
                    &lt;<span style="color: #006699;">div</span>&gt;
                        {{ article.body|linebreaks }}
                    &lt;/<span style="color: #006699;">div</span>&gt;
                &lt;/<span style="color: #006699;">div</span>&gt;
            &lt;/<span style="color: #006699;">div</span>&gt;
        &lt;/<span style="color: #006699;">div</span>&gt;
    &lt;/<span style="color: #006699;">div</span>&gt;
{% endblock %}
</pre>
</div>

<p>
Finally, we modify <code>home.html</code> so that article previews redirect to articles:
</p>

<div class="org-src-container">
<pre class="src src-html">...
&lt;<span style="color: #006699;">a</span> <span style="color: #BA36A5;">href</span>=<span style="color: #008000;">"{{ article.get_absolute_url }}"</span> <span style="color: #BA36A5;">rel</span>=<span style="color: #008000;">"prefetch"</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"preview-link"</span>&gt;   <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">new </span><span style="color: #8D8D84;">--&gt;</span>
   &lt;<span style="color: #006699;">h1</span>&gt;<span style="color: #000000; font-weight: bold; text-decoration: underline;">{{ article.title }}</span>&lt;/<span style="color: #006699;">h1</span>&gt;
   &lt;<span style="color: #006699;">p</span>&gt;{{ article.description }}&lt;/<span style="color: #006699;">p</span>&gt;
   &lt;<span style="color: #006699;">span</span>&gt;Read more...&lt;/<span style="color: #006699;">span</span>&gt;
&lt;/<span style="color: #006699;">a</span>&gt;                                                                            <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">new </span><span style="color: #8D8D84;">--&gt;</span>
...
</pre>
</div>

<p>
Let&rsquo;s see what it looks like:
</p>


<div id="org2284ee7" class="figure">
<p><img src="./assets/article_detail.png" alt="article_detail.png" width="600" />
</p>
<p><span class="figure-number">Figure 3: </span>article_detail</p>
</div>

<div id="org21f1610" class="figure">
<p><img src="./assets/article_detail - realworld.png" alt="article_detail - realworld.png" width="600" />
</p>
<p><span class="figure-number">Figure 4: </span>article_detail - canonical RealWorld app</p>
</div>
</div>
</div>

<div id="outline-container-org4bb5150" class="outline-3">
<h3 id="org4bb5150"><span class="section-number-3">4.3.</span> Slugs</h3>
<div class="outline-text-3" id="text-4-3">
<p>
We want our article URLs to include slugs, which are easier to read than IDs.
</p>

<p>
We want the slugs to be unique, but some articles might have the same titles, which would generate the same slugs. One solution to this problem is to combine slugs with UUIDs.
</p>
</div>

<div id="outline-container-org2e1a97c" class="outline-4">
<h4 id="org2e1a97c"><span class="section-number-4">4.3.1.</span> Defining a slug and a UUID in the model</h4>
<div class="outline-text-4" id="text-4-3-1">
<p>
First, we need to modify our <code>Article</code> model to include a slug, and to update the <code>get_absolute_url</code> method:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #0000FF;">class</span> <span style="color: #6434A3;">Article</span>(models.Model):
    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">...</span>
    <span style="color: #BA36A5;">slug</span> = models.SlugField(max_length=<span style="color: #D0372D;">255</span>, editable=<span style="color: #D0372D;">False</span>)             <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">new</span>
    <span style="color: #BA36A5;">uuid_field</span> = models.UUIDField(default=uuid.uuid4, editable=<span style="color: #D0372D;">False</span>)   <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">new</span>

    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">...</span>
    <span style="color: #0000FF;">def</span> <span style="color: #006699;">get_absolute_url</span>(<span style="color: #0000FF;">self</span>):
        <span style="color: #0000FF;">return</span> reverse(<span style="color: #008000;">"article_detail"</span>, kwargs={<span style="color: #008000;">"slug"</span>: <span style="color: #0000FF;">self</span>.slug})    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">new</span>
</pre>
</div>

<p>
After modifying the model, we need to sync the database, but this will return a warning.
</p>

<div class="org-src-container">
<pre class="src src-shell">(django) django_tutorial$ python manage.py makemigrations
You are trying to add a non-nullable field <span style="color: #008000;">'slug'</span> to article without a default; we can<span style="color: #008000;">'t do that (the database needs something to populate existing rows).</span>
<span style="color: #008000;">Please select a fix:</span>
<span style="color: #008000;"> 1) Provide a one-off default now (will be set on all existing rows with a null value for this column)</span>
<span style="color: #008000;"> 2) Quit, and let me add a default in models.py</span>
<span style="color: #008000;">Select an option:</span>
</pre>
</div>

<p>
We can&rsquo;t select <code>1</code> because a default is by definition non-unique. We select <code>2</code> to abort and add the <code>null=True</code> arg to the slug field, so as to be able to migrate and then modify the slug manually through the Django admin app:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #0000FF;">class</span> <span style="color: #6434A3;">Article</span>(models.Model):
    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">...</span>
    <span style="color: #BA36A5;">slug</span> = models.SlugField(max_length=<span style="color: #D0372D;">100</span>, null=<span style="color: #D0372D;">True</span>)
    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">...</span>
</pre>
</div>

<p>
We then run <code>makemigrations</code> and <code>migrate</code>, then set a unique slug for each <code>Article</code> through the Django admin app manually. Once we&rsquo;re done, we remove the <code>null=True</code> arg and add the <code>editable=False</code> arg:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #0000FF;">class</span> <span style="color: #6434A3;">Article</span>(models.Model):
    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">...</span>
    <span style="color: #BA36A5;">slug</span> = models.SlugField(max_length=<span style="color: #D0372D;">255</span>, editable=<span style="color: #D0372D;">False</span>)             <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">new</span>
    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">...</span>
</pre>
</div>

<p>
When we migrate, we get a warning:
</p>

<pre class="example">
(django) django_tutorial$ python manage.py makemigrations
You are trying to change the nullable field 'slug' on article to non-nullable without a default; we can't do that (the database needs something to populate existing rows).
Please select a fix:
 1) Provide a one-off default now (will be set on all existing rows with a null value for this column)
 2) Ignore for now, and let me handle existing rows with NULL myself (e.g. because you added a RunPython or RunSQL operation to handle NULL values in a previous data migration)
 3) Quit, and let me add a default in models.py
Select an option:
</pre>

<p>
You can safely select <code>2</code>, as we already have taken care of the slug fields through the Django admin app.
</p>
</div>
</div>
<div id="outline-container-org1c993a4" class="outline-4">
<h4 id="org1c993a4"><span class="section-number-4">4.3.2.</span> Generate unique slug automatically</h4>
<div class="outline-text-4" id="text-4-3-2">
<p>
We want to avoid manually entering the slugs for every article: the generation of a unique slug should be triggered automatically every time an Article is saved.
</p>

<p>
Let&rsquo;s create a <code>utils.py</code> file in the <code>conduit</code> folder and add the following methods to it:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #0000FF;">from</span> django.utils.text <span style="color: #0000FF;">import</span> slugify
<span style="color: #0000FF;">import</span> uuid

<span style="color: #0000FF;">def</span> <span style="color: #006699;">unique_slug_generator</span>(instance):
    <span style="color: #036A07;">"""generate a unique slug for Articles from the title and a UUID"""</span>

    <span style="color: #BA36A5;">ArticleClass</span> = instance.__class__

    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">get max length of ~slug~ as defined in the Article model</span>
    <span style="color: #BA36A5;">max_length</span> = ArticleClass._meta.get_field(<span style="color: #008000;">'slug'</span>).max_length

    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">create slug_uuid by concatenating slugified title and UUID</span>
    <span style="color: #BA36A5;">slug</span> = <span style="color: #008000;">"{slug_field}-{uuid_field}"</span>.<span style="color: #006FE0;">format</span>(
        slug_field = slugify(instance.title)[:max_length-<span style="color: #D0372D;">36</span>-<span style="color: #D0372D;">1</span>],
        uuid_field = <span style="color: #006FE0;">str</span>(instance.uuid_field)
    )

    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">if the slug exists, make another one</span>
    <span style="color: #0000FF;">if</span> ArticleClass.objects.<span style="color: #006FE0;">filter</span>(slug=slug).exists():
        <span style="color: #0000FF;">return</span> unique_slug_generator(instance)

    <span style="color: #0000FF;">return</span> slug
</pre>
</div>
</div>
</div>
<div id="outline-container-org25e547a" class="outline-4">
<h4 id="org25e547a"><span class="section-number-4">4.3.3.</span> Signals</h4>
<div class="outline-text-4" id="text-4-3-3">
<p>
We will now use a signal, a Django utility that allows linking events with actions, to call our <code>unique_slug_generator</code> every time an Article is created. We could override the <code>Article</code> model&rsquo;s <code>save</code> method instead: this is a common method, but not <a href="https://teddit.ggc-project.de/r/django/comments/p3pgr/overriding_save_vs_presave_signals_which_is/">best practice</a>.
</p>

<p>
We create a <code>signals.py</code> file in the <code>articles</code> folder and add the following method to it:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #0000FF;">from</span> django.db.models.signals <span style="color: #0000FF;">import</span> pre_save
<span style="color: #0000FF;">from</span> django.dispatch <span style="color: #0000FF;">import</span> receiver
<span style="color: #0000FF;">from</span> .models <span style="color: #0000FF;">import</span> Article
<span style="color: #0000FF;">from</span> config.utils <span style="color: #0000FF;">import</span> unique_slug_generator

<span style="color: #6434A3;">@receiver</span>(pre_save, sender=Article)
<span style="color: #0000FF;">def</span> <span style="color: #006699;">pre_save_receiver</span>(sender, instance, *args, **kwargs):
   <span style="color: #0000FF;">if</span> <span style="color: #0000FF;">not</span> instance.slug:
       <span style="color: #BA36A5;">instance.slug</span> = unique_slug_generator(instance)
</pre>
</div>

<p>
In order to activate this signal, we will modify <code>articles/apps.py</code>:
</p>

<pre class="example">
from django.apps import AppConfig


class ArticlesConfig(AppConfig):
    default_auto_field = "django.db.models.BigAutoField"
    name = "conduit.articles"

    def ready(self):                                # new
        import conduit.articles.signals             # new
</pre>

<p>
Let&rsquo;s also change our <code>urlpatterns</code> in <code>articles/urls.py</code>:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">other imports</span>
<span style="color: #0000FF;">from</span> .views <span style="color: #0000FF;">import</span> Home, ArticleDetailView

<span style="color: #BA36A5;">urlpatterns</span> = [
    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">other paths</span>
    path(<span style="color: #008000;">"article/&lt;slug:slug&gt;"</span>, ArticleDetailView.as_view(), name=<span style="color: #008000;">"article_detail"</span>),
]
</pre>
</div>

<p>
Let&rsquo;s try creating an Article through the Django admin app.
</p>

<p>
When going back to <a href="http://localhost:8000/">http://localhost:8000/</a> (where your app is running), you will see that your new article has a slug consisting of its slugified title and a UUID:
</p>


<div id="org2c459d9" class="figure">
<p><img src="./assets/article_detail - slug.png" alt="article_detail - slug.png" width="600" />
</p>
<p><span class="figure-number">Figure 5: </span>article_detail - slug</p>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-orgf12181b" class="outline-2">
<h2 id="orgf12181b"><span class="section-number-2">5.</span> Creating, editing, and deleting articles</h2>
<div class="outline-text-2" id="text-5">
<p>
We have implemented the features that allow to view articles, but we need to allow users to create, edit, and delete them as well. We&rsquo;ll first implement this functionality, and modify it later to take into account user authentication.
</p>
</div>
<div id="outline-container-org3fd5558" class="outline-3">
<h3 id="org3fd5558"><span class="section-number-3">5.1.</span> Creating Articles</h3>
<div class="outline-text-3" id="text-5-1">
<p>
Let&rsquo;s allow users to create articles.
</p>

<p>
We define the <code>EditorCreateView</code> view in <code>views.py</code>:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">other imports</span>
<span style="color: #0000FF;">from</span> django.views.generic <span style="color: #0000FF;">import</span> (
     <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">other views</span>
     CreateView
)

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">other views</span>

<span style="color: #0000FF;">class</span> <span style="color: #6434A3;">EditorCreateView</span>(CreateView):
    <span style="color: #036A07;">"""create article"""</span>

    <span style="color: #BA36A5;">model</span> = Article
    <span style="color: #BA36A5;">fields</span> = [<span style="color: #008000;">'title'</span>, <span style="color: #008000;">'description'</span>, <span style="color: #008000;">'body'</span>]
    <span style="color: #BA36A5;">template_name</span> = <span style="color: #008000;">"editor.html"</span>
</pre>
</div>

<p>
We add the following to <code>urls.py</code>:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">other imports</span>
<span style="color: #0000FF;">from</span> .views <span style="color: #0000FF;">import</span> Home, ArticleDetailView, EditorCreateView

<span style="color: #BA36A5;">urlpatterns</span> = [
    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">other paths</span>
    path(<span style="color: #008000;">"editor"</span>, EditorCreateView.as_view(), name=<span style="color: #008000;">"editor_create"</span>),
]
</pre>
</div>

<p>
We add a <code>New article</code> button to the Nav bar in <code>nav.html</code>:
</p>

<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #006699;">ul</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"nav navbar-nav pull-xs-right"</span>&gt;
  &lt;<span style="color: #006699;">li</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"nav-item"</span>&gt;
    {% url 'home' as home %}                                    <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">new </span><span style="color: #8D8D84;">--&gt;</span>
    &lt;<span style="color: #006699;">a</span>
      <span style="color: #BA36A5;">href</span>=<span style="color: #008000;">"{{ home }}"</span>                                         <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">new </span><span style="color: #8D8D84;">--&gt;</span>
      <span style="color: #BA36A5;">rel</span>=<span style="color: #008000;">"prefetch"</span>
      <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"nav-link</span>
<span style="color: #008000;">             {% if request.path == home %}active{% endif %}"</span>    <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">new </span><span style="color: #8D8D84;">--&gt;</span>
    &gt;
      Home
    &lt;/<span style="color: #006699;">a</span>&gt;
  &lt;/<span style="color: #006699;">li</span>&gt;
  &lt;<span style="color: #006699;">li</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"nav-item"</span>&gt;                                         <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">new from here </span><span style="color: #8D8D84;">--&gt;</span>
    {% url 'editor_create' as editor_create %}
    &lt;<span style="color: #006699;">a</span>
      <span style="color: #BA36A5;">href</span>=<span style="color: #008000;">"{{ editor_create }}"</span>
      <span style="color: #BA36A5;">rel</span>=<span style="color: #008000;">"prefetch"</span>
      <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"nav-link</span>
<span style="color: #008000;">             {% if request.path == editor_create %}active{% endif %}"</span>
    &gt;
      &lt;<span style="color: #006699;">span</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"ion-compose"</span>&gt; New Post &lt;/<span style="color: #006699;">span</span>&gt;
    &lt;/<span style="color: #006699;">a</span>&gt;
  &lt;/<span style="color: #006699;">li</span>&gt;                                                         <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">new to here </span><span style="color: #8D8D84;">--&gt;</span>
&lt;/<span style="color: #006699;">ul</span>&gt;
</pre>
</div>

<p>
We added <code>{% url 'home' as home %}</code> and <code>class "nav-link {% if request.path == home %}active{% endif %}"</code> to better style active links.
</p>

<p>
Now, we can create the template <code>editor.html</code>:
</p>

<div class="org-src-container">
<pre class="src src-html">{% extends 'base.html' %}
{% block title %}
    &lt;<span style="color: #006699;">title</span>&gt;<span style="color: #000000; font-weight: bold; text-decoration: underline;">Editor - Conduit: Django + HTMX</span>&lt;/<span style="color: #006699;">title</span>&gt;
{% endblock %}
{% block content %}
    &lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"editor-page"</span>&gt;
        &lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"container page"</span>&gt;
            &lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"row"</span>&gt;
                &lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"col-md-10 offset-md-1 col-xs-12"</span>&gt;
                    &lt;<span style="color: #006699;">form</span> <span style="color: #BA36A5;">method</span>=<span style="color: #008000;">"post"</span>&gt;
                        {% csrf_token %}
                        {{ form.non_field_errors }}
                        &lt;<span style="color: #006699;">fieldset</span>&gt;
                            {% form.non_field_errors %}
                            &lt;<span style="color: #006699;">fieldset</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"form-group"</span>&gt;
                                &lt;<span style="color: #006699;">input</span>
                                    <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"form-control form-control-lg"</span>
                                    <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"text"</span>
                                    <span style="color: #BA36A5;">placeholder</span>=<span style="color: #008000;">"Article Title"</span>
                                    <span style="color: #BA36A5;">name</span>=<span style="color: #008000;">"title"</span>
                                /&gt;
                            &lt;/<span style="color: #006699;">fieldset</span>&gt;
                            {{ form.title.errors }}
                            &lt;<span style="color: #006699;">fieldset</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"form-group"</span>&gt;
                                &lt;<span style="color: #006699;">input</span>
                                    <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"form-control"</span>
                                    <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"text"</span>
                                    <span style="color: #BA36A5;">placeholder</span>=<span style="color: #008000;">"What's this article about?"</span>
                                    <span style="color: #BA36A5;">name</span>=<span style="color: #008000;">"description"</span>
                                /&gt;
                            &lt;/<span style="color: #006699;">fieldset</span>&gt;
                            {{ form.description.errors }}
                            &lt;<span style="color: #006699;">fieldset</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"form-group"</span>&gt;
                                &lt;<span style="color: #006699;">textarea</span>
                                    <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"form-control"</span>
                                    <span style="color: #BA36A5;">rows</span>=<span style="color: #008000;">"8"</span>
                                    <span style="color: #BA36A5;">placeholder</span>=<span style="color: #008000;">"Write your article (in markdown)"</span>
                                    <span style="color: #BA36A5;">name</span>=<span style="color: #008000;">'body'</span>
                                &gt;&lt;/<span style="color: #006699;">textarea</span>&gt;
                            &lt;/<span style="color: #006699;">fieldset</span>&gt;
                            {{ form.body.errors }}
                            &lt;<span style="color: #006699;">button</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"btn btn-lg pull-xs-right btn-primary"</span>&gt;
                                Publish Article
                            &lt;/<span style="color: #006699;">button</span>&gt;
                        &lt;/<span style="color: #006699;">fieldset</span>&gt;
                    &lt;/<span style="color: #006699;">form</span>&gt;
                &lt;/<span style="color: #006699;">div</span>&gt;
            &lt;/<span style="color: #006699;">div</span>&gt;
        &lt;/<span style="color: #006699;">div</span>&gt;
    &lt;/<span style="color: #006699;">div</span>&gt;
{% endblock %}
</pre>
</div>

<p>
Try to create an article in your app. When you hit &ldquo;Publish&rdquo;, you&rsquo;ll get an error:
</p>

<pre class="example">
IntegrityError at /editor
NOT NULL constraint failed: articles_article.author_id
</pre>

<p>
That&rsquo;s because the form doesn&rsquo;t know who the author is, and author is a required field in our model.
Let&rsquo;s override the <code>EditorCreateView</code> view&rsquo;s <code>form_valid</code> method in our <code>views.py</code> file: before we save the form, we&rsquo;ll set the logged in user (<code>admin</code>, for now) as the <code>author</code>:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #0000FF;">class</span> <span style="color: #6434A3;">EditorCreateView</span>(CreateView):
    <span style="color: #036A07;">"""create article"""</span>

    <span style="color: #BA36A5;">model</span> = Article
    <span style="color: #BA36A5;">fields</span> = [<span style="color: #008000;">"title"</span>, <span style="color: #008000;">"description"</span>, <span style="color: #008000;">"body"</span>]
    <span style="color: #BA36A5;">template_name</span> = <span style="color: #008000;">"editor.html"</span>

    <span style="color: #0000FF;">def</span> <span style="color: #006699;">form_valid</span>(<span style="color: #0000FF;">self</span>, form):                         <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">new</span>
        <span style="color: #0000FF;">self</span>.<span style="color: #006FE0;">object</span> = form.save(commit=<span style="color: #D0372D;">False</span>)           <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">new</span>
        <span style="color: #0000FF;">self</span>.<span style="color: #006FE0;">object</span>.author = <span style="color: #0000FF;">self</span>.request.user.profile  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">new</span>
        <span style="color: #0000FF;">self</span>.<span style="color: #006FE0;">object</span>.save()                              <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">new</span>
        <span style="color: #0000FF;">return</span> <span style="color: #006FE0;">super</span>().form_valid(form)                 <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">new</span>
</pre>
</div>

<p>
Once this is done, try creating another article: it should work.
</p>
</div>
</div>
<div id="outline-container-orgc80c338" class="outline-3">
<h3 id="orgc80c338"><span class="section-number-3">5.2.</span> Editing Articles</h3>
<div class="outline-text-3" id="text-5-2">
<p>
We will now implement the editing feature.
</p>

<p>
In <code>views.py</code>, add the following:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">other imports</span>
<span style="color: #0000FF;">from</span> django.views.generic <span style="color: #0000FF;">import</span> (
    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">other views</span>
    UpdateView,
)

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">other views</span>

<span style="color: #0000FF;">class</span> <span style="color: #6434A3;">EditorUpdateView</span>(UpdateView):
    <span style="color: #036A07;">"""edit article"""</span>

    <span style="color: #BA36A5;">model</span> = Article
    <span style="color: #BA36A5;">fields</span> = [<span style="color: #008000;">"title"</span>, <span style="color: #008000;">"description"</span>, <span style="color: #008000;">"title"</span>]
    <span style="color: #BA36A5;">template_name</span> = <span style="color: #008000;">"editor.html"</span>
</pre>
</div>

<p>
We&rsquo;re using the same template for creating and editing articles.
In <code>urls.py</code>, add:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">other imports</span>
<span style="color: #0000FF;">from</span> .views <span style="color: #0000FF;">import</span> (
    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">other views</span>
    EditorUpdateView
)

<span style="color: #BA36A5;">urlpatterns</span> = [
    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">other paths</span>
    path(<span style="color: #008000;">"editor/&lt;slug:slug&gt;"</span>, EditorUpdateView.as_view(), name=<span style="color: #008000;">"editor_update"</span>),
]
</pre>
</div>

<p>
In <code>article_detail.html</code>, we add a button for editing the article and pass <code>article.slug</code> as an argument to the url (see <a href="https://docs.djangoproject.com/en/3.2/ref/templates/builtins/#url">the documentation for <code>url</code> tag</a>), given that our URL expects a slug (<code>editor/&lt;slug:slug&gt;</code>). The documentation for ):
</p>

<div class="org-src-container">
<pre class="src src-python">                &lt;div <span style="color: #0000FF;">class</span>=<span style="color: #008000;">"article-meta"</span>&gt;
                    &lt;div <span style="color: #0000FF;">class</span>=<span style="color: #008000;">"info"</span>&gt;
                        &lt;span <span style="color: #0000FF;">class</span>=<span style="color: #008000;">"author"</span>&gt;
                            {{ article.author }}
                        &lt;/span&gt;
                        &lt;span <span style="color: #0000FF;">class</span>=<span style="color: #008000;">"date"</span>&gt;
                            {{ article.created_at|date:<span style="color: #008000;">"F d, Y"</span> }}
                        &lt;/span&gt;
                    &lt;/div&gt;
                    &lt;span&gt;                                                              &lt;!-- new --&gt;
                        &lt;a                                                              &lt;!-- new --&gt;
                            <span style="color: #BA36A5;">href</span>=<span style="color: #008000;">"{% url 'editor_update' slug=article.slug %}"</span>          &lt;!-- new --&gt;
                            <span style="color: #0000FF;">class</span>=<span style="color: #008000;">"btn btn-outline-secondary btn-sm"</span>                    &lt;!-- new --&gt;
                        &gt;                                                               &lt;!-- new --&gt;
                            &lt;span <span style="color: #0000FF;">class</span>=<span style="color: #008000;">"ion-edit"</span>&gt;                                    &lt;!-- new --&gt;
                                Edit Article                                            &lt;!-- new --&gt;
                            &lt;/span&gt;                                                    &lt;!-- new --&gt;
                        &lt;/a&gt;                                                            &lt;!-- new --&gt;
                    &lt;/span&gt;                                                             &lt;!-- new --&gt;
                &lt;/div&gt;
</pre>
</div>

<p>
In the <code>editor.html</code> template, we want to have the form fields prepopulated with the relevant values. When using <code>UpdateView</code>, we have access to the object being updated. Let&rsquo;s add the following to the <code>editor.html</code> template:
</p>

<div class="org-src-container">
<pre class="src src-html">                        &lt;<span style="color: #006699;">fieldset</span>&gt;
                            &lt;<span style="color: #006699;">fieldset</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"form-group"</span>&gt;
                                &lt;<span style="color: #006699;">input</span>
                                    <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"form-control form-control-lg"</span>
                                    <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"text"</span>
                                    <span style="color: #BA36A5;">placeholder</span>=<span style="color: #008000;">"Article Title"</span>
                                    <span style="color: #BA36A5;">name</span>=<span style="color: #008000;">"title"</span>
                                    <span style="color: #BA36A5;">value</span>=<span style="color: #008000;">"{{ article.title|default_if_none:'' }}"</span>          <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">new </span><span style="color: #8D8D84;">--&gt;</span>
                                /&gt;
                            &lt;/<span style="color: #006699;">fieldset</span>&gt;
                            &lt;<span style="color: #006699;">fieldset</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"form-group"</span>&gt;
                                &lt;<span style="color: #006699;">input</span>
                                    <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"form-control"</span>
                                    <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"text"</span>
                                    <span style="color: #BA36A5;">placeholder</span>=<span style="color: #008000;">"What's this article about?"</span>
                                    <span style="color: #BA36A5;">name</span>=<span style="color: #008000;">"description"</span>
                                    <span style="color: #BA36A5;">value</span>=<span style="color: #008000;">"{{ article.description|default_if_none:'' }}"</span>    <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">new </span><span style="color: #8D8D84;">--&gt;</span>
                                /&gt;
                            &lt;/<span style="color: #006699;">fieldset</span>&gt;
                            &lt;<span style="color: #006699;">fieldset</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"form-group"</span>&gt;
                                &lt;<span style="color: #006699;">textarea</span>
                                    <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"form-control"</span>
                                    <span style="color: #BA36A5;">rows</span>=<span style="color: #008000;">"8"</span>
                                    <span style="color: #BA36A5;">placeholder</span>=<span style="color: #008000;">"Write your article (in markdown)"</span>
                                    <span style="color: #BA36A5;">name</span>=<span style="color: #008000;">"body"</span>
                                /&gt;{{ article.body|default_if_none:'' }}&lt;/<span style="color: #006699;">textarea</span>&gt;          <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">new </span><span style="color: #8D8D84;">--&gt;</span>
                            &lt;/<span style="color: #006699;">fieldset</span>&gt;
                            &lt;<span style="color: #006699;">button</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"btn btn-lg pull-xs-right btn-primary"</span>&gt;
                                Publish Article
                            &lt;/<span style="color: #006699;">button</span>&gt;
                        &lt;/<span style="color: #006699;">fieldset</span>&gt;
</pre>
</div>

<p>
Try editing an article: all the values should be prepopulated.
</p>
</div>
</div>
<div id="outline-container-orgcd272af" class="outline-3">
<h3 id="orgcd272af"><span class="section-number-3">5.3.</span> Deleting Articles</h3>
<div class="outline-text-3" id="text-5-3">
<p>
In <code>views.py</code>, we create a <code>ArticleDeleteView</code>:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">other imports</span>
<span style="color: #0000FF;">from</span> django.views.generic <span style="color: #0000FF;">import</span> (
    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">other views</span>
    DeleteView,
)
<span style="color: #0000FF;">from</span> django.urls <span style="color: #0000FF;">import</span> reverse_lazy

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">other classes</span>
<span style="color: #0000FF;">class</span> <span style="color: #6434A3;">EditorDeleteView</span>(DeleteView):
    <span style="color: #036A07;">"""delete article"""</span>

    <span style="color: #BA36A5;">model</span> = Article
    <span style="color: #BA36A5;">success_url</span> = reverse_lazy(<span style="color: #008000;">"home"</span>)
    <span style="color: #BA36A5;">template_name</span> = <span style="color: #008000;">"article_detail.html"</span>
</pre>
</div>

<p>
Notice that we&rsquo;re using the <code>article_detail.html</code> template. We could use a separate one, but that would require to load a new page, which seems unnecessary: we&rsquo;ll in a second how we&rsquo;re making this work.
</p>

<p>
In <code>urls.py</code>:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">other imports</span>
<span style="color: #0000FF;">from</span> .views <span style="color: #0000FF;">import</span> (
    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">other views</span>
    EditorDeleteView,
)

<span style="color: #BA36A5;">urlpatterns</span> = [
    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">other paths</span>
    path(<span style="color: #008000;">"editor/&lt;slug:slug&gt;/delete"</span>, EditorDeleteView.as_view(), name=<span style="color: #008000;">"editor_delete"</span>),
]
</pre>
</div>

<p>
Now, create an <code>article_delete.html</code> file: this will hold the form for deleteing the article.
</p>

<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #006699;">form</span>                                                                                       <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">new  </span><span style="color: #8D8D84;">--&gt;</span>
    <span style="color: #BA36A5;">method</span>=<span style="color: #008000;">"POST"</span>                                                                           <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">new  </span><span style="color: #8D8D84;">--&gt;</span>
    <span style="color: #BA36A5;">action</span>=<span style="color: #008000;">"{% url 'editor_delete' slug=article.slug %}"</span>                                    <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">new  </span><span style="color: #8D8D84;">--&gt;</span>
    <span style="color: #BA36A5;">style</span>=<span style="color: #008000;">"display:inline"</span>                                                                  <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">new  </span><span style="color: #8D8D84;">--&gt;</span>
&gt;                                                                                           <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">new  </span><span style="color: #8D8D84;">--&gt;</span>
    {% csrf_token %}                                                                        <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">new  </span><span style="color: #8D8D84;">--&gt;</span>
    &lt;<span style="color: #006699;">button</span>                                                                                 <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">new  </span><span style="color: #8D8D84;">--&gt;</span>
        <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"btn btn-outline-danger btn-sm"</span>                                               <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">new  </span><span style="color: #8D8D84;">--&gt;</span>
        <span style="color: #BA36A5;">value</span>=<span style="color: #008000;">"DELETE"</span>                                                                      <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">new  </span><span style="color: #8D8D84;">--&gt;</span>
        <span style="color: #BA36A5;">onclick</span>=<span style="color: #008000;">"return confirm('Are you sure you want to delete {{ article.title }}?')"</span>    <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">new  </span><span style="color: #8D8D84;">--&gt;</span>
    &gt;                                                                                       <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">new  </span><span style="color: #8D8D84;">--&gt;</span>
        &lt;<span style="color: #006699;">span</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"ion-trash-a"</span>&gt;                                                         <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">new  </span><span style="color: #8D8D84;">--&gt;</span>
            Delete Article                                                                  <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">new  </span><span style="color: #8D8D84;">--&gt;</span>
        &lt;/<span style="color: #006699;">span</span>&gt;                                                                                <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">new  </span><span style="color: #8D8D84;">--&gt;</span>
    &lt;/<span style="color: #006699;">button</span>&gt;                                                                               <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">new  </span><span style="color: #8D8D84;">--&gt;</span>
&lt;/<span style="color: #006699;">form</span>&gt;                                                                                     <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">new  </span><span style="color: #8D8D84;">--&gt;</span>
</pre>
</div>

<p>
Now, we want to load this template in <code>article_detail.html</code> directly, which we achieve with an <code>include</code> tag:
</p>

<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #006699;">span</span>&gt;
    &lt;<span style="color: #006699;">a</span>
        <span style="color: #BA36A5;">href</span>=<span style="color: #008000;">"{% url 'editor_update' slug=article.slug %}"</span>
        <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"btn btn-outline-secondary btn-sm"</span>
    &gt;
        &lt;<span style="color: #006699;">i</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"ion-edit"</span>&gt;
<span style="color: #1A1A1A; font-style: italic;">            Edit Article</span>
<span style="color: #1A1A1A; font-style: italic;">        </span>&lt;/<span style="color: #006699;">i</span>&gt;
    &lt;/<span style="color: #006699;">a</span>&gt;
    {% include 'article_delete.html' %}             <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">new </span><span style="color: #8D8D84;">--&gt;</span>
&lt;/<span style="color: #006699;">span</span>&gt;
</pre>
</div>

<p>
Try deleting an article: you should get a nice confirmation message while still on the <code>article_detail.html</code> template, before the article is deleted.
</p>
</div>
</div>
</div>
<div id="outline-container-org567855c" class="outline-2">
<h2 id="org567855c"><span class="section-number-2">6.</span> Comments</h2>
<div class="outline-text-2" id="text-6">
<p>
Now that we have articles, we need comments.
</p>
</div>
<div id="outline-container-org0dcea7c" class="outline-3">
<h3 id="org0dcea7c"><span class="section-number-3">6.1.</span> Model</h3>
<div class="outline-text-3" id="text-6-1">
<p>
A comment needs a related article, an author, a body, and a date.
Let&rsquo;s create a <code>Comment</code> model in <code>models.py</code>:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">other models</span>

<span style="color: #0000FF;">class</span> <span style="color: #6434A3;">Comment</span>(models.Model):
    <span style="color: #BA36A5;">article</span> = models.ForeignKey(
        Article,
        on_delete=models.CASCADE,
        related_name=<span style="color: #008000;">"comments"</span>,
        to_field=<span style="color: #008000;">"slug"</span>,
    )
    <span style="color: #BA36A5;">body</span> = models.TextField()
    <span style="color: #BA36A5;">author</span> = models.ForeignKey(
        settings.AUTH_USER_MODEL,
        on_delete=models.CASCADE,
        related_name=<span style="color: #008000;">"comments"</span>,
    )
    <span style="color: #BA36A5;">created_at</span> = models.DateTimeField(auto_now_add=<span style="color: #D0372D;">True</span>)

    <span style="color: #0000FF;">def</span> <span style="color: #006699;">__str__</span>(<span style="color: #0000FF;">self</span>):
        <span style="color: #0000FF;">return</span> <span style="color: #0000FF;">self</span>.body[:<span style="color: #D0372D;">60</span>] + <span style="color: #008000;">"..."</span>

    <span style="color: #0000FF;">def</span> <span style="color: #006699;">get_absolute_url</span>(<span style="color: #0000FF;">self</span>):
        <span style="color: #0000FF;">return</span> reverse(<span style="color: #008000;">"article_detail"</span>, kwargs={<span style="color: #008000;">"slug"</span>: <span style="color: #0000FF;">self</span>.article.slug})
</pre>
</div>

<p>
Let&rsquo;s <code>makemigrations</code> and <code>migrate</code>. You should get the following error:
</p>

<pre class="example">
SystemCheckError: System check identified some issues:

ERRORS:
articles.Comment.article: (fields.E311) 'Article.slug' must be unique because it is referenced by a foreign key.
        HINT: Add unique=True to this field or add a UniqueConstraint (without condition) in the model Meta.constraints.
</pre>

<p>
That&rsquo;s because we&rsquo;re using articles&rsquo; slugs as ForeignKeys for the comments (so that we can filter our comments by the attached articles&rsquo; slugs instead of their UUIDs). This error is easily corrected by adding <code>unique=True</code> as an argument to the <code>slug</code> field in the <code>Article</code> model in <code>models.py</code>. You should be able to <code>makemigrations</code> and <code>migrate</code> after that.
</p>

<p>
Now, we need to register our model in <code>admin.py</code>:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #0000FF;">from</span> django.contrib <span style="color: #0000FF;">import</span> admin
<span style="color: #0000FF;">from</span> .models <span style="color: #0000FF;">import</span> Article, Comment        <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">new</span>

admin.site.register(Article)
admin.site.register(Comment)                <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">new</span>
</pre>
</div>

<p>
When this is done, go to your admin app and create a few comments for a couple articles.
</p>
</div>
</div>
<div id="outline-container-org07669cb" class="outline-3">
<h3 id="org07669cb"><span class="section-number-3">6.2.</span> Viewing comments</h3>
<div class="outline-text-3" id="text-6-2">
<p>
We want to be able to view the comments in our <code>article_detail.html</code> template.
</p>

<p>
In <code>article_detail.html</code>:
</p>

<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"container page"</span>&gt;
    &lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"row article-content"</span>&gt;
        &lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"col-xs-12"</span>&gt;
            &lt;<span style="color: #006699;">div</span>&gt;
                {{ article.body|linebreaks }}
            &lt;/<span style="color: #006699;">div</span>&gt;
        &lt;/<span style="color: #006699;">div</span>&gt;
    &lt;/<span style="color: #006699;">div</span>&gt;
    &lt;<span style="color: #006699;">hr</span> /&gt;                                  <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">new </span><span style="color: #8D8D84;">--&gt;</span>
    &lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"row"</span>&gt;                       <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">new </span><span style="color: #8D8D84;">--&gt;</span>
        {% include 'comments.html' %}       <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">new </span><span style="color: #8D8D84;">--&gt;</span>
    &lt;/<span style="color: #006699;">div</span>&gt;                                  <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">new </span><span style="color: #8D8D84;">--&gt;</span>
&lt;/<span style="color: #006699;">div</span>&gt;
</pre>
</div>

<p>
Now create <code>comments.html</code> in the <code>templates</code> folder and add the following:
</p>

<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"col-xs-12 col-md-8 offset-md-2"</span>&gt;
    {% for comment in article.comments.all|dictsortreversed:'created_at' %}
        &lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"card"</span>&gt;
            &lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"card-block"</span>&gt;
                &lt;<span style="color: #006699;">p</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"card-text"</span>&gt;
                    {{ comment.body }}
                &lt;/<span style="color: #006699;">p</span>&gt;
            &lt;/<span style="color: #006699;">div</span>&gt;
            &lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"card-footer"</span>&gt;
                &lt;<span style="color: #006699;">span</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"comment-author"</span>&gt;
                    {{ comment.author.user.username }}
                &lt;/<span style="color: #006699;">span</span>&gt;
                &lt;<span style="color: #006699;">span</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"date-posted"</span>&gt;
                    {{ comment.created_at|date:"D M d Y" }}
                &lt;/<span style="color: #006699;">span</span>&gt;
            &lt;/<span style="color: #006699;">div</span>&gt;
        &lt;/<span style="color: #006699;">div</span>&gt;
    {% endfor %}
&lt;/<span style="color: #006699;">div</span>&gt;
</pre>
</div>
</div>
</div>
<div id="outline-container-org3b8e1c8" class="outline-3">
<h3 id="org3b8e1c8"><span class="section-number-3">6.3.</span> Creating comments</h3>
<div class="outline-text-3" id="text-6-3">
<p>
We will now start allowing our users to leave comments on the website. We could do this like in the Django Girls tutorial: the <code>ArticleDetailView</code> would include a button that would direct to <code>CommentCreateView</code> on a separate page, and saving the comment would bring the user back to the <code>ArticleDetailView</code>. However, the <code>RealWorldApp</code> allows users to create and save their comments directly below the article, on the same page, so that&rsquo;s what we&rsquo;re going to try.
</p>

<p>
Surprisingly, this is not straightforward to implement in Django, because it implies mixing <code>DetailView</code> and <code>CreateView</code> functionalities in a single page, which is made difficult by the fact that the <code>DetailView</code> doesn&rsquo;t have a POST method, while the <code>CreateView</code> requires it. Fortunately, our use case is covered in the Django documentation: <a href="https://docs.djangoproject.com/en/4.0/topics/class-based-views/mixins/#an-alternative-better-solution">https://docs.djangoproject.com/en/4.0/topics/class-based-views/mixins/#an-alternative-better-solution</a>.
</p>

<p>
First, we&rsquo;ll create a <code>CommentCreateView</code> in <code>users/views.py</code>.
We override the <code>form_valid</code> method because we need to specify the <code>author</code> and <code>article</code> fields required by the <code>Comment</code> model.
We also override the <code>get_success_url</code> because we want the user to be redirected to the <code>ArticleDetailView</code> upon saving the comment.
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">other imports</span>
<span style="color: #0000FF;">from</span> .models <span style="color: #0000FF;">import</span> Article, Comment

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">other models</span>
<span style="color: #0000FF;">class</span> <span style="color: #6434A3;">CommentCreateView</span>(CreateView):
    <span style="color: #036A07;">"""create comment"""</span>

    <span style="color: #BA36A5;">model</span> = Comment
    <span style="color: #BA36A5;">fields</span> = [<span style="color: #008000;">"body"</span>]
    <span style="color: #BA36A5;">template_name</span> = <span style="color: #008000;">"article_detail.html"</span>

    <span style="color: #0000FF;">def</span> <span style="color: #006699;">form_valid</span>(<span style="color: #0000FF;">self</span>, form):
        <span style="color: #BA36A5;">form.instance.author</span> = <span style="color: #0000FF;">self</span>.request.user.profile
        <span style="color: #BA36A5;">form.instance.article</span> = Article.objects.<span style="color: #006FE0;">filter</span>(
            slug=<span style="color: #0000FF;">self</span>.kwargs.get(<span style="color: #008000;">"slug"</span>)
        ).first()
        <span style="color: #0000FF;">return</span> <span style="color: #006FE0;">super</span>().form_valid(form)

    <span style="color: #0000FF;">def</span> <span style="color: #006699;">get_success_url</span>(<span style="color: #0000FF;">self</span>):
        <span style="color: #0000FF;">return</span> reverse(<span style="color: #008000;">"article_detail"</span>, kwargs={<span style="color: #008000;">"slug"</span>: <span style="color: #0000FF;">self</span>.<span style="color: #006FE0;">object</span>.article.slug})
</pre>
</div>

<p>
Now, we need to modify the <code>ArticleDetailView</code> to make the <code>CommentCreateView</code>&rsquo;s form available to <code>templates/article_detail.html</code> through the <code>get_context_data</code> method:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #0000FF;">class</span> <span style="color: #6434A3;">ArticleDetailView</span>(DetailView):
    <span style="color: #036A07;">"""detail view for individual articles"""</span>

    <span style="color: #BA36A5;">model</span> = Article
    <span style="color: #BA36A5;">template_name</span> = <span style="color: #008000;">"article_detail.html"</span>

    <span style="color: #0000FF;">def</span> <span style="color: #006699;">get_context_data</span>(<span style="color: #0000FF;">self</span>, **kwargs):                   <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">new</span>
        <span style="color: #BA36A5;">context</span> = <span style="color: #006FE0;">super</span>().get_context_data(**kwargs)        <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">new</span>
        <span style="color: #BA36A5;">context</span>[<span style="color: #008000;">"form"</span>] = CommentCreateView().get_form()    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">new</span>
        <span style="color: #0000FF;">return</span> context                                      <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">new</span>
</pre>
</div>

<p>
Finally, we create a view that combines <code>ArticleDetailView</code> and <code>CommentCreateView</code>:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">other imports</span>
<span style="color: #0000FF;">from</span> django.views.generic <span style="color: #0000FF;">import</span> (
    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">other views</span>
    View,
)


<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">other models</span>
<span style="color: #0000FF;">class</span> <span style="color: #6434A3;">ArticleCommentView</span>(View):
    <span style="color: #036A07;">"""view article and post comments"""</span>

    <span style="color: #0000FF;">def</span> <span style="color: #006699;">get</span>(<span style="color: #0000FF;">self</span>, request, *args, **kwargs):
        <span style="color: #BA36A5;">view</span> = ArticleDetailView.as_view()
        <span style="color: #0000FF;">return</span> view(request, *args, **kwargs)

    <span style="color: #0000FF;">def</span> <span style="color: #006699;">post</span>(<span style="color: #0000FF;">self</span>, request, *args, **kwargs):
        <span style="color: #BA36A5;">view</span> = CommentCreateView.as_view()
        <span style="color: #0000FF;">return</span> view(request, *args, **kwargs)
</pre>
</div>

<p>
We want this new hybrid view to be the one returned by the <code>article/&lt;slug:slug&gt;</code> path: depending on whether the method is <code>GET</code> or <code>POST</code>, the new view will either return the <code>ArticleDetailView</code>, or the <code>CommentCreateView</code>.
</p>

<p>
In <code>urls.py</code>, we replace the <code>article_detail</code> path by the following:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">other imports</span>
<span style="color: #0000FF;">from</span> .views <span style="color: #0000FF;">import</span> (
    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">other views</span>
    ArticleCommentView,
)

<span style="color: #BA36A5;">urlpatterns</span> = [
    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">other paths</span>
    path(
        <span style="color: #008000;">"article/&lt;slug:slug&gt;"</span>,
        ArticleCommentView.as_view(),
        name=<span style="color: #008000;">"article_detail"</span>,
    ),
    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">instead of =path("article/&lt;slug:slug&gt;", ArticleCommentView.as_view(), name="article_detail")=</span>
]
</pre>
</div>

<p>
Now that our views.py and urls.py are ready, we need to create the templates.
</p>

<p>
Create <code>comment_create.html</code>, which corresponds to the <code>CommentCreateView</code>&rsquo;s form:
</p>

<div class="org-src-container">
<pre class="src src-html">{% block content %}
    &lt;<span style="color: #006699;">form</span>
        <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"card comment-form"</span>
        <span style="color: #BA36A5;">method</span>=<span style="color: #008000;">"post"</span>
        <span style="color: #BA36A5;">action</span>=<span style="color: #008000;">"{% url 'article_detail' slug=object.slug %}"</span>
    &gt;
        {% csrf_token %}
        &lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"card-block"</span>&gt;
            &lt;<span style="color: #006699;">textarea</span>
                <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"form-control"</span>
                <span style="color: #BA36A5;">rows</span>=<span style="color: #008000;">"3"</span>
                <span style="color: #BA36A5;">placeholder</span>=<span style="color: #008000;">"Write a comment..."</span>
                <span style="color: #BA36A5;">name</span>=<span style="color: #008000;">"{{ form.body.name }}"</span>
            &gt;{{ form.body.value|default_if_none:'' }}&lt;/<span style="color: #006699;">textarea</span>&gt;
        &lt;/<span style="color: #006699;">div</span>&gt;
        &lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"card-footer"</span>&gt;
            &lt;<span style="color: #006699;">button</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"btn btn-sm btn-primary"</span> <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"submit"</span>&gt;
                Post Comment
            &lt;/<span style="color: #006699;">button</span>&gt;
        &lt;/<span style="color: #006699;">div</span>&gt;
    &lt;/<span style="color: #006699;">form</span>&gt;
{% endblock %}
</pre>
</div>

<p>
In <code>comments.html</code>, we include the <code>comment_create.html</code> template:
</p>

<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"col-xs-12 col-md-8 offset-md-2"</span>&gt;
    &lt;<span style="color: #006699;">div</span>&gt;                                           <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">new </span><span style="color: #8D8D84;">--&gt;</span>
        {% include 'comment_create.html' %}         <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">new </span><span style="color: #8D8D84;">--&gt;</span>
    &lt;/<span style="color: #006699;">div</span>&gt;                                          <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">new </span><span style="color: #8D8D84;">--&gt;</span>
    {% for comment in article.comments.all|dictsortreversed:'created_at' %}
    <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">... </span><span style="color: #8D8D84;">--&gt;</span>
</pre>
</div>

<p>
Everything should be working now. Try to create some comments on an article.
</p>
</div>
</div>
<div id="outline-container-orga1d9a52" class="outline-3">
<h3 id="orga1d9a52"><span class="section-number-3">6.4.</span> Deleting comments</h3>
<div class="outline-text-3" id="text-6-4">
<p>
We now want to be able to delete comments.
</p>

<p>
In <code>articles/views.py</code>, add the <code>CommentDeleteView</code>:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #0000FF;">class</span> <span style="color: #6434A3;">CommentDeleteView</span>(DeleteView):
    <span style="color: #036A07;">"""delete comment"""</span>

    <span style="color: #BA36A5;">model</span> = Comment
    <span style="color: #BA36A5;">template_name</span> = <span style="color: #008000;">"article_detail.html"</span>

    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">redirect to attached article's detail page upon success</span>
    <span style="color: #0000FF;">def</span> <span style="color: #006699;">get_success_url</span>(<span style="color: #0000FF;">self</span>):
        <span style="color: #0000FF;">return</span> reverse(<span style="color: #008000;">"article_detail"</span>, kwargs={<span style="color: #008000;">"slug"</span>: <span style="color: #0000FF;">self</span>.<span style="color: #006FE0;">object</span>.article.slug})
</pre>
</div>

<p>
In <code>urls.py</code>:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #BA36A5;">urlpatterns</span> = [
    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">...</span>
    path(
        <span style="color: #008000;">"article/&lt;slug:slug&gt;/comment/&lt;int:pk&gt;/delete"</span>,
        CommentDeleteView.as_view(),
        name=<span style="color: #008000;">"comment_delete"</span>,
    ),
]
</pre>
</div>

<p>
We require <code>pk</code> as an argument because that&rsquo;s what the <code>CommentDeleteView</code> needs to know which comment to delete. The <code>&lt;slug:slug&gt;</code> part is unnecessary, but it makes the path more logical, I find.
</p>

<p>
In <code>comments.html</code>:
</p>

<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"card-footer"</span>&gt;
    &lt;<span style="color: #006699;">span</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"comment-author"</span>&gt;
        {{ comment.author }}
    &lt;/<span style="color: #006699;">span</span>&gt;
    &lt;<span style="color: #006699;">span</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"date-posted"</span>&gt;
        {{ comment.created_at|date:"D M d Y" }}
    &lt;/<span style="color: #006699;">span</span>&gt;
    {% include 'comment_delete.html' %}             <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">new </span><span style="color: #8D8D84;">--&gt;</span>
&lt;/<span style="color: #006699;">div</span>&gt;
</pre>
</div>

<p>
Create <code>comment_delete.html</code>:
</p>

<div class="org-src-container">
<pre class="src src-html">{% block content %}
    &lt;<span style="color: #006699;">form</span>
        <span style="color: #BA36A5;">method</span>=<span style="color: #008000;">"post"</span>
        <span style="color: #BA36A5;">action</span>=<span style="color: #008000;">"{% url 'comment_delete' slug=article.slug pk=comment.pk %}"</span>
        <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"mod-options"</span>
    &gt;
        {% csrf_token %}
        &lt;<span style="color: #006699;">button</span>
            <span style="color: #BA36A5;">style</span>=<span style="color: #008000;">"background: none;</span>
<span style="color: #008000;">                   border: none;</span>
<span style="color: #008000;">                   padding: 0;</span>
<span style="color: #008000;">                   margin: 0;</span>
<span style="color: #008000;">                   font-size: inherit;</span>
<span style="color: #008000;">                   margin-left: 5px;</span>
<span style="color: #008000;">                   opacity: 0.6;</span>
<span style="color: #008000;">                   cursor: pointer;"</span>
            <span style="color: #BA36A5;">value</span>=<span style="color: #008000;">"DELETE"</span>
            <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"ion-trash-a"</span>
        &gt;&lt;/<span style="color: #006699;">button</span>&gt;
    &lt;/<span style="color: #006699;">form</span>&gt;
{% endblock %}
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org394336a" class="outline-2">
<h2 id="org394336a"><span class="section-number-2">7.</span> Users and Profiles</h2>
<div class="outline-text-2" id="text-7">
</div>
<div id="outline-container-org2758186" class="outline-3">
<h3 id="org2758186"><span class="section-number-3">7.1.</span> Introduction</h3>
<div class="outline-text-3" id="text-7-1">
<p>
Time to work on our users and profiles.
</p>

<p>
<a href="https://docs.djangoproject.com/en/4.0/topics/auth/customizing/#specifying-a-custom-user-model">The Django docs say</a> &ldquo;<i>it may be more suitable to store app-specific user information in a model that has a relation with your custom user model. That allows each app to specify its own user data requirements without potentially conflicting or breaking assumptions by other apps. It also means that you would keep your user model as simple as possible, focused on authentication, and following the minimum requirements Django expects custom user models to meet.</i>&rdquo;.
</p>

<p>
This is why we&rsquo;ll have the authentication logic in a <code>User</code> model and the profile logic in a <code>Profile</code> model.
</p>
</div>
</div>
<div id="outline-container-org114f339" class="outline-3">
<h3 id="org114f339"><span class="section-number-3">7.2.</span> User model</h3>
<div class="outline-text-3" id="text-7-2">
</div>
<div id="outline-container-orgde6bc9b" class="outline-4">
<h4 id="orgde6bc9b"><span class="section-number-4">7.2.1.</span> User</h4>
<div class="outline-text-4" id="text-7-2-1">
<p>
The <code>User</code> model will contain everything related to authentication.
</p>

<p>
We need an email, a username, and a password. Let&rsquo;s add the following to the <code>User</code> model in <code>users/models.py</code>:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #0000FF;">from</span> django.contrib.auth.models <span style="color: #0000FF;">import</span> AbstractUser
<span style="color: #0000FF;">from</span> django.db <span style="color: #0000FF;">import</span> models


<span style="color: #0000FF;">class</span> <span style="color: #6434A3;">User</span>(AbstractUser):
    <span style="color: #036A07;">"""User model"""</span>

    <span style="color: #BA36A5;">username</span> = models.CharField(max_length=<span style="color: #D0372D;">255</span>, unique=<span style="color: #D0372D;">True</span>)
    <span style="color: #BA36A5;">email</span> = models.EmailField(unique=<span style="color: #D0372D;">True</span>)

    <span style="color: #BA36A5;">USERNAME_FIELD</span> = <span style="color: #008000;">"email"</span>
    <span style="color: #BA36A5;">REQUIRED_FIELDS</span> = [<span style="color: #008000;">"username"</span>]

    <span style="color: #0000FF;">def</span> <span style="color: #006699;">__str__</span>(<span style="color: #0000FF;">self</span>):
        <span style="color: #0000FF;">self</span>.email
</pre>
</div>

<p>
The <code>username</code> field is the unique human-readable identifier that we can represent users with in our app.
The <code>email</code> field holds the email users will be logging in with. We specify this in <code>USERNAME_FIELD</code>.
The <code>password</code> field is already provided by <code>AbstractUser</code>.
<code>REQUIRED_FIELDS</code> is the list of field users will be prompted for at sign up: because the <code>USERNAME_FIELD</code> and the <code>password</code> are already required by Django, we only need to specify <code>username</code>.
More information about the fields can be found in the docs for <a href="https://docs.djangoproject.com/en/4.0/ref/contrib/auth/">the default Django User model</a>.
</p>
</div>
</div>
<div id="outline-container-orga9429b6" class="outline-4">
<h4 id="orga9429b6"><span class="section-number-4">7.2.2.</span> UserManager</h4>
<div class="outline-text-4" id="text-7-2-2">
<p>
We also need a <code>UserManager</code>, <a href="https://docs.djangoproject.com/en/4.0/topics/auth/customizing/#writing-a-manager-for-a-custom-user-model">as advised by the docs</a>. In <code>models.py</code>, we add the following, BEFORE we define our <code>User</code> model:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">other imports</span>
<span style="color: #0000FF;">from</span> django.contrib.auth.models <span style="color: #0000FF;">import</span> AbstractUser, UserManager

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">other models</span>
<span style="color: #0000FF;">class</span> <span style="color: #6434A3;">CustomUserManager</span>(UserManager):
    <span style="color: #036A07;">"""custom UserManager with unique identifier is email instead of username"""</span>

    <span style="color: #0000FF;">def</span> <span style="color: #006699;">create_user</span>(<span style="color: #0000FF;">self</span>, username, email, password=<span style="color: #D0372D;">None</span>):
        <span style="color: #036A07;">"""Create and return a User with username, email, and password"""</span>

        <span style="color: #0000FF;">if</span> email <span style="color: #0000FF;">is</span> <span style="color: #D0372D;">None</span>:
            <span style="color: #0000FF;">raise</span> <span style="color: #6434A3;">ValueError</span>(<span style="color: #008000;">"Email is required."</span>)
        <span style="color: #0000FF;">if</span> username <span style="color: #0000FF;">is</span> <span style="color: #D0372D;">None</span>:
            <span style="color: #0000FF;">raise</span> <span style="color: #6434A3;">ValueError</span>(<span style="color: #008000;">"Username is required"</span>)

        <span style="color: #BA36A5;">email</span> = <span style="color: #0000FF;">self</span>.normalize_email(email)
        <span style="color: #BA36A5;">user</span> = <span style="color: #0000FF;">self</span>.model(username=username, email=email)
        user.set_password(password)
        user.save()

        <span style="color: #0000FF;">return</span> user

    <span style="color: #0000FF;">def</span> <span style="color: #006699;">create_superuser</span>(<span style="color: #0000FF;">self</span>, username, email, password=<span style="color: #D0372D;">None</span>):
        <span style="color: #036A07;">"""Create and return a SuperUser with admin permissions."""</span>

        <span style="color: #BA36A5;">user</span> = <span style="color: #0000FF;">self</span>.create_user(username, email, password)
        <span style="color: #BA36A5;">user.is_staff</span> = <span style="color: #D0372D;">True</span>
        <span style="color: #BA36A5;">user.is_superuser</span> = <span style="color: #D0372D;">True</span>
        <span style="color: #BA36A5;">user.is_active</span> = <span style="color: #D0372D;">True</span>
        user.save()

        <span style="color: #0000FF;">return</span> user
</pre>
</div>

<p>
<code>create_user</code> and <code>create_superuser</code> are self-explanatory.
</p>

<p>
We now need to go back to the <code>User</code> model in <code>users/models.py</code> and indicate to Django that the <code>UserManager</code> defined above will manage objects of type <code>User</code>:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">other</span>
<span style="color: #0000FF;">class</span> <span style="color: #6434A3;">User</span>(AbstractUser):
    <span style="color: #036A07;">"""User model"""</span>

    <span style="color: #BA36A5;">username</span> = models.CharField(max_length=<span style="color: #D0372D;">255</span>, unique=<span style="color: #D0372D;">True</span>)
    <span style="color: #BA36A5;">email</span> = models.EmailField(unique=<span style="color: #D0372D;">True</span>)

    <span style="color: #BA36A5;">USERNAME_FIELD</span> = <span style="color: #008000;">"email"</span>
    <span style="color: #BA36A5;">REQUIRED_FIELDS</span> = [<span style="color: #008000;">"username"</span>]

    <span style="color: #BA36A5;">objects</span> = CustomUserManager()               <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">new</span>

    <span style="color: #0000FF;">def</span> <span style="color: #006699;">__str__</span>(<span style="color: #0000FF;">self</span>):
        <span style="color: #0000FF;">return</span> <span style="color: #0000FF;">self</span>.email
</pre>
</div>

<p>
Make sure to <code>makemigrations</code> and <code>migrate</code>, so that Django is aware of your new model.
</p>
</div>
</div>
<div id="outline-container-orgac65c22" class="outline-4">
<h4 id="orgac65c22"><span class="section-number-4">7.2.3.</span> admin.py</h4>
<div class="outline-text-4" id="text-7-2-3">
<p>
We need to register this new <code>User</code> model in <code>users/admins.py</code>, to have access to it in our admin app.
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #0000FF;">from</span> django.contrib <span style="color: #0000FF;">import</span> admin
<span style="color: #0000FF;">from</span> .models <span style="color: #0000FF;">import</span> User

admin.site.register(User)
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orga280739" class="outline-3">
<h3 id="orga280739"><span class="section-number-3">7.3.</span> Profile model</h3>
<div class="outline-text-3" id="text-7-3">
</div>
<div id="outline-container-org398329e" class="outline-4">
<h4 id="org398329e"><span class="section-number-4">7.3.1.</span> Profile</h4>
<div class="outline-text-4" id="text-7-3-1">
<p>
We are following the instructions in the Django docs about <a href="https://docs.djangoproject.com/en/4.0/topics/auth/customizing/#extending-the-existing-user-model">extending a User model</a>. We need to store some information about our users in the database. Each <code>User</code> object should be related to a single <code>Profile</code>, and vice-versa: we&rsquo;ll use a <a href="https://docs.djangoproject.com/en/4.0/ref/models/fields/#onetoonefield"><code>OneToOneField</code></a> relationship.
</p>

<p>
Our <code>Profile</code> needs the following fields:
</p>
<ul class="org-ul">
<li>image</li>
<li>bio</li>
<li>articles</li>
<li>comments</li>
</ul>

<p>
We have already taken care of the two last fields in the <code>Article</code> and <code>Comment</code> models through the <code>ForeignKey</code> relationships.
</p>

<p>
We will allow users to specify a URL to their avatar and to write a short bio. This is optional, so we make sure to have <code>blank=True</code>. Let&rsquo;s add the following to the <code>Profile</code> model in <code>users/models.py</code>:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #0000FF;">class</span> <span style="color: #6434A3;">Profile</span>(models.Model):
    <span style="color: #036A07;">"""Profile model"""</span>

    <span style="color: #BA36A5;">user</span> = models.OneToOneField(settings.AUTH_USER_MODEL, on_delete=models.CASCADE)
    <span style="color: #BA36A5;">image</span> = models.URLField(
        default=<span style="color: #008000;">"https://static.productionready.io/images/smiley-cyrus.jpg"</span>
    )
    <span style="color: #BA36A5;">bio</span> = models.TextField(max_length=<span style="color: #D0372D;">1000</span>, blank=<span style="color: #D0372D;">True</span>)

    <span style="color: #0000FF;">def</span> <span style="color: #006699;">__str__</span>(<span style="color: #0000FF;">self</span>):
        <span style="color: #0000FF;">return</span> <span style="color: #0000FF;">self</span>.user.username
</pre>
</div>

<p>
As always, whenever you change a model, you should <code>makemigrations</code> and <code>migrate</code>.
</p>
</div>
</div>
<div id="outline-container-org7fd3d31" class="outline-4">
<h4 id="org7fd3d31"><span class="section-number-4">7.3.2.</span> signals.py</h4>
<div class="outline-text-4" id="text-7-3-2">
<p>
Since we&rsquo;re defining the <code>Profile</code> outside of the <code>User</code> model, a profile won&rsquo;t be created automatically whenever a user signs up.
</p>

<p>
Let&rsquo;s follow the docs linked above and code up a signal that creates a <code>Profile</code> at user sign-up.
</p>

<p>
Create a <code>signals.py</code> file in the <code>users</code> folder and add the following:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #0000FF;">from</span> django.db.models.signals <span style="color: #0000FF;">import</span> post_save
<span style="color: #0000FF;">from</span> django.dispatch <span style="color: #0000FF;">import</span> receiver
<span style="color: #0000FF;">from</span> .models <span style="color: #0000FF;">import</span> User, Profile


<span style="color: #6434A3;">@receiver</span>(post_save, sender=User)
<span style="color: #0000FF;">def</span> <span style="color: #006699;">create_profile_for_user</span>(sender, instance, created, **kwargs):
    <span style="color: #0000FF;">if</span> created:
        Profile.objects.create(user=instance)


<span style="color: #6434A3;">@receiver</span>(post_save, sender=User)
<span style="color: #0000FF;">def</span> <span style="color: #006699;">save_profile_for_user</span>(sender, instance, **kwargs):
    instance.profile.save()
</pre>
</div>

<p>
In order to activate this signal, we will modify <code>users/apps.py</code>:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #0000FF;">from</span> django.apps <span style="color: #0000FF;">import</span> AppConfig


<span style="color: #0000FF;">class</span> <span style="color: #6434A3;">UsersConfig</span>(AppConfig):
    <span style="color: #BA36A5;">default_auto_field</span> = <span style="color: #008000;">"django.db.models.BigAutoField"</span>
    <span style="color: #BA36A5;">name</span> = <span style="color: #008000;">"conduit.users"</span>

    <span style="color: #0000FF;">def</span> <span style="color: #006699;">ready</span>(<span style="color: #0000FF;">self</span>):                        <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">new</span>
        <span style="color: #0000FF;">import</span> conduit.users.signals        <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">new</span>
</pre>
</div>

<p>
This signal runs whenever a <code>User</code> is saved. By checking for <code>created</code>, we make sure to only initiate a <code>Profile</code> for the <code>User</code> instance if the User has just been created, instead of whenever the instance is updated.
</p>
</div>
</div>
<div id="outline-container-org894c4e3" class="outline-4">
<h4 id="org894c4e3"><span class="section-number-4">7.3.3.</span> admin.py</h4>
<div class="outline-text-4" id="text-7-3-3">
<p>
We need to register this new <code>Profile</code> model in <code>users/admins.py</code>, to have access to it in our admin app, but we want to be able to view <code>User</code> and <code>Profile</code> information for a given user in the same place.
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #0000FF;">from</span> django.contrib <span style="color: #0000FF;">import</span> admin
<span style="color: #0000FF;">from</span> .models <span style="color: #0000FF;">import</span> User, Profile


<span style="color: #0000FF;">class</span> <span style="color: #6434A3;">ProfileInline</span>(admin.StackedInline):
    <span style="color: #BA36A5;">model</span> = Profile
    <span style="color: #BA36A5;">can_delete</span> = <span style="color: #D0372D;">False</span>


<span style="color: #0000FF;">class</span> <span style="color: #6434A3;">UserAdmin</span>(admin.ModelAdmin):
    <span style="color: #BA36A5;">model</span> = User
    <span style="color: #BA36A5;">inlines</span> = [ProfileInline]


admin.site.register(User, UserAdmin)
</pre>
</div>

<p>
You&rsquo;ll notice that this code is much shorter than <a href="https://docs.djangoproject.com/en/4.0/topics/auth/customizing/#extending-the-existing-user-model">what the docs say</a>: we&rsquo;re trying to keep it simple, so we&rsquo;ll do without some of the quality of life improvements that a more intricate code would allow.
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-org7a4c364" class="outline-2">
<h2 id="org7a4c364"><span class="section-number-2">8.</span> Authentication</h2>
<div class="outline-text-2" id="text-8">
</div>
<div id="outline-container-orgeee1896" class="outline-3">
<h3 id="orgeee1896"><span class="section-number-3">8.1.</span> Auth views</h3>
<div class="outline-text-3" id="text-8-1">
<p>
In <code>users/views.py</code>, we take advantage of the generic <code>LoginView</code>, <code>LogoutView</code>, and <code>CreateView</code> to implement our authentication logic:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #0000FF;">from</span> django.contrib.auth.views <span style="color: #0000FF;">import</span> LoginView, LogoutView
<span style="color: #0000FF;">from</span> django.views.generic <span style="color: #0000FF;">import</span> CreateView
<span style="color: #0000FF;">from</span> django.urls <span style="color: #0000FF;">import</span> reverse_lazy
<span style="color: #0000FF;">from</span> .models <span style="color: #0000FF;">import</span> User


<span style="color: #0000FF;">class</span> <span style="color: #6434A3;">Login</span>(LoginView):
    <span style="color: #BA36A5;">template_name</span> = <span style="color: #008000;">"login.html"</span>
    <span style="color: #BA36A5;">next_page</span> = reverse_lazy(<span style="color: #008000;">"home"</span>)

    <span style="color: #0000FF;">def</span> <span style="color: #006699;">get</span>(<span style="color: #0000FF;">self</span>, request, *args, **kwargs):
        <span style="color: #0000FF;">if</span> request.user.is_authenticated:
            <span style="color: #0000FF;">return</span> redirect(<span style="color: #0000FF;">self</span>.next_page)
        <span style="color: #0000FF;">return</span> <span style="color: #006FE0;">super</span>().get(request, *args, **kwargs)


<span style="color: #0000FF;">class</span> <span style="color: #6434A3;">Logout</span>(LogoutView):
    <span style="color: #BA36A5;">next_page</span> = reverse_lazy(<span style="color: #008000;">"home"</span>)


<span style="color: #0000FF;">class</span> <span style="color: #6434A3;">SignUpView</span>(CreateView):
    <span style="color: #BA36A5;">model</span> = User
    <span style="color: #BA36A5;">fields</span> = [<span style="color: #008000;">"username"</span>, <span style="color: #008000;">"email"</span>, <span style="color: #008000;">"password"</span>]
    <span style="color: #BA36A5;">template_name</span> = <span style="color: #008000;">"signup.html"</span>
    <span style="color: #BA36A5;">success_url</span> = reverse_lazy(<span style="color: #008000;">"home"</span>)

    <span style="color: #0000FF;">def</span> <span style="color: #006699;">get</span>(<span style="color: #0000FF;">self</span>, request, *args, **kwargs):
        <span style="color: #0000FF;">if</span> request.user.is_authenticated:
            <span style="color: #0000FF;">return</span> redirect(<span style="color: #0000FF;">self</span>.success_url)
        <span style="color: #0000FF;">return</span> <span style="color: #006FE0;">super</span>().get(request, *args, **kwargs)
</pre>
</div>

<p>
We don&rsquo;t have to specify much to the generic views, they&rsquo;re quite full-featured as is. What we did here is indicate where the templates live and where the views redirect to (the <a href="https://docs.djangoproject.com/en/dev/ref/settings/#login-redirect-url">defaults</a> are <code>accounts/profile</code> for <code>LoginView</code> and <code>None</code> for <code>LogoutView</code>).
We also overrode the <code>get</code> method in <code>LoginView</code> and <code>SignUpView</code>, so that already authenticated users who for some reason visit the login page are automatically redirected to the <code>home</code> URL.
We didn&rsquo;t specify a template for <code>LogoutView</code> because it&rsquo;s not necessary.
</p>
</div>
</div>
<div id="outline-container-org7818a9c" class="outline-3">
<h3 id="org7818a9c"><span class="section-number-3">8.2.</span> Auth urls</h3>
<div class="outline-text-3" id="text-8-2">
<p>
Let&rsquo;s deal with the URL patterns now.
Create <code>users/urls.py</code> and add the following:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #0000FF;">from</span> django.urls <span style="color: #0000FF;">import</span> path
<span style="color: #0000FF;">from</span> .views <span style="color: #0000FF;">import</span> Login, Logout, SignUp


<span style="color: #BA36A5;">urlpatterns</span> = [
    path(<span style="color: #008000;">"login"</span>, Login.as_view(), name=<span style="color: #008000;">"login"</span>),
    path(<span style="color: #008000;">"logout"</span>, Logout.as_view(), name=<span style="color: #008000;">"logout"</span>),
    path(<span style="color: #008000;">"signup"</span>, SignUp.as_view(), name=<span style="color: #008000;">"signup"</span>),
]
</pre>
</div>

<p>
For every app that we create, we need to tell <code>config/urls.py</code> to look at the patterns specified in the app&rsquo;s <code>urls.py</code> file:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #BA36A5;">urlpatterns</span> = [
    path(<span style="color: #008000;">"admin/"</span>, admin.site.urls),
    path(<span style="color: #008000;">""</span>, include(<span style="color: #008000;">"conduit.articles.urls"</span>)),
    path(<span style="color: #008000;">""</span>, include(<span style="color: #008000;">"conduit.users.urls"</span>)),        <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">new</span>
]
</pre>
</div>
</div>
</div>
<div id="outline-container-org4ded453" class="outline-3">
<h3 id="org4ded453"><span class="section-number-3">8.3.</span> Auth templates</h3>
<div class="outline-text-3" id="text-8-3">
</div>
<div id="outline-container-org0746bf4" class="outline-4">
<h4 id="org0746bf4"><span class="section-number-4">8.3.1.</span> login.html</h4>
<div class="outline-text-4" id="text-8-3-1">
<p>
Let&rsquo;s create <code>login.html</code> in the <code>templates</code> folder:
</p>

<div class="org-src-container">
<pre class="src src-html">{% extends 'base.html' %}
{% block title %}
    &lt;<span style="color: #006699;">title</span>&gt;<span style="color: #000000; font-weight: bold; text-decoration: underline;">Sign in - Conduit: Django + HTMX</span>&lt;/<span style="color: #006699;">title</span>&gt;
{% endblock %}
{% block content %}
    &lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"auth-page"</span>&gt;
        &lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"container page"</span>&gt;
            &lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"row"</span>&gt;
                &lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"col-md-6 offset-md-3 col-xs-12"</span>&gt;
                    &lt;<span style="color: #006699;">h1</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"text-xs-center"</span>&gt;<span style="color: #000000; font-weight: bold; text-decoration: underline;">Sign In</span>&lt;/<span style="color: #006699;">h1</span>&gt;
                    &lt;<span style="color: #006699;">p</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"text-xs-center"</span>&gt;
                        &lt;<span style="color: #006699;">a</span> <span style="color: #BA36A5;">href</span>=<span style="color: #008000;">"{% url 'signup' %}"</span>&gt;Need an account?&lt;/<span style="color: #006699;">a</span>&gt;
                    &lt;/<span style="color: #006699;">p</span>&gt;
                    {{ form.non_field_errors }}
                    &lt;<span style="color: #006699;">form</span> <span style="color: #BA36A5;">method</span>=<span style="color: #008000;">"post"</span>&gt;
                        {% csrf_token %}
                        &lt;<span style="color: #006699;">fieldset</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"form-group"</span>&gt;
                            &lt;<span style="color: #006699;">input</span>
                                <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"form-control form-control-lg"</span>
                                <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"email"</span>
                                <span style="color: #BA36A5;">placeholder</span>=<span style="color: #008000;">"Email"</span>
                                <span style="color: #BA36A5;">name</span>=<span style="color: #008000;">"{{ form.username.name }}"</span>
                            &gt;
                            {{ form.username.errors }}
                        &lt;/<span style="color: #006699;">fieldset</span>&gt;
                        &lt;<span style="color: #006699;">fieldset</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"form-group"</span>&gt;
                            &lt;<span style="color: #006699;">input</span>
                                <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"form-control form-control-lg"</span>
                                <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"password"</span>
                                <span style="color: #BA36A5;">placeholder</span>=<span style="color: #008000;">"Password"</span>
                                <span style="color: #BA36A5;">name</span>=<span style="color: #008000;">"{{ form.password.name }}"</span>
                            &gt;
                            {{ form.password.errors }}
                        &lt;/<span style="color: #006699;">fieldset</span>&gt;
                        &lt;<span style="color: #006699;">button</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"btn btn-lg btn-primary pull-xs-right"</span> <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"submit"</span>&gt;
                            Sign in
                        &lt;/<span style="color: #006699;">button</span>&gt;
                    &lt;/<span style="color: #006699;">form</span>&gt;
                &lt;/<span style="color: #006699;">div</span>&gt;
            &lt;/<span style="color: #006699;">div</span>&gt;
        &lt;/<span style="color: #006699;">div</span>&gt;
    &lt;/<span style="color: #006699;">div</span>&gt;
{% endblock %}
</pre>
</div>

<p>
Notice that we are using <code>form.username</code> to authenticate. I initially was trying to work with <code>form.email</code>, because that was the field we chose to authenticate with, but it kept throwing errors: Django didn&rsquo;t see the field, didn&rsquo;t POST the value that I gave it, and asked for the username every time. It took me a while, but I realised that our username <i>is</i> the email. <code>form.username</code> is effectively querying what the <code>USERNAME_FIELD</code> is. Not straightforward though.
</p>
</div>
</div>
<div id="outline-container-org5f53bfd" class="outline-4">
<h4 id="org5f53bfd"><span class="section-number-4">8.3.2.</span> signup.html</h4>
<div class="outline-text-4" id="text-8-3-2">
<p>
Create <code>signup.html</code>:
</p>

<div class="org-src-container">
<pre class="src src-html">{% extends 'base.html' %}
{% block title %}
    &lt;<span style="color: #006699;">title</span>&gt;<span style="color: #000000; font-weight: bold; text-decoration: underline;">Sign up - Conduit: Django + HTMX</span>&lt;/<span style="color: #006699;">title</span>&gt;
{% endblock %}
{% block content %}
    &lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"auth-page"</span>&gt;
        &lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"container page"</span>&gt;
            &lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"row"</span>&gt;
                &lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"col-md-6 offset-md-3 col-xs-12"</span>&gt;
                    &lt;<span style="color: #006699;">h1</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"text-xs-center"</span>&gt;<span style="color: #000000; font-weight: bold; text-decoration: underline;">Sign up</span>&lt;/<span style="color: #006699;">h1</span>&gt;
                    &lt;<span style="color: #006699;">p</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"text-xs-center"</span>&gt;
                        &lt;<span style="color: #006699;">a</span> <span style="color: #BA36A5;">href</span>=<span style="color: #008000;">"{% url 'login' %}"</span>&gt;Have an account?&lt;/<span style="color: #006699;">a</span>&gt;
                    &lt;/<span style="color: #006699;">p</span>&gt;
                    {{ form.non_field_errors }}
                    &lt;<span style="color: #006699;">form</span> <span style="color: #BA36A5;">method</span>=<span style="color: #008000;">"post"</span>&gt;
                        {% csrf_token %}
                        &lt;<span style="color: #006699;">fieldset</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"form-group"</span>&gt;
                            &lt;<span style="color: #006699;">input</span>
                                <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"form-control form-control-lg"</span>
                                <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"text"</span>
                                <span style="color: #BA36A5;">placeholder</span>=<span style="color: #008000;">"Your {{ form.username.name }}"</span>
                                <span style="color: #BA36A5;">name</span>=<span style="color: #008000;">"{{ form.username.name }}"</span>
                                <span style="color: #BA36A5;">value</span>=<span style="color: #008000;">"{{ form.username.value|default_if_none:'' }}"</span>
                            &gt;
                        &lt;/<span style="color: #006699;">fieldset</span>&gt;
                        {{ form.username.errors }}
                        &lt;<span style="color: #006699;">fieldset</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"form-group"</span>&gt;
                            &lt;<span style="color: #006699;">input</span>
                                <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"form-control form-control-lg"</span>
                                <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"email"</span>
                                <span style="color: #BA36A5;">placeholder</span>=<span style="color: #008000;">"Your {{ form.email.name }}"</span>
                                <span style="color: #BA36A5;">name</span>=<span style="color: #008000;">"{{ form.email.name }}"</span>
                                <span style="color: #BA36A5;">value</span>=<span style="color: #008000;">"{{ form.email.value|default_if_none:''  }}"</span>
                            &gt;
                        &lt;/<span style="color: #006699;">fieldset</span>&gt;
                        {{ form.email.errors }}
                        &lt;<span style="color: #006699;">fieldset</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"form-group"</span>&gt;
                            &lt;<span style="color: #006699;">input</span>
                                <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"form-control form-control-lg"</span>
                                <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"password"</span>
                                <span style="color: #BA36A5;">placeholder</span>=<span style="color: #008000;">"Your {{ form.password.name }}"</span>
                                <span style="color: #BA36A5;">name</span>=<span style="color: #008000;">"{{ form.password.name }}"</span>
                            &gt;
                        &lt;/<span style="color: #006699;">fieldset</span>&gt;
                        {{ form.password.errors }}
                        &lt;<span style="color: #006699;">button</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"btn btn-lg btn-primary pull-xs-right"</span>&gt;
                            Sign up
                        &lt;/<span style="color: #006699;">button</span>&gt;
                    &lt;/<span style="color: #006699;">form</span>&gt;
                &lt;/<span style="color: #006699;">div</span>&gt;
            &lt;/<span style="color: #006699;">div</span>&gt;
        &lt;/<span style="color: #006699;">div</span>&gt;
    &lt;/<span style="color: #006699;">div</span>&gt;
{% endblock %}
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-org3a0f17d" class="outline-2">
<h2 id="org3a0f17d"><span class="section-number-2">9.</span> Securing the app</h2>
<div class="outline-text-2" id="text-9">
</div>
<div id="outline-container-orgf027ee8" class="outline-3">
<h3 id="orgf027ee8"><span class="section-number-3">9.1.</span> Nav</h3>
<div class="outline-text-3" id="text-9-1">
<p>
We don&rsquo;t want to expose the <code>New post</code> link to unauthenticated users.
</p>

<p>
In <code>nav.html</code>:
</p>

<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #006699;">nav</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"navbar navbar-light"</span>&gt;
  &lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"container"</span>&gt;
    &lt;<span style="color: #006699;">a</span> <span style="color: #BA36A5;">rel</span>=<span style="color: #008000;">"prefetch"</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"navbar-brand"</span> <span style="color: #BA36A5;">href</span>=<span style="color: #008000;">"/"</span>&gt;conduit&lt;/<span style="color: #006699;">a</span>&gt;
    &lt;<span style="color: #006699;">ul</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"nav navbar-nav pull-xs-right"</span>&gt;
      &lt;<span style="color: #006699;">li</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"nav-item"</span>&gt;
        {% url 'home' as home %}
        &lt;<span style="color: #006699;">a</span>
          <span style="color: #BA36A5;">href</span>=<span style="color: #008000;">"{{ home }}"</span>
          <span style="color: #BA36A5;">rel</span>=<span style="color: #008000;">"prefetch"</span>
          <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"nav-link</span>
<span style="color: #008000;">                 {% if request.path == home %}active{% endif %}"</span>
        &gt;
          Home
        &lt;/<span style="color: #006699;">a</span>&gt;
      &lt;/<span style="color: #006699;">li</span>&gt;
      {% if user.is_authenticated %}                          <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">new from here </span><span style="color: #8D8D84;">--&gt;</span>
        &lt;<span style="color: #006699;">li</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"nav-item"</span>&gt;
          {% url 'editor_create' as editor_create %}
          &lt;<span style="color: #006699;">a</span>
            <span style="color: #BA36A5;">href</span>=<span style="color: #008000;">"{{ editor_create }}"</span>
            <span style="color: #BA36A5;">rel</span>=<span style="color: #008000;">"prefetch"</span>
            <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"nav-link</span>
<span style="color: #008000;">                   {% if request.path == editor_create %}active{% endif %}"</span>
          &gt;
            &lt;<span style="color: #006699;">span</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"ion-compose"</span>&gt; New Post &lt;/<span style="color: #006699;">span</span>&gt;
          &lt;/<span style="color: #006699;">a</span>&gt;
        &lt;/<span style="color: #006699;">li</span>&gt;
        &lt;<span style="color: #006699;">li</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"nav-item"</span>&gt;
          &lt;<span style="color: #006699;">a</span> <span style="color: #BA36A5;">href</span>=<span style="color: #008000;">"{% url 'logout' %}"</span> <span style="color: #BA36A5;">rel</span>=<span style="color: #008000;">"prefetch"</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"nav-link"</span>&gt;
            &lt;<span style="color: #006699;">span</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"ion-log-out"</span>&gt;&lt;/<span style="color: #006699;">span</span>&gt;
          &lt;/<span style="color: #006699;">a</span>&gt;
        &lt;/<span style="color: #006699;">li</span>&gt;
      {% else %}
        &lt;<span style="color: #006699;">li</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"nav-item"</span>&gt;
          {% url 'login' as login %}
          &lt;<span style="color: #006699;">a</span>
            <span style="color: #BA36A5;">href</span>=<span style="color: #008000;">"{{ login }}"</span>
            <span style="color: #BA36A5;">rel</span>=<span style="color: #008000;">"prefetch"</span>
            <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"nav-link</span>
<span style="color: #008000;">                   {% if request.path == login %}active{% endif %}"</span>
          &gt;
            Sign in
          &lt;/<span style="color: #006699;">a</span>&gt;
        &lt;/<span style="color: #006699;">li</span>&gt;
        &lt;<span style="color: #006699;">li</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"nav-item"</span>&gt;
          {% url 'signup' as signup %}
          &lt;<span style="color: #006699;">a</span>
            <span style="color: #BA36A5;">href</span>=<span style="color: #008000;">"{{ signup }}"</span>
            <span style="color: #BA36A5;">rel</span>=<span style="color: #008000;">"prefetch"</span>
            <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"nav-link</span>
<span style="color: #008000;">                   {% if request.path == signup %}active{% endif %}"</span>
          &gt;
            Sign up
          &lt;/<span style="color: #006699;">a</span>&gt;
        &lt;/<span style="color: #006699;">li</span>&gt;
      {% endif %}                                             <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">to here </span><span style="color: #8D8D84;">--&gt;</span>
    &lt;/<span style="color: #006699;">ul</span>&gt;
  &lt;/<span style="color: #006699;">div</span>&gt;
&lt;/<span style="color: #006699;">nav</span>&gt;
</pre>
</div>
</div>
</div>
<div id="outline-container-org0645c22" class="outline-3">
<h3 id="org0645c22"><span class="section-number-3">9.2.</span> LoginRequiredMixin</h3>
<div class="outline-text-3" id="text-9-2">
<p>
Some pages should only be accessible to authenticated users, and Django provides an easy way of doing so through mixins. Mixins are components that provide common extra functionality. They can be added to class-based views on the fly.
</p>

<p>
In <code>articles/views.py</code>, add the following:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">other imports</span>
<span style="color: #0000FF;">from</span> django.contrib.auth.mixins <span style="color: #0000FF;">import</span> LoginRequiredMixin

<span style="color: #0000FF;">class</span> <span style="color: #6434A3;">EditorCreateView</span>(LoginRequiredMixin, CreateView):
    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">...</span>
<span style="color: #0000FF;">class</span> <span style="color: #6434A3;">EditorDeleteView</span>(LoginRequiredMixin, DeleteView):
    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">...</span>
<span style="color: #0000FF;">class</span> <span style="color: #6434A3;">CommentCreateView</span>(LoginRequiredMixin, CreateView):
    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">...</span>
<span style="color: #0000FF;">class</span> <span style="color: #6434A3;">ArticleCommentView</span>(LoginRequiredMixin, View):
    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">...</span>
<span style="color: #0000FF;">class</span> <span style="color: #6434A3;">CommentDeleteView</span>(LoginRequiredMixin, DeleteView):
    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">...</span>
</pre>
</div>

<p>
Notice that the <code>LoginRequiredMixin</code> should be at the leftmost position in the inheritance list: don&rsquo;t write <code>class EditorDeleteView(DeleteView, LoginRequiredMixin)</code> if you want to avoid errors.
</p>

<p>
If you try creating a post from the app, you should get this error:
</p>


<div id="orgb3bd106" class="figure">
<p><img src="./assets/login - error.png" alt="login - error.png" />
</p>
</div>

<p>
The cause of the problem is given in the line:
</p>

<blockquote>
<p>
The current path, accounts/login/, didn&rsquo;t match any of these.
</p>
</blockquote>

<p>
By default, the login url in Django is <code>accounts/login</code>: while we changed our urls everywhere, the <code>LoginRequiredMixin</code> does not know that. To fix this, we need to add this line in <code>config/settings.py</code>:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #BA36A5;">LOGIN_URL</span> = <span style="color: #008000;">"login"</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org642d371" class="outline-3">
<h3 id="org642d371"><span class="section-number-3">9.3.</span> Only allow authors to edit or delete their articles and comments</h3>
<div class="outline-text-3" id="text-9-3">
<p>
While we&rsquo;re at it, let&rsquo;s also make sure that articles and comments can only be edited and deleted by their authors.
</p>

<p>
In <code>templates/article_detail.html</code>, we hide the button for editing and deleting articles from any user who is not the article&rsquo;s author:
</p>

<div class="org-src-container">
<pre class="src src-html">{% if user == article.author.user %}                        <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">new </span><span style="color: #8D8D84;">--&gt;</span>
  &lt;<span style="color: #006699;">span</span>&gt;
    &lt;<span style="color: #006699;">a</span>
      <span style="color: #BA36A5;">href</span>=<span style="color: #008000;">"{% url 'editor_update' slug=article.slug %}"</span>
      <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"btn btn-outline-secondary btn-sm"</span>
    &gt;
      &lt;<span style="color: #006699;">span</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"ion-edit"</span>&gt;
        Edit Article
      &lt;/<span style="color: #006699;">span</span>&gt;
    &lt;/<span style="color: #006699;">a</span>&gt;
    {% include 'article_delete.html' %}
  &lt;/<span style="color: #006699;">span</span>&gt;
{% endif %}                                                 <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">new </span><span style="color: #8D8D84;">--&gt;</span>
</pre>
</div>

<p>
In <code>templates/comment_comments.html</code>:
</p>

<div class="org-src-container">
<pre class="src src-html">{% if user == comment.author.user %}
  {% include 'comment_delete.html' %}
{% endif %}
</pre>
</div>

<p>
In <code>users/views.py</code>, we make sure that editing or deleting actions are only taken into account if the user is the author of the article or comment:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">other imports</span>
<span style="color: #0000FF;">from</span> django.shortcuts <span style="color: #0000FF;">import</span> redirect

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">...</span>
<span style="color: #0000FF;">class</span> <span style="color: #6434A3;">EditorUpdateView</span>(LoginRequiredMixin, UpdateView):
    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">...</span>
    <span style="color: #0000FF;">def</span> <span style="color: #006699;">post</span>(<span style="color: #0000FF;">self</span>, request, *args, **kwargs):
        <span style="color: #0000FF;">if</span> request.user == <span style="color: #0000FF;">self</span>.get_object().author.user:
            <span style="color: #0000FF;">return</span> <span style="color: #006FE0;">super</span>().post(request, *args, **kwargs)
        <span style="color: #0000FF;">return</span> redirect(<span style="color: #0000FF;">self</span>.get_object().get_absolute_url())


<span style="color: #0000FF;">class</span> <span style="color: #6434A3;">EditorDeleteView</span>(LoginRequiredMixin, DeleteView):
    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">...</span>
    <span style="color: #0000FF;">def</span> <span style="color: #006699;">post</span>(<span style="color: #0000FF;">self</span>, request, *args, **kwargs):
        <span style="color: #0000FF;">if</span> request.user == <span style="color: #0000FF;">self</span>.get_object().author.user:
            <span style="color: #0000FF;">return</span> <span style="color: #006FE0;">super</span>().post(request, *args, **kwargs)
        <span style="color: #0000FF;">return</span> redirect(<span style="color: #0000FF;">self</span>.get_object().get_absolute_url())


<span style="color: #0000FF;">class</span> <span style="color: #6434A3;">CommentDeleteView</span>(LoginRequiredMixin, DeleteView):
    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">...</span>
    <span style="color: #0000FF;">def</span> <span style="color: #006699;">post</span>(<span style="color: #0000FF;">self</span>, request, *args, **kwargs):
        <span style="color: #0000FF;">if</span> request.user == <span style="color: #0000FF;">self</span>.get_object().author.user:
            <span style="color: #0000FF;">return</span> <span style="color: #006FE0;">super</span>().post(request, *args, **kwargs)
        <span style="color: #0000FF;">return</span> redirect(<span style="color: #0000FF;">self</span>.get_object().get_absolute_url())
</pre>
</div>
</div>
</div>
<div id="outline-container-orga48a01a" class="outline-3">
<h3 id="orga48a01a"><span class="section-number-3">9.4.</span> Testing signup and login</h3>
<div class="outline-text-3" id="text-9-4">
<p>
For now, we only have one user for our app: the <code>admin</code> superuser.
</p>

<p>
Let&rsquo;s create a new user by clicking on <code>Sign up</code> in our navbar. Enter a username, an email (which doesn&rsquo;t have to be a real one as long as it&rsquo;s the right format), and a password.
</p>

<p>
When you finalise this action by clicking the button <code>Sign up</code>, you&rsquo;ll notice that you&rsquo;re redirected to the homepage without being logged in. This is fine - you can sign in manually as the user you just created or you might want to implement an email verification before allowing sign ups - but, in our case, we might as well sign in the user automatically.
</p>

<p>
In <code>users/views.py</code>, add the following to <code>SignUpView</code> (as explained in <a href="https://stackoverflow.com/a/70582911">this StackOverflow answer</a>):
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">other imports</span>
<span style="color: #0000FF;">from</span> django.shortcuts <span style="color: #0000FF;">import</span> redirect  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">new</span>
<span style="color: #0000FF;">from</span> django.contrib.auth <span style="color: #0000FF;">import</span> authenticate, login  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">new</span>

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">other views</span>
<span style="color: #0000FF;">class</span> <span style="color: #6434A3;">SignUpView</span>(CreateView):
    <span style="color: #BA36A5;">model</span> = User
    <span style="color: #BA36A5;">fields</span> = [<span style="color: #008000;">"username"</span>, <span style="color: #008000;">"email"</span>, <span style="color: #008000;">"password"</span>]
    <span style="color: #BA36A5;">template_name</span> = <span style="color: #008000;">"signup.html"</span>
    <span style="color: #BA36A5;">success_url</span> = reverse_lazy(<span style="color: #008000;">"home"</span>)

    <span style="color: #0000FF;">def</span> <span style="color: #006699;">form_valid</span>(<span style="color: #0000FF;">self</span>, form):  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">new</span>
        <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">create the User object</span>
        <span style="color: #BA36A5;">user</span> = form.save(commit=<span style="color: #D0372D;">False</span>)  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">new</span>
        <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">set password manually</span>
        <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">as otherwise the User will be saved with unhashed password</span>
        <span style="color: #BA36A5;">password</span> = form.cleaned_data.get(<span style="color: #008000;">"password"</span>)  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">new</span>
        user.set_password(password)  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">new</span>
        <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">save the User object to the database</span>
        user.save()  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">new</span>
        <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">authenticate your user with unhashed password</span>
        <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">(`authenticate` expects unhashed passwords)</span>
        <span style="color: #BA36A5;">email</span> = form.cleaned_data.get(<span style="color: #008000;">"email"</span>)  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">new</span>
        <span style="color: #BA36A5;">authenticated_user</span> = authenticate(email=email, password=password)  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">new</span>
        <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">log in</span>
        login(<span style="color: #0000FF;">self</span>.request, authenticated_user)  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">new</span>
        <span style="color: #0000FF;">return</span> redirect(<span style="color: #0000FF;">self</span>.success_url)  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">new</span>
</pre>
</div>

<p>
To make sure you understand what we&rsquo;re doing here: Django hashes passwords when creating a new <code>User</code>, but we need to make it explicit that the <code>password</code> field is the password (through <code>user.set_password(password)</code>) and needs to be hashed, otherwise there will be errors whenever we try to authenticate:
</p>
<ul class="org-ul">
<li>Django will save the unhashed password to the database</li>
<li>during login, it will take the user-submitted plaintext password and hash it</li>
<li>check the hash of the user-submitted password against what it believes to be <i>the hash of the actual password</i> in the database</li>
<li>see that the two passwords don&rsquo;t match (obviously)</li>
<li>refuse authentication.</li>
</ul>

<p>
Now that we&rsquo;ve resolved the issue, try creating a new user: everything should work.
</p>
</div>
</div>
</div>
<div id="outline-container-org7f838de" class="outline-2">
<h2 id="org7f838de"><span class="section-number-2">10.</span> Profile features</h2>
<div class="outline-text-2" id="text-10">
</div>
<div id="outline-container-org08be8ad" class="outline-3">
<h3 id="org08be8ad"><span class="section-number-3">10.1.</span> Viewing Profiles</h3>
<div class="outline-text-3" id="text-10-1">
<p>
It&rsquo;s time to allow users to view their own and other users&rsquo; profiles.
</p>

<p>
In <code>users/views.py</code>:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">other imports</span>
<span style="color: #0000FF;">from</span> django.views.generic <span style="color: #0000FF;">import</span> CreateView, DetailView

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">other views</span>
<span style="color: #0000FF;">class</span> <span style="color: #6434A3;">ProfileDetailView</span>(DetailView):
    <span style="color: #BA36A5;">model</span> = User
    <span style="color: #BA36A5;">template_name</span> = <span style="color: #008000;">"profile_detail.html"</span>
</pre>
</div>

<p>
In <code>users/urls.py</code>:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">other imports</span>
<span style="color: #0000FF;">from</span> .views <span style="color: #0000FF;">import</span> Login, Logout, SignUpView, ProfileDetailView


<span style="color: #BA36A5;">urlpatterns</span> = [
    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">other paths</span>
    path(<span style="color: #008000;">"profile/@&lt;str:username&gt;"</span>, ProfileDetailView.as_view(), name=<span style="color: #008000;">"profile_detail"</span>),
]
</pre>
</div>

<p>
In the <code>templates</code> folder, create <code>profile_detail.html</code>:
</p>

<div class="org-src-container">
<pre class="src src-html">{% extends 'base.html' %}
{% block title %}
    &lt;<span style="color: #006699;">title</span>&gt;<span style="color: #000000; font-weight: bold; text-decoration: underline;">{{ profile.user.username }} - Conduit: Django + HTMX</span>&lt;/<span style="color: #006699;">title</span>&gt;
{% endblock %}
{% block content %}
    &lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"profile-page"</span>&gt;
        &lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"user-info"</span>&gt;
            &lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"container"</span>&gt;
                &lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"row"</span>&gt;
                    &lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"col-xs-12 col-md-10 offset-md-1"</span>&gt;
                        &lt;<span style="color: #006699;">img</span> <span style="color: #BA36A5;">src</span>=<span style="color: #008000;">"{{ profile.image }}"</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"user-img"</span> <span style="color: #BA36A5;">alt</span>=<span style="color: #008000;">"{{ profile.user.username }}"</span> /&gt;
                        &lt;<span style="color: #006699;">h4</span>&gt;<span style="text-decoration: underline;">{{ profile.user.username }}</span>&lt;/<span style="color: #006699;">h4</span>&gt;
                        &lt;<span style="color: #006699;">p</span>&gt;{{ profile.bio|default:"This user doesn't have a bio for now" }}&lt;/<span style="color: #006699;">p</span>&gt;
                    &lt;/<span style="color: #006699;">div</span>&gt;
                &lt;/<span style="color: #006699;">div</span>&gt;
            &lt;/<span style="color: #006699;">div</span>&gt;
        &lt;/<span style="color: #006699;">div</span>&gt;
    &lt;/<span style="color: #006699;">div</span>&gt;
{% endblock %}
</pre>
</div>

<p>
Everything should be working now, right? Let&rsquo;s check by going to <code>localhost:8000/profile/@admin</code>, for example.
Welp, we&rsquo;re getting an error:
</p>


<div id="orga48bb67" class="figure">
<p><img src="./assets/profile_detail - error.png" alt="profile_detail - error.png" width="600" />
</p>
<p><span class="figure-number">Figure 6: </span>profile_detail - error</p>
</div>

<p>
The error tells us that our <code>ProfileDetailView</code> wants to be called with an object primary key or a slug, while we&rsquo;re calling it with a <code>username</code>. The solution is simple: we just change how the view decides which objects to show.
</p>

<p>
We override the view&rsquo;s <code>get_object</code> method by adding the following to <code>users/views.py</code>:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">other imports</span>
<span style="color: #0000FF;">from</span> django.shortcuts <span style="color: #0000FF;">import</span> redirect, get_object_or_404

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">other views</span>
<span style="color: #0000FF;">class</span> <span style="color: #6434A3;">ProfileDetailView</span>(DetailView):
    <span style="color: #BA36A5;">model</span> = Profile
    <span style="color: #BA36A5;">template_name</span> = <span style="color: #008000;">"profile_detail.html"</span>

    <span style="color: #0000FF;">def</span> <span style="color: #006699;">get_object</span>(<span style="color: #0000FF;">self</span>, queryset=<span style="color: #D0372D;">None</span>):
        <span style="color: #BA36A5;">username</span> = <span style="color: #0000FF;">self</span>.kwargs.get(<span style="color: #008000;">"username"</span>, <span style="color: #D0372D;">None</span>)
        <span style="color: #BA36A5;">profile</span> = get_object_or_404(User, username=username).profile
        <span style="color: #0000FF;">return</span> profile
</pre>
</div>

<p>
Let&rsquo;s try again: we should see an actual profile page (though there isn&rsquo;t much on it yet). Make sure to set a profile image for your <code>admin</code> user, as everyone else should have a default already set.
</p>


<div id="orge80af46" class="figure">
<p><img src="./assets/profile_detail.png" alt="profile_detail.png" width="600" />
</p>
<p><span class="figure-number">Figure 7: </span>profile_detail</p>
</div>
</div>
</div>
<div id="outline-container-orgb57ac3b" class="outline-3">
<h3 id="orgb57ac3b"><span class="section-number-3">10.2.</span> Viewing Articles written by each User</h3>
<div class="outline-text-3" id="text-10-2">
<p>
Whenever we visit a user&rsquo;s profile, we want to see all the articles written by that specific user. We could make a <code>ListView</code>, but passing the list to our <code>DetailView</code>&rsquo;s context is simpler.
</p>

<p>
In <code>users/views.py</code>, override the <code>get_context_data</code> method of <code>ProfileDetailView</code>:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">other views</span>
<span style="color: #0000FF;">class</span> <span style="color: #6434A3;">ProfileDetailView</span>(DetailView):
    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">...</span>

    <span style="color: #0000FF;">def</span> <span style="color: #006699;">get_context_data</span>(<span style="color: #0000FF;">self</span>, **kwargs):
        <span style="color: #BA36A5;">context</span> = <span style="color: #006FE0;">super</span>().get_context_data(**kwargs)
        <span style="color: #0000FF;">if</span> <span style="color: #0000FF;">self</span>.request.user.is_authenticated:
            <span style="color: #BA36A5;">context</span>[<span style="color: #008000;">"my_articles"</span>] = <span style="color: #0000FF;">self</span>.<span style="color: #006FE0;">object</span>.articles.order_by(<span style="color: #008000;">'-created_at'</span>)
        <span style="color: #0000FF;">return</span> context
</pre>
</div>

<p>
This will return all the articles written by the user whose username is specified in the URL: for example, <code>/profile/@admin</code> will return all the articles written by <code>admin</code>. Technically, we could have obtained this queryset directly in the template with something like <code>{{ profile.articles.order_by|dictsortreversed:"created_at" }}</code>, but dealing with logic in views makes for clearer code and easier debugging.
</p>

<p>
Expose the <code>article_list.html</code> template in <code>templates/profile_detail.html</code>:
</p>

<div class="org-src-container">
<pre class="src src-html">{% extends 'base.html' %}
{% block title %}
    &lt;<span style="color: #006699;">title</span>&gt;<span style="color: #000000; font-weight: bold; text-decoration: underline;">{{ profile.user.username }} - Conduit: Django + HTMX</span>&lt;/<span style="color: #006699;">title</span>&gt;
{% endblock %}
{% block content %}
    &lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"profile-page"</span>&gt;
        &lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"user-info"</span>&gt;
            &lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"container"</span>&gt;
                &lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"row"</span>&gt;
                    &lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"col-xs-12 col-md-10 offset-md-1"</span>&gt;
                        &lt;<span style="color: #006699;">img</span> <span style="color: #BA36A5;">src</span>=<span style="color: #008000;">"{{ profile.image }}"</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"user-img"</span> <span style="color: #BA36A5;">alt</span>=<span style="color: #008000;">"{{ profile.user.username }}"</span> /&gt;
                        &lt;<span style="color: #006699;">h4</span>&gt;<span style="text-decoration: underline;">{{ profile.user.username }}</span>&lt;/<span style="color: #006699;">h4</span>&gt;
                        &lt;<span style="color: #006699;">p</span>&gt;{{ profile.bio|default:"This user doesn't have a bio for now" }}&lt;/<span style="color: #006699;">p</span>&gt;
                    &lt;/<span style="color: #006699;">div</span>&gt;
                &lt;/<span style="color: #006699;">div</span>&gt;
            &lt;/<span style="color: #006699;">div</span>&gt;
        &lt;/<span style="color: #006699;">div</span>&gt;
        &lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"container"</span>&gt;                 <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">new from here </span><span style="color: #8D8D84;">--&gt;</span>
            &lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"row"</span>&gt;
                &lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"col-xs-12 col-md-10 offset-md-1"</span>&gt;
                    &lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"articles-toggle"</span>&gt;
                        &lt;<span style="color: #006699;">ul</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"nav nav-pills outline-active"</span>&gt;
                            &lt;<span style="color: #006699;">li</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"nav-item"</span>&gt;
                                &lt;<span style="color: #006699;">span</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"nav-link"</span>&gt;
                                  My Articles
                                &lt;/<span style="color: #006699;">span</span>&gt;
                            &lt;/<span style="color: #006699;">li</span>&gt;
                        &lt;/<span style="color: #006699;">ul</span>&gt;
                    &lt;/<span style="color: #006699;">div</span>&gt;
                    {% include 'article_list.html' with articles=my_articles %}
                &lt;/<span style="color: #006699;">div</span>&gt;
            &lt;/<span style="color: #006699;">div</span>&gt;
        &lt;/<span style="color: #006699;">div</span>&gt;                                  <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">new to here </span><span style="color: #8D8D84;">--&gt;</span>
    &lt;/<span style="color: #006699;">div</span>&gt;
{% endblock %}
</pre>
</div>
</div>
</div>
<div id="outline-container-org22a5162" class="outline-3">
<h3 id="org22a5162"><span class="section-number-3">10.3.</span> Links to Profiles in templates</h3>
<div class="outline-text-3" id="text-10-3">
<p>
We now need to link the profile page from all the places our users&rsquo; usernames are exposed.
</p>

<p>
In <code>templates/article_preview.html</code>, change the following lines:
</p>

<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"article-meta"</span>&gt;
  &lt;<span style="color: #006699;">a</span> <span style="color: #BA36A5;">href</span>=<span style="color: #008000;">"{% url 'profile_detail' username=article.author.user.username %}"</span>&gt;                    <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">new </span><span style="color: #8D8D84;">--&gt;</span>
    &lt;<span style="color: #006699;">img</span> <span style="color: #BA36A5;">src</span>=<span style="color: #008000;">"{{ article.author.image }}"</span> <span style="color: #BA36A5;">alt</span>=<span style="color: #008000;">"{{ article.author.user.username }}"</span>/&gt;           <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">new </span><span style="color: #8D8D84;">--&gt;</span>
  &lt;/<span style="color: #006699;">a</span>&gt;                                                                                           <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">new </span><span style="color: #8D8D84;">--&gt;</span>
  &lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"info"</span>&gt;
    &lt;<span style="color: #006699;">a</span> <span style="color: #BA36A5;">href</span>=<span style="color: #008000;">"{% url 'profile_detail' username=article.author.user.username %}"</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"author"</span>&gt; <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">from &lt;span class="author"&gt; </span><span style="color: #8D8D84;">--&gt;</span>
        {{ article.author.user.username }}
    &lt;/<span style="color: #006699;">a</span>&gt;                                                                                       <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">from &lt;/span&gt; </span><span style="color: #8D8D84;">--&gt;</span>
    &lt;<span style="color: #006699;">span</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"date"</span>&gt;
      {{ article.created_at|date:"D M d Y" }}
    &lt;/<span style="color: #006699;">span</span>&gt;
  &lt;/<span style="color: #006699;">div</span>&gt;
&lt;/<span style="color: #006699;">div</span>&gt;
</pre>
</div>

<p>
In <code>templates/nav.html</code>:
</p>

<div class="org-src-container">
<pre class="src src-html">{% if user.is_authenticated %}
  &lt;<span style="color: #006699;">li</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"nav-item"</span>&gt;
    {% url 'editor_create' as editor_create %}
    &lt;<span style="color: #006699;">a</span>
      <span style="color: #BA36A5;">href</span>=<span style="color: #008000;">"{{ editor_create }}"</span>
      <span style="color: #BA36A5;">rel</span>=<span style="color: #008000;">"prefetch"</span>
      <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"nav-link</span>
<span style="color: #008000;">             {% if request.path == editor_create %}active{% endif %}"</span>
    &gt;
      &lt;<span style="color: #006699;">span</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"ion-compose"</span>&gt; New Post &lt;/<span style="color: #006699;">span</span>&gt;
    &lt;/<span style="color: #006699;">a</span>&gt;
  &lt;/<span style="color: #006699;">li</span>&gt;
  &lt;<span style="color: #006699;">li</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"nav-item"</span>&gt;                             <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">new from here </span><span style="color: #8D8D84;">--&gt;</span>
    {% url 'profile_detail' username=user.username as profile %}
    &lt;<span style="color: #006699;">a</span>
      <span style="color: #BA36A5;">href</span>=<span style="color: #008000;">"{{ profile }}"</span>
      <span style="color: #BA36A5;">rel</span>=<span style="color: #008000;">"prefetch"</span>
      <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"nav-link</span>
<span style="color: #008000;">             {% if request.path == profile %}active{% endif %}"</span>
    &gt;
      &lt;<span style="color: #006699;">img</span> <span style="color: #BA36A5;">src</span>=<span style="color: #008000;">"{{ user.profile.image }}"</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"user-pic"</span> <span style="color: #BA36A5;">alt</span>=<span style="color: #008000;">"{{ user.username }}"</span>&gt;
      {{ user.username }}
    &lt;/<span style="color: #006699;">a</span>&gt;
  &lt;/<span style="color: #006699;">li</span>&gt;                                             <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">new to here </span><span style="color: #8D8D84;">--&gt;</span>
  &lt;<span style="color: #006699;">li</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"nav-item"</span>&gt;
    &lt;<span style="color: #006699;">a</span> <span style="color: #BA36A5;">rel</span>=<span style="color: #008000;">"prefetch"</span> <span style="color: #BA36A5;">href</span>=<span style="color: #008000;">"{% url 'logout' %}"</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"nav-link"</span>&gt;
      &lt;<span style="color: #006699;">span</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"ion-log-out"</span>&gt;&lt;/<span style="color: #006699;">span</span>&gt;
    &lt;/<span style="color: #006699;">a</span>&gt;
  &lt;/<span style="color: #006699;">li</span>&gt;
{% else %}
</pre>
</div>

<p>
In <code>templates/article_detail.html</code>:
</p>

<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"article-meta"</span>&gt;
  &lt;<span style="color: #006699;">a</span> <span style="color: #BA36A5;">href</span>=<span style="color: #008000;">"{% url 'profile_detail' username=article.author.user.username %}"</span>&gt;                  <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">new </span><span style="color: #8D8D84;">--&gt;</span>
    &lt;<span style="color: #006699;">img</span> <span style="color: #BA36A5;">src</span>=<span style="color: #008000;">"{{ article.author.image }}"</span> <span style="color: #BA36A5;">alt</span>=<span style="color: #008000;">"{{ article.author.user.username }}"</span>/&gt;           <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">new </span><span style="color: #8D8D84;">--&gt;</span>
  &lt;/<span style="color: #006699;">a</span>&gt;                                                                                         <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">new </span><span style="color: #8D8D84;">--&gt;</span>
  &lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"info"</span>&gt;
    &lt;<span style="color: #006699;">a</span> <span style="color: #BA36A5;">href</span>=<span style="color: #008000;">"{% url 'profile_detail' username=article.author.user.username %}"</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"author"</span>&gt; <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">from &lt;span class="author"&gt; </span><span style="color: #8D8D84;">--&gt;</span>
      {{ article.author.user.username }}
    &lt;/<span style="color: #006699;">a</span>&gt;                                                                                       <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">from &lt;/span&gt; </span><span style="color: #8D8D84;">--&gt;</span>
    &lt;<span style="color: #006699;">span</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"date"</span>&gt;
      {{ article.created_at|date:"D M d Y" }}
    &lt;/<span style="color: #006699;">span</span>&gt;
  &lt;/<span style="color: #006699;">div</span>&gt;
</pre>
</div>

<p>
In <code>templates/comments.html</code>:
</p>

<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"card-footer"</span>&gt;
  &lt;<span style="color: #006699;">a</span> <span style="color: #BA36A5;">href</span>=<span style="color: #008000;">"{% url 'profile_detail' username=comment.author.user.username %}"</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"comment-author"</span>&gt;            <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">new </span><span style="color: #8D8D84;">--&gt;</span>
    &lt;<span style="color: #006699;">img</span> <span style="color: #BA36A5;">src</span>=<span style="color: #008000;">"{{ comment.author.image }}"</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"comment-author-img"</span> <span style="color: #BA36A5;">alt</span>=<span style="color: #008000;">"{{ comment.author.user.username }}"</span>/&gt; <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">new </span><span style="color: #8D8D84;">--&gt;</span>
  &lt;/<span style="color: #006699;">a</span>&gt;                                                                                                          <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">new </span><span style="color: #8D8D84;">--&gt;</span>
  &lt;<span style="color: #006699;">a</span> <span style="color: #BA36A5;">href</span>=<span style="color: #008000;">"{% url 'profile_detail' username=comment.author.user.username %}"</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"comment-author"</span>&gt; <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">from &lt;span class="comment-author"&gt; </span><span style="color: #8D8D84;">--&gt;</span>
      {{ comment.author.user.username }}
  &lt;/<span style="color: #006699;">a</span>&gt;                                                                                               <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">from &lt;/span&gt;</span><span style="color: #8D8D84;">--&gt;</span>
  &lt;<span style="color: #006699;">span</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"date-posted"</span>&gt;
    {{ comment.created_at|date:"D M d Y" }}
  &lt;/<span style="color: #006699;">span</span>&gt;
  {% include 'comment_delete.html' %}
&lt;/<span style="color: #006699;">div</span>&gt;
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org6e57854" class="outline-2">
<h2 id="org6e57854"><span class="section-number-2">11.</span> Editing profiles</h2>
<div class="outline-text-2" id="text-11">
</div>
<div id="outline-container-orgffb5659" class="outline-3">
<h3 id="orgffb5659"><span class="section-number-3">11.1.</span> Introduction</h3>
<div class="outline-text-3" id="text-11-1">
<p>
We want to allow users to modify their profile information (image, bio) and user information (username, email, password) at the same place. That is, we want to allow users to update 2 models at the same URL. Surprisingly, this common use case is not straightforward to implement with Django, especially if we&rsquo;re trying to follow good practice and use class-based views. Take a break before continuing, as we&rsquo;re going to go into the weeds here.
</p>

<p>
Cool, let&rsquo;s recap what we&rsquo;re doing.
We have two models (<code>User</code> and <code>Profile</code>), which happen to be related with a <code>OneToOneField</code>.
We want to update these models in one place. Intuitively, we&rsquo;ll reach for the <code>UpdateView</code>. The problem is that <code>UpdateView</code> expects a single model. The solution is to tell our <code>UpdateView</code> to deal with two forms.
</p>
</div>
</div>
<div id="outline-container-org2f7b110" class="outline-3">
<h3 id="org2f7b110"><span class="section-number-3">11.2.</span> Forms</h3>
<div class="outline-text-3" id="text-11-2">
<p>
Let&rsquo;s create <code>users/forms.py</code> and define two forms, one for each model:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #0000FF;">from</span> django <span style="color: #0000FF;">import</span> forms
<span style="color: #0000FF;">from</span> .models <span style="color: #0000FF;">import</span> Profile, User


<span style="color: #0000FF;">class</span> <span style="color: #6434A3;">ProfileForm</span>(forms.ModelForm):
    <span style="color: #0000FF;">class</span> <span style="color: #6434A3;">Meta</span>:
        <span style="color: #BA36A5;">model</span> = Profile
        <span style="color: #BA36A5;">fields</span> = [<span style="color: #008000;">"image"</span>, <span style="color: #008000;">"bio"</span>]


<span style="color: #0000FF;">class</span> <span style="color: #6434A3;">UserForm</span>(forms.ModelForm):
    <span style="color: #BA36A5;">new_password</span> = forms.CharField(required=<span style="color: #D0372D;">False</span>)

    <span style="color: #0000FF;">class</span> <span style="color: #6434A3;">Meta</span>:
        <span style="color: #BA36A5;">model</span> = User
        <span style="color: #BA36A5;">fields</span> = [<span style="color: #008000;">"username"</span>, <span style="color: #008000;">"email"</span>, <span style="color: #008000;">"new_password"</span>]

    <span style="color: #0000FF;">def</span> <span style="color: #006699;">save</span>(<span style="color: #0000FF;">self</span>, commit=<span style="color: #D0372D;">True</span>):
        <span style="color: #BA36A5;">user</span> = <span style="color: #006FE0;">super</span>().save(commit=<span style="color: #D0372D;">False</span>)
        <span style="color: #BA36A5;">new_password</span> = <span style="color: #0000FF;">self</span>.cleaned_data.get(<span style="color: #008000;">"new_password"</span>)
        <span style="color: #0000FF;">if</span> new_password:
            user.set_password(new_password)
        user.save()
        <span style="color: #0000FF;">return</span> user
</pre>
</div>

<p>
<a href="https://docs.djangoproject.com/en/4.0/topics/forms/modelforms/"><code>ModelForm</code></a> allows to get a lot of model-relevant form logic for free (Django&rsquo;s &ldquo;batteries included&rdquo; philosophy).
</p>

<p>
The <code>ProfileForm</code> is self-explanatory.
</p>

<p>
The <code>UserForm</code> is a bit more complicated. Let&rsquo;s go through it in detail.
We want to our user to be able to update three types of information: the username, the email, and the password. We also want to expose the current username and email values in the template, but we don&rsquo;t want to expose any information about the password. The screenshot below clarifies what we mean here: the screenshot on the right could leak information about the number of characters in our user&rsquo;s password, even though the characters themselves are masked, while the screenshot on the right exposes no information about the password.
</p>


<div id="org6c1c628" class="figure">
<p><img src="./assets/settings - password field.png" alt="settings - password field.png" width="200" />
</p>
<p><span class="figure-number">Figure 8: </span>settings - password field with masked characters</p>
</div>


<div id="org8ce8991" class="figure">
<p><img src="./assets/settings.png" alt="settings.png" width="200" />
</p>
<p><span class="figure-number">Figure 9: </span>settings - empty password field</p>
</div>

<p>
We want the password field in our future template to be empty, and we don&rsquo;t want to force the user to type it out every time they want to modify some other information. In other words, we want the password field to be optional, ie <code>required=False</code>.
Furthermore, since this password field doesn&rsquo;t need any information about the current password, we can just create a dummy <code>new_password</code> field, instead of linking our form to the <code>User</code> model&rsquo;s actual <code>password</code> attribute.
Finally, when we save the form, we only want to update the password if the user has actually changed it on the form, so we need to override the form&rsquo;s <code>save</code> method. Also, because Django saves hashes of passwords, instead of the raw password strings, in its database, we need to use the <code>User</code> object&rsquo;s <code>set_password</code> method, which takes care of the password hashing.
</p>
</div>
</div>
<div id="outline-container-orgb53a886" class="outline-3">
<h3 id="orgb53a886"><span class="section-number-3">11.3.</span> Views</h3>
<div class="outline-text-3" id="text-11-3">
<p>
Now that our forms are ready, let&rsquo;s create the view. As we said earlier, the intuitive choice here is the generic <code>UpdateView</code> class-based view.
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">other imports</span>
<span style="color: #0000FF;">from</span> django.views.generic <span style="color: #0000FF;">import</span> CreateView, DetailView, UpdateView
<span style="color: #0000FF;">from</span> django.contrib.auth.mixins <span style="color: #0000FF;">import</span> LoginRequiredMixin

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">other classes</span>
<span style="color: #0000FF;">class</span> <span style="color: #6434A3;">ProfileUpdateView</span>(LoginRequiredMixin, UpdateView):
    <span style="color: #BA36A5;">form_class</span> = ProfileForm
    <span style="color: #BA36A5;">template_name</span> = <span style="color: #008000;">"settings.html"</span>
    <span style="color: #BA36A5;">success_url</span> = reverse_lazy(<span style="color: #008000;">"settings"</span>)

    <span style="color: #0000FF;">def</span> <span style="color: #006699;">get_object</span>(<span style="color: #0000FF;">self</span>, queryset=<span style="color: #D0372D;">None</span>):
        <span style="color: #0000FF;">return</span> <span style="color: #0000FF;">self</span>.request.user.profile

    <span style="color: #0000FF;">def</span> <span style="color: #006699;">get_context_data</span>(<span style="color: #0000FF;">self</span>, **kwargs):
        <span style="color: #BA36A5;">context</span> = <span style="color: #006FE0;">super</span>().get_context_data(**kwargs)
        <span style="color: #BA36A5;">context</span>[<span style="color: #008000;">"user_form"</span>] = UserForm(instance=<span style="color: #0000FF;">self</span>.request.user)
        <span style="color: #0000FF;">return</span> context

    <span style="color: #0000FF;">def</span> <span style="color: #006699;">post</span>(<span style="color: #0000FF;">self</span>, request, *args, **kwargs):
        <span style="color: #BA36A5;">profile_form</span> = <span style="color: #0000FF;">self</span>.form_class(request.POST, instance=request.user.profile)
        <span style="color: #BA36A5;">user_form</span> = UserForm(request.POST, instance=request.user)
        <span style="color: #0000FF;">if</span> profile_form.is_valid() <span style="color: #0000FF;">and</span> user_form.is_valid():
            profile_form.save()
            user_form.save()
            <span style="color: #0000FF;">return</span> redirect(<span style="color: #0000FF;">self</span>.success_url)
        <span style="color: #0000FF;">return</span> <span style="color: #006FE0;">super</span>().post(request, *args, **kwargs)
</pre>
</div>

<p>
Again, this is a significant amount of code, so let&rsquo;s go through it slowly.
</p>

<p>
Only logged-in users should be able to edit their profile information, hence the <code>LoginRequiredMixin</code>.
</p>

<p>
<code>UpdateView</code> expects to deal with a single form by default, and every form requires a queryset, and some explicitly-defined <code>fields</code> or <code>form_class</code>. However, we want our <code>UpdateView</code> to deal with 2 forms: we will pass one form to the view in the way it expects, and the other we will pass as extra context data.
We tell our <code>UpdateView</code> that its (official) form will be of the class <code>ProfileForm</code> and that its queryset will be a single instance of the <code>Profile</code> model: namely, the users will only be able to update their own profile (hence the <code>get_object</code> override).
The additional form that <code>ProfileUpdateView</code> needs to deal with will be of class <code>UserForm</code> and will have <code>self.request.user</code> as its queryset. We also tell <code>ProfileUpdateView</code> that we&rsquo;ll want to refer to this form by <code>user_form</code> in our template.
Finally, we need to process the two forms, which means that we need to override <code>UpdateView</code>&rsquo;s <code>post</code> method. We take our whole <code>POST</code> request and run it through both <code>ProfileForm</code> and <code>UserForm</code>: this means that we let the forms take in the whole of the data, pick what they need (ie what corresponds to their fields), and apply it to the relevant objects. If our forms are valid, we can save the information. Otherwise, we reject the input (and re-render everything with relevant error information).
</p>
</div>
</div>
<div id="outline-container-orgdfad997" class="outline-3">
<h3 id="orgdfad997"><span class="section-number-3">11.4.</span> Templates</h3>
<div class="outline-text-3" id="text-11-4">
<p>
In <code>templates/settings.html</code>:
</p>

<div class="org-src-container">
<pre class="src src-html">{% extends 'base.html' %}
{% block title %}
  &lt;<span style="color: #006699;">title</span>&gt;<span style="color: #000000; font-weight: bold; text-decoration: underline;">Settings - Conduit</span>&lt;/<span style="color: #006699;">title</span>&gt;
{% endblock %}
{% block content %}
  &lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"settings-page"</span>&gt;
    &lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"container page"</span>&gt;
      &lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"row"</span>&gt;
        &lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"col-md-6 offset-md-3 col-xs-12"</span>&gt;
          &lt;<span style="color: #006699;">h1</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"text-xs-center"</span>&gt;<span style="color: #000000; font-weight: bold; text-decoration: underline;">Your Settings</span>&lt;/<span style="color: #006699;">h1</span>&gt;
          &lt;<span style="color: #006699;">form</span> <span style="color: #BA36A5;">method</span>=<span style="color: #008000;">"post"</span>&gt;
            {% csrf_token %}
            &lt;<span style="color: #006699;">fieldset</span>&gt;
              &lt;<span style="color: #006699;">fieldset</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"form-group"</span>&gt;
                &lt;<span style="color: #006699;">input</span>
                  <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"form-control"</span>
                  <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"text"</span>
                  <span style="color: #BA36A5;">placeholder</span>=<span style="color: #008000;">"URL of profile picture"</span>
                  <span style="color: #BA36A5;">name</span>=<span style="color: #008000;">"{{ form.image.name }}"</span>
                  <span style="color: #BA36A5;">value</span>=<span style="color: #008000;">"{{ form.image.value|default_if_none:'' }}"</span>
                /&gt;
              &lt;/<span style="color: #006699;">fieldset</span>&gt;
              {{ form.image.errors }}
              &lt;<span style="color: #006699;">fieldset</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"form-group"</span>&gt;
                &lt;<span style="color: #006699;">input</span>
                  <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"form-control form-control-lg"</span>
                  <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"text"</span>
                  required
                  <span style="color: #BA36A5;">placeholder</span>=<span style="color: #008000;">"Username"</span>
                  <span style="color: #BA36A5;">name</span>=<span style="color: #008000;">"{{ user_form.username.name }}"</span>
                  <span style="color: #BA36A5;">value</span>=<span style="color: #008000;">"{{  user_form.username.value|default_if_none:'' }}"</span>
                /&gt;
              &lt;/<span style="color: #006699;">fieldset</span>&gt;
              {{ user_form.username.errors }}
              &lt;<span style="color: #006699;">fieldset</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"form-group"</span>&gt;
                &lt;<span style="color: #006699;">textarea</span>
                  <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"form-control form-control-lg"</span>
                  <span style="color: #BA36A5;">rows</span>=<span style="color: #008000;">"8"</span>
                  <span style="color: #BA36A5;">placeholder</span>=<span style="color: #008000;">"Short bio about you"</span>
                  <span style="color: #BA36A5;">name</span>=<span style="color: #008000;">"{{ form.bio.name }}"</span>
                &gt;{{ form.bio.value|default_if_none:'' }}&lt;/<span style="color: #006699;">textarea</span>&gt;
              &lt;/<span style="color: #006699;">fieldset</span>&gt;
              {{ form.bio.errors }}
              &lt;<span style="color: #006699;">fieldset</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"form-group"</span>&gt;
                &lt;<span style="color: #006699;">input</span>
                  <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"form-control form-control-lg"</span>
                  <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"email"</span>
                  <span style="color: #BA36A5;">placeholder</span>=<span style="color: #008000;">"Email"</span>
                  required
                  <span style="color: #BA36A5;">name</span>=<span style="color: #008000;">"{{ user_form.email.name }}"</span>
                  <span style="color: #BA36A5;">value</span>=<span style="color: #008000;">"{{ user_form.email.value|default_if_none:'' }}"</span>
                /&gt;
              &lt;/<span style="color: #006699;">fieldset</span>&gt;
              {{ user_form.email.errors }}
              &lt;<span style="color: #006699;">fieldset</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"form-group"</span>&gt;
                &lt;<span style="color: #006699;">input</span>
                  <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"form-control form-control-lg"</span>
                  <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"password"</span>
                  <span style="color: #BA36A5;">placeholder</span>=<span style="color: #008000;">"New Password"</span>
                  <span style="color: #BA36A5;">name</span>=<span style="color: #008000;">"{{ user_form.new_password.name }}"</span>
                /&gt;
              &lt;/<span style="color: #006699;">fieldset</span>&gt;
              {{ user_form.new_password.errors }}
              &lt;<span style="color: #006699;">button</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"btn btn-lg btn-primary pull-xs-right"</span> <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"submit"</span>&gt;
                Update Settings
              &lt;/<span style="color: #006699;">button</span>&gt;
            &lt;/<span style="color: #006699;">fieldset</span>&gt;
          &lt;/<span style="color: #006699;">form</span>&gt;
          &lt;<span style="color: #006699;">hr</span> /&gt;
          &lt;<span style="color: #006699;">a</span> <span style="color: #BA36A5;">href</span>=<span style="color: #008000;">"{% url 'logout' %}"</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"btn btn-outline-danger"</span>&gt;
            Or click here to logout.
          &lt;/<span style="color: #006699;">a</span>&gt;
        &lt;/<span style="color: #006699;">div</span>&gt;
      &lt;/<span style="color: #006699;">div</span>&gt;
    &lt;/<span style="color: #006699;">div</span>&gt;
  &lt;/<span style="color: #006699;">div</span>&gt;
{% endblock %}
</pre>
</div>

<p>
The template is quite simple, for a change: we refer to the <code>ProfileUpdateView</code>&rsquo;s main form by <code>form</code>, and to the additional form by <code>user_form</code>.
</p>

<p>
Finally, let&rsquo;s specify a URL to <code>settings</code> and add a link in the navbar and in each individual profile.
</p>

<p>
In <code>users/urls.py</code>:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">other imports</span>
<span style="color: #0000FF;">from</span> .views <span style="color: #0000FF;">import</span> Login, Logout, SignUpView, ProfileDetailView, ProfileUpdateView


<span style="color: #BA36A5;">urlpatterns</span> = [
    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">other paths</span>
    path(<span style="color: #008000;">"settings/"</span>, ProfileUpdateView.as_view(), name=<span style="color: #008000;">"settings"</span>),
]
</pre>
</div>

<p>
In <code>templates/nav.html</code>:
</p>

<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #006699;">li</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"nav-item"</span>&gt;
  &lt;<span style="color: #006699;">a</span> <span style="color: #BA36A5;">rel</span>=<span style="color: #008000;">"prefetch"</span> <span style="color: #BA36A5;">href</span>=<span style="color: #008000;">"{% url 'editor_create' %}"</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"nav-link"</span>&gt;
    &lt;<span style="color: #006699;">span</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"ion-compose"</span>&gt; New Post &lt;/<span style="color: #006699;">span</span>&gt;
  &lt;/<span style="color: #006699;">a</span>&gt;
&lt;/<span style="color: #006699;">li</span>&gt;
&lt;<span style="color: #006699;">li</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"nav-item"</span>&gt;
  {% url 'settings' as settings %}
  &lt;<span style="color: #006699;">a</span>
    <span style="color: #BA36A5;">href</span>=<span style="color: #008000;">"{{ settings }}"</span>
    <span style="color: #BA36A5;">rel</span>=<span style="color: #008000;">"prefetch"</span>
    <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"nav-link</span>
<span style="color: #008000;">           {% if request.path == settings %}active{% endif %}"</span>
  &gt;
    &lt;<span style="color: #006699;">span</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"ion-gear-a"</span>&gt; Settings &lt;/<span style="color: #006699;">span</span>&gt;
  &lt;/<span style="color: #006699;">a</span>&gt;
&lt;/<span style="color: #006699;">li</span>&gt;
&lt;<span style="color: #006699;">li</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"nav-item"</span>&gt;
  &lt;<span style="color: #006699;">a</span> <span style="color: #BA36A5;">rel</span>=<span style="color: #008000;">"prefetch"</span> <span style="color: #BA36A5;">href</span>=<span style="color: #008000;">"{% url 'profile_detail' username=user.username %}"</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"nav-link"</span>&gt;
    &lt;<span style="color: #006699;">img</span> <span style="color: #BA36A5;">src</span>=<span style="color: #008000;">"{{ user.profile.image }}"</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"user-pic"</span> <span style="color: #BA36A5;">alt</span>=<span style="color: #008000;">"{{ user.username }}"</span>&gt;
    {{ user.username }}
  &lt;/<span style="color: #006699;">a</span>&gt;
&lt;/<span style="color: #006699;">li</span>&gt;
</pre>
</div>

<p>
In <code>templates/profile_detail.html</code>:
</p>

<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"col-xs-12 col-md-10 offset-md-1"</span>&gt;
  &lt;<span style="color: #006699;">img</span> <span style="color: #BA36A5;">src</span>=<span style="color: #008000;">"{{ profile.image }}"</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"user-img"</span> <span style="color: #BA36A5;">alt</span>=<span style="color: #008000;">"{{ profile.user.username }}"</span> /&gt;
  &lt;<span style="color: #006699;">h4</span>&gt;<span style="text-decoration: underline;">{{ profile.user.username }}</span>&lt;/<span style="color: #006699;">h4</span>&gt;
  &lt;<span style="color: #006699;">p</span>&gt;{{ profile.bio|default:"This user doesn't have a bio for now" }}&lt;/<span style="color: #006699;">p</span>&gt;
  {% if user.username == profile.user.username %}   <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">new from here </span><span style="color: #8D8D84;">--&gt;</span>
    &lt;<span style="color: #006699;">a</span>
      <span style="color: #BA36A5;">href</span>=<span style="color: #008000;">"{% url 'settings' %}"</span>
      <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"btn btn-sm btn-outline-secondary action-btn"</span>
    &gt;
      &lt;<span style="color: #006699;">span</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"ion-gear-a"</span>&gt;
        Edit Profile Settings
      &lt;/<span style="color: #006699;">span</span>&gt;
    &lt;/<span style="color: #006699;">a</span>&gt;
  {% endif %}                                       <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">new to here </span><span style="color: #8D8D84;">--&gt;</span>
&lt;/<span style="color: #006699;">div</span>&gt;
</pre>
</div>

<p>
We should add that all of this would have been much easier if we had a single model dealing with <code>User</code> and <code>Profile</code> information, instead of separating the two (as we could have kept a generic <code>UpdateView</code>), but that would have gone against best practice.
Similarly, our task would have been simplified if <code>User</code> and <code>Profile</code> were related through a <code>ForeignKey</code> (as we could have used <a href="https://docs.djangoproject.com/en/4.0/topics/forms/modelforms/#inline-formsets">inline formsets</a>), but that would have gone against common patterns in Django.
</p>
</div>
</div>
</div>
<div id="outline-container-orgc898d7f" class="outline-2">
<h2 id="orgc898d7f"><span class="section-number-2">12.</span> Follows</h2>
<div class="outline-text-2" id="text-12">
</div>
<div id="outline-container-orga623f5d" class="outline-3">
<h3 id="orga623f5d"><span class="section-number-3">12.1.</span> Creating a few new users and articles</h3>
<div class="outline-text-3" id="text-12-1">
<p>
To make the following sections more interesting, let&rsquo;s create a new users and posts. Run Django shell with <code>(django) django_tutorial$ python manage.py shell</code> and then paste the following into your shell (no need to clean it):
</p>

<div class="org-src-container">
<pre class="src src-python">In [<span style="color: #D0372D;">1</span>]: <span style="color: #0000FF;">from</span> conduit.users.models <span style="color: #0000FF;">import</span> Profile, User
In [<span style="color: #D0372D;">2</span>]: <span style="color: #0000FF;">from</span> conduit.articles.models <span style="color: #0000FF;">import</span> Article
In [<span style="color: #D0372D;">3</span>]: <span style="color: #0000FF;">from</span> faker <span style="color: #0000FF;">import</span> Faker
In [<span style="color: #D0372D;">4</span>]: <span style="color: #BA36A5;">fake</span> = Faker()
In [<span style="color: #D0372D;">5</span>]: fake.seed_instance(<span style="color: #D0372D;">42</span>)
In [<span style="color: #D0372D;">6</span>]: <span style="color: #0000FF;">for</span> i <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">range</span>(<span style="color: #D0372D;">2</span>):
   ...:     <span style="color: #BA36A5;">user</span> = User.objects.create_user(username=fake.user_name(), email=fake.email(), password=fake.password())
   ...:     <span style="color: #BA36A5;">profile</span> = user.profile
   ...:     <span style="color: #BA36A5;">profile.image</span> = fake.image_url(<span style="color: #D0372D;">600</span>, <span style="color: #D0372D;">600</span>)
   ...:     <span style="color: #BA36A5;">profile.bio</span> = fake.text()
   ...:     user.save()
   ...:     <span style="color: #0000FF;">for</span> j <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">range</span>(<span style="color: #D0372D;">2</span>):
   ...:         Article.objects.create(
   ...:             author=Profile.objects.last(),
   ...:             title=fake.sentence(),
   ...:             description=fake.paragraph(),
   ...:             body=fake.text()
   ...:         )
   ...:
In [<span style="color: #D0372D;">7</span>]: User.objects.get(username=<span style="color: #008000;">'admin'</span>).profile.follow(Profile.objects.last())
</pre>
</div>

<p>
This will create 2 users with full profiles and a couple articles each.
</p>
</div>
</div>
<div id="outline-container-orgd3c1870" class="outline-3">
<h3 id="orgd3c1870"><span class="section-number-3">12.2.</span> Model</h3>
<div class="outline-text-3" id="text-12-2">
<p>
We&rsquo;ll now let our users follow other users, ie subscribe to other users&rsquo; articles. This should be a relationship between <code>Profile</code> objects, where one <code>Profile</code> object can follow, and be followed by, many other <code>Profile</code> objects: we&rsquo;ll use a <a href="https://docs.djangoproject.com/en/4.0/ref/models/fields/#django.db.models.ManyToManyField"><code>ManyToManyField</code></a> relationship.
</p>

<p>
We need a new field in our <code>Profile</code> model in <code>users/models.py</code>:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">other models</span>
<span style="color: #0000FF;">class</span> <span style="color: #6434A3;">Profile</span>(models.Model):
    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">...</span>
    <span style="color: #BA36A5;">follows</span> = models.ManyToManyField(
        <span style="color: #008000;">"self"</span>, related_name=<span style="color: #008000;">"followed_by"</span>, symmetrical=<span style="color: #D0372D;">False</span>, blank=<span style="color: #D0372D;">True</span>
    )
    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">...</span>
</pre>
</div>

<p>
The args we pass to the <code>ManyToManyField</code> signify that the relationship works between <code>Profile</code> objects, that we can get the <code>Profile</code> objects followed by a given <code>Profile</code> with the <code>follows</code> attribute, that we can know who&rsquo;s following a given <code>Profile</code> with the <code>followed_by</code> attribute, and that follows are a one-way relationship (it&rsquo;s not because User A follows User B that User B necessarily follows User A).
</p>

<p>
We also need to define a few methods that will be helpful later on. In <code>users/models.py</code>:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #0000FF;">class</span> <span style="color: #6434A3;">Profile</span>(models.Model):
    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">...</span>
    <span style="color: #0000FF;">def</span> <span style="color: #006699;">follow</span>(<span style="color: #0000FF;">self</span>, profile):
        <span style="color: #036A07;">"""Follow `profile`"""</span>
        <span style="color: #0000FF;">self</span>.follows.add(profile)

    <span style="color: #0000FF;">def</span> <span style="color: #006699;">unfollow</span>(<span style="color: #0000FF;">self</span>, profile):
        <span style="color: #036A07;">"""Unfollow `profile`"""</span>
        <span style="color: #0000FF;">self</span>.follows.remove(profile)

    <span style="color: #0000FF;">def</span> <span style="color: #006699;">is_following</span>(<span style="color: #0000FF;">self</span>, profile):
        <span style="color: #036A07;">"""Return True if `profile` is in self.follows, False otherwise"""</span>
        <span style="color: #0000FF;">return</span> <span style="color: #0000FF;">self</span>.follows.<span style="color: #006FE0;">filter</span>(pk=profile.pk).exists()
</pre>
</div>

<p>
Let&rsquo;s <code>makemigrations</code> and <code>migrate</code>, since we have modified the model.
</p>

<div class="org-src-container">
<pre class="src src-shell">(django) django_tutorial$ python manage.py makemigrations
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">...</span>
(django) django_tutorial$ python manage.py migrate
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">...</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgd1c4a48" class="outline-3">
<h3 id="orgd1c4a48"><span class="section-number-3">12.3.</span> ProfileDetailView</h3>
<div class="outline-text-3" id="text-12-3">
<p>
We need to let users to follow or unfollow other users in our templates. This involves some work around checking whether the user is already in our <code>follows</code> or not.
Because the Django Template Language (intentionally) makes it difficult to write non-trivial queries within templates, we&rsquo;ll have to do some groundwork in our views, with the help of the model methods we just created.
</p>

<p>
In <code>users/views.py</code>, we add <code>is_following</code> to the context of <code>ProfileDetailView</code> to enable our template to know whether the authenticated user follows a given profile:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #0000FF;">class</span> <span style="color: #6434A3;">ProfileDetailView</span>(DetailView):
    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">...</span>
    <span style="color: #0000FF;">def</span> <span style="color: #006699;">get_context_data</span>(<span style="color: #0000FF;">self</span>, **kwargs):
        <span style="color: #BA36A5;">context</span> = <span style="color: #006FE0;">super</span>().get_context_data(**kwargs)
        <span style="color: #0000FF;">if</span> <span style="color: #0000FF;">self</span>.request.user.is_authenticated:
            <span style="color: #BA36A5;">context</span>[<span style="color: #008000;">"my_articles"</span>] = <span style="color: #0000FF;">self</span>.<span style="color: #006FE0;">object</span>.articles.order_by(<span style="color: #008000;">'-created_at'</span>)
            <span style="color: #BA36A5;">context</span>[<span style="color: #008000;">"is_following"</span>] = <span style="color: #0000FF;">self</span>.<span style="color: #006FE0;">object</span>.is_following(<span style="color: #0000FF;">self</span>.<span style="color: #006FE0;">object</span>)     <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">new</span>
        <span style="color: #0000FF;">return</span> context
</pre>
</div>

<p>
Still in <code>users/views.py</code>, we add a RedirectView whose only purpose is to follow or unfollow a profile, depending on whether or not the profile is followed already.
</p>

<p>
In <code>users/urls.py</code>:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">other imports</span>
<span style="color: #0000FF;">from</span> .views <span style="color: #0000FF;">import</span> (
    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">...</span>
    ProfileFollowView,
)


<span style="color: #BA36A5;">urlpatterns</span> = [
    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">other paths</span>
    path(
        <span style="color: #008000;">"profile/@&lt;str:username&gt;/follow"</span>,
        ProfileFollowView.as_view(),
        name=<span style="color: #008000;">"profile_follow"</span>,
    ),
]
</pre>
</div>

<p>
Let&rsquo;s implement the <code>follow</code> functionality in <code>templates/profile_detail.html</code> now:
</p>

<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"col-xs-12 col-md-10 offset-md-1"</span>&gt;
  &lt;<span style="color: #006699;">img</span> <span style="color: #BA36A5;">src</span>=<span style="color: #008000;">"{{ profile.image }}"</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"user-img"</span> <span style="color: #BA36A5;">alt</span>=<span style="color: #008000;">"{{ profile.user.username }}"</span> /&gt;
  &lt;<span style="color: #006699;">h4</span>&gt;<span style="text-decoration: underline;">{{ profile.user.username }}</span>&lt;/<span style="color: #006699;">h4</span>&gt;
  &lt;<span style="color: #006699;">p</span>&gt;{{ profile.bio|default:"This user doesn't have a bio for now" }}&lt;/<span style="color: #006699;">p</span>&gt;
  {% if user.username == profile.user.username %}
    &lt;<span style="color: #006699;">a</span>
      <span style="color: #BA36A5;">href</span>=<span style="color: #008000;">"{% url 'settings' %}"</span>
      <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"btn btn-sm btn-outline-secondary action-btn"</span>
    &gt;
      &lt;<span style="color: #006699;">span</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"ion-gear-a"</span>&gt;
        Edit Profile Settings
      &lt;/<span style="color: #006699;">span</span>&gt;
    &lt;/<span style="color: #006699;">a</span>&gt;
  {% else %}                                <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">new </span><span style="color: #8D8D84;">--&gt;</span>
    {% include 'profile_follow.html' %}     <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">new </span><span style="color: #8D8D84;">--&gt;</span>
  {% endif %}
&lt;/<span style="color: #006699;">div</span>&gt;
</pre>
</div>

<p>
In <code>templates/profile_follow.html</code>:
</p>

<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #006699;">form</span>
  <span style="color: #BA36A5;">method</span>=<span style="color: #008000;">"post"</span>
  <span style="color: #BA36A5;">action</span>=<span style="color: #008000;">"{% url 'profile_follow' username=profile.user.username %}"</span>
&gt;
  {% csrf_token %}
  &lt;<span style="color: #006699;">button</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"btn btn-sm action-btn</span>
<span style="color: #008000;">                 {% if is_following %}</span>
<span style="color: #008000;">                 btn-secondary</span>
<span style="color: #008000;">                 {% else %}</span>
<span style="color: #008000;">                 btn-outline-secondary</span>
<span style="color: #008000;">                 {% endif %}"</span>
  &gt;
    &lt;<span style="color: #006699;">span</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"ion-plus-round"</span>&gt;
      {% if is_following %}Unfollow{% else %}Follow{% endif %} {{ profile.user.username }}
    &lt;/<span style="color: #006699;">span</span>&gt;
  &lt;/<span style="color: #006699;">button</span>&gt;
&lt;/<span style="color: #006699;">form</span>&gt;
</pre>
</div>

<p>
What we&rsquo;re doing in this template is the following:
</p>
<ul class="org-ul">
<li>if the user&rsquo;s viewing their own profile, show a link to the <code>settings</code> URL.</li>
<li>if the user&rsquo;s viewing another profile (or is not logged in), redirect them to the <code>profile_follow</code> URL, which toggles a <code>Profile</code> object&rsquo;s <code>follow</code> and <code>unfollow</code> methods</li>
<li>adapt the text and UI based on whether the user&rsquo;s following the viewed profile via a bunch of <code>{% if ...%}</code> template tags.</li>
</ul>
</div>
</div>
<div id="outline-container-org358f718" class="outline-3">
<h3 id="org358f718"><span class="section-number-3">12.4.</span> ArticleDetailView</h3>
<div class="outline-text-3" id="text-12-4">
<p>
We also expose the follow/unfollow feature on article pages.
</p>

<p>
In <code>articles/views.py</code>:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #0000FF;">class</span> <span style="color: #6434A3;">ArticleDetailView</span>(DetailView):
    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">...</span>
    <span style="color: #0000FF;">def</span> <span style="color: #006699;">get_context_data</span>(<span style="color: #0000FF;">self</span>, **kwargs):
        <span style="color: #BA36A5;">context</span> = <span style="color: #006FE0;">super</span>().get_context_data(**kwargs)
        <span style="color: #BA36A5;">context</span>[<span style="color: #008000;">"form"</span>] = CommentCreateView().get_form_class()
        <span style="color: #0000FF;">if</span> <span style="color: #0000FF;">self</span>.request.user.is_authenticated:
            <span style="color: #BA36A5;">context</span>[<span style="color: #008000;">"is_following"</span>] =   <span style="color: #0000FF;">self</span>.request.user.profile.is_following(
                <span style="color: #0000FF;">self</span>.<span style="color: #006FE0;">object</span>.author
            )
        <span style="color: #0000FF;">return</span> context
</pre>
</div>

<p>
In <code>templates/article_detail.html</code>:
</p>

<div class="org-src-container">
<pre class="src src-html">{% if user == article.author.user %}
  &lt;<span style="color: #006699;">span</span>&gt;
    &lt;<span style="color: #006699;">a</span>
      <span style="color: #BA36A5;">href</span>=<span style="color: #008000;">"{% url 'editor_update' slug=article.slug %}"</span>
      <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"btn btn-outline-secondary btn-sm"</span>
    &gt;
      &lt;<span style="color: #006699;">span</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"ion-edit"</span>&gt;
        Edit Article
      &lt;/<span style="color: #006699;">span</span>&gt;
    &lt;/<span style="color: #006699;">a</span>&gt;
    {% include 'article_delete.html' %}
  &lt;/<span style="color: #006699;">span</span>&gt;
{% else %}
  &lt;<span style="color: #006699;">span</span>&gt;
    {% include 'profile_follow.html' with profile=article.author %}
  &lt;/<span style="color: #006699;">span</span>&gt;
{% endif %}
</pre>
</div>

<p>
In <code>templates/profile_follow.html</code>, we add <code>style="display:inline"</code>:
</p>

<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #006699;">form</span>
    <span style="color: #BA36A5;">method</span>=<span style="color: #008000;">"post"</span>
    <span style="color: #BA36A5;">action</span>=<span style="color: #008000;">"{% url 'profile_follow' username=profile.user.username %}"</span>
    <span style="color: #BA36A5;">style</span>=<span style="color: #008000;">"display:inline"</span>
&gt;
<span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">... </span><span style="color: #8D8D84;">--&gt;</span>
</pre>
</div>

<p>
An interesting aside: for the longest time, I tried to follow or unfollow a profile based on whether the template form had <code>method="post"</code> or <code>method="delete"</code> (because <code>RedirectView</code> has both <code>post</code> and <code>delete</code> methods), only to discover that <a href="https://stackoverflow.com/questions/165779/are-the-put-delete-head-etc-methods-available-in-most-web-browsers">HTML forms only support <code>GET</code> and <code>POST</code></a> and that <a href="https://stackoverflow.com/questions/27203547/django-csrf-token-invalid-after-modifying-request">workarounds are not very pretty</a>. Live and learn.
</p>
</div>
</div>
<div id="outline-container-org6625222" class="outline-3">
<h3 id="org6625222"><span class="section-number-3">12.5.</span> Redirect URL</h3>
<div class="outline-text-3" id="text-12-5">
<p>
If you play around with the <code>Follow</code> feature, you will notice that it redirects us to the profile page of the user we want to (un)follow. This is due to the fact that the <code>Follow</code> button is exposed both in <code>profile_detail.html</code> and in <code>home.html</code> (through <code>article_preview.html</code>), so for the sake of simplicity we chose a single redirect URL in our <code>ProfileFollowView</code>.
</p>

<p>
However, it would be better if we could stay on whatever page we are when we follow a user. This involves implementing the <code>next</code> kwarg.
</p>

<p>
In <code>profile_follow.html</code>:
</p>

<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #006699;">form</span>
    <span style="color: #BA36A5;">method</span>=<span style="color: #008000;">"post"</span>
    <span style="color: #BA36A5;">action</span>=<span style="color: #008000;">"{% url 'profile_follow' username=profile.user.username %}"</span>
    <span style="color: #BA36A5;">style</span>=<span style="color: #008000;">"display:inline"</span>
&gt;
    &lt;<span style="color: #006699;">input</span> <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"hidden"</span> <span style="color: #BA36A5;">name</span>=<span style="color: #008000;">"next"</span> <span style="color: #BA36A5;">value</span>=<span style="color: #008000;">"{{ request.path }}"</span>&gt;    <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">new </span><span style="color: #8D8D84;">--&gt;</span>
    {% csrf_token %}
    &lt;<span style="color: #006699;">button</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"btn btn-sm action-btn</span>
<span style="color: #008000;">                   {% if is_following %}</span>
<span style="color: #008000;">                   btn-secondary</span>
<span style="color: #008000;">                   {% else %}</span>
<span style="color: #008000;">                   btn-outline-secondary</span>
<span style="color: #008000;">                   {% endif %}"</span>
    &gt;
        &lt;<span style="color: #006699;">span</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"ion-plus-round"</span>&gt;
            {% if is_following %}Unfollow{% else %}Follow{% endif %} {{ profile.user.username }}
        &lt;/<span style="color: #006699;">span</span>&gt;
    &lt;/<span style="color: #006699;">button</span>&gt;
&lt;/<span style="color: #006699;">form</span>&gt;
</pre>
</div>

<p>
The <code>next</code> parameter above just holds the URL that the <code>profile_follow</code> URL pattern was called from.
</p>

<p>
In <code>ProfileFollowView</code>:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #0000FF;">class</span> <span style="color: #6434A3;">ProfileFollowView</span>(LoginRequiredMixin, RedirectView):
    <span style="color: #0000FF;">def</span> <span style="color: #006699;">get_redirect_url</span>(<span style="color: #0000FF;">self</span>, *args, **kwargs):
        <span style="color: #BA36A5;">url</span> = <span style="color: #0000FF;">self</span>.request.POST.get(<span style="color: #008000;">"next"</span>, <span style="color: #D0372D;">None</span>)
        <span style="color: #0000FF;">if</span> url:
            <span style="color: #0000FF;">return</span> url
        <span style="color: #0000FF;">else</span>:
            <span style="color: #0000FF;">return</span> <span style="color: #006FE0;">super</span>().get_redirect_url(*args, **kwargs)

    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">...</span>
</pre>
</div>

<p>
We override the <code>get_redirect_url</code> method of <code>RedirectView</code> so that we go to the URL specified by <code>next</code>, or fall back to <code>profile_detail</code> if for some reason the <code>next</code> parameter is missing (for example, if the user visits <code>profile_follow</code> directly by typing <code>.../profile/@&lt;username&gt;/follow</code> in their browser&rsquo;s URL bar).
</p>
</div>
</div>
<div id="outline-container-org6e491c4" class="outline-3">
<h3 id="org6e491c4"><span class="section-number-3">12.6.</span> Feeds</h3>
<div class="outline-text-3" id="text-12-6">
<p>
We need to go back all the way to the beginning for this one.
</p>

<p>
In <code>articles/views.py</code>, we need to modify our very first view, <code>home</code>, so that it can give us a feed of articles written by users we follow:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #0000FF;">class</span> <span style="color: #6434A3;">Home</span>(TemplateView):
    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">...</span>
    <span style="color: #0000FF;">def</span> <span style="color: #006699;">get_context_data</span>(<span style="color: #0000FF;">self</span>, **kwargs):
        <span style="color: #BA36A5;">context</span> = <span style="color: #006FE0;">super</span>().get_context_data(**kwargs)
        <span style="color: #BA36A5;">context</span>[<span style="color: #008000;">"global_feed"</span>] = Article.objects.order_by(<span style="color: #008000;">"-created_at"</span>)
        <span style="color: #0000FF;">if</span> <span style="color: #0000FF;">self</span>.request.user.is_authenticated:
            <span style="color: #BA36A5;">context</span>[<span style="color: #008000;">"your_articles"</span>] = Article.objects.<span style="color: #006FE0;">filter</span>(
                author__in=<span style="color: #0000FF;">self</span>.request.user.profile.follows.<span style="color: #006FE0;">all</span>()
            ).order_by(<span style="color: #008000;">"-created_at"</span>)
        <span style="color: #0000FF;">else</span>:
            <span style="color: #BA36A5;">context</span>[<span style="color: #008000;">"your_articles"</span>] = <span style="color: #D0372D;">None</span>
        <span style="color: #0000FF;">return</span> context
</pre>
</div>

<p>
In <code>templates/home.html</code>:
</p>

<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"container page"</span>&gt;
  &lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"row"</span>&gt;
    &lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"col-md-9"</span>&gt;
      &lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"feed-toggle"</span>&gt;
        &lt;<span style="color: #006699;">ul</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"nav nav-pills outline-active"</span>&gt;
          &lt;<span style="color: #006699;">li</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"nav-item"</span>&gt;
            {% url 'home' as home %}
            &lt;<span style="color: #006699;">a</span>
              <span style="color: #BA36A5;">href</span>=<span style="color: #008000;">"{{ home }}"</span>
              <span style="color: #BA36A5;">rel</span>=<span style="color: #008000;">"prefetch"</span>
              <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"nav-link</span>
<span style="color: #008000;">                     {% if request.path == home %}active{% endif %}"</span>
            &gt;
              Global Feed
            &lt;/<span style="color: #006699;">a</span>&gt;
          &lt;/<span style="color: #006699;">li</span>&gt;
          {% if user.is_authenticated %}
            &lt;<span style="color: #006699;">li</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"nav-item"</span>&gt;
              {% url 'home_feed' as home_feed %}
              &lt;<span style="color: #006699;">a</span>
                <span style="color: #BA36A5;">href</span>=<span style="color: #008000;">"{{ home_feed }}"</span>
                <span style="color: #BA36A5;">rel</span>=<span style="color: #008000;">"prefetch"</span>
                <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"nav-link</span>
<span style="color: #008000;">                       {% if request.path == home_feed %}active{% endif %}"</span>
              &gt;
                Your Feed
              &lt;/<span style="color: #006699;">a</span>&gt;
            &lt;/<span style="color: #006699;">li</span>&gt;
          {% else %}
            &lt;<span style="color: #006699;">li</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"nav-item"</span>&gt;
              &lt;<span style="color: #006699;">a</span> <span style="color: #BA36A5;">href</span>=<span style="color: #008000;">"{% url 'login' %}"</span> <span style="color: #BA36A5;">rel</span>=<span style="color: #008000;">"prefetch"</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"nav-link"</span>&gt;
                Sign in to see your Feed
              &lt;/<span style="color: #006699;">a</span>&gt;
            &lt;/<span style="color: #006699;">li</span>&gt;
          {% endif %}
        &lt;/<span style="color: #006699;">ul</span>&gt;
      &lt;/<span style="color: #006699;">div</span>&gt;
      {% if request.path == home %}
        {% include 'article_list.html' with articles=your_articles %}
      {% elif request.path == home_feed %}
        {% include 'article_list.html' with articles=global_feed %}
      {% endif %}
    &lt;/<span style="color: #006699;">div</span>&gt;
  &lt;/<span style="color: #006699;">div</span>&gt;
&lt;/<span style="color: #006699;">div</span>&gt;
</pre>
</div>

<p>
In <code>articles/urls.py</code>:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #BA36A5;">urlpatterns</span> = [
    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">...</span>
    path(<span style="color: #008000;">"feed"</span>, Home.as_view(), name=<span style="color: #008000;">"home_feed"</span>),
]
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgd54add1" class="outline-2">
<h2 id="orgd54add1"><span class="section-number-2">13.</span> Favourites</h2>
<div class="outline-text-2" id="text-13">
</div>
<div id="outline-container-orgcea6123" class="outline-3">
<h3 id="orgcea6123"><span class="section-number-3">13.1.</span> Model</h3>
<div class="outline-text-3" id="text-13-1">
<p>
The second to last feature we need is allowing users to favourite some articles, so that they are added to the user&rsquo;s profile for everyone to see.
</p>

<p>
In <code>users/models.py</code>:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #0000FF;">class</span> <span style="color: #6434A3;">Profile</span>(models.Model):
    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">...</span>
    <span style="color: #BA36A5;">favorites</span> = models.ManyToManyField(
        <span style="color: #008000;">"articles.Article"</span>, related_name=<span style="color: #008000;">"favorited"</span>, blank=<span style="color: #D0372D;">True</span>
    )
    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">...</span>
    <span style="color: #0000FF;">def</span> <span style="color: #006699;">favorite</span>(<span style="color: #0000FF;">self</span>, article):
        <span style="color: #036A07;">"""Add article to Favorites"""</span>
        <span style="color: #0000FF;">self</span>.favorites.add(article)

    <span style="color: #0000FF;">def</span> <span style="color: #006699;">unfavorite</span>(<span style="color: #0000FF;">self</span>, article):
        <span style="color: #036A07;">"""Remove article from Favorites"""</span>
        <span style="color: #0000FF;">self</span>.favorites.remove(article)

    <span style="color: #0000FF;">def</span> <span style="color: #006699;">has_favorited</span>(<span style="color: #0000FF;">self</span>, article):
        <span style="color: #036A07;">"""Return True if article is in Favorites, False otherwise"""</span>
        <span style="color: #0000FF;">return</span> <span style="color: #0000FF;">self</span>.favorites.<span style="color: #006FE0;">filter</span>(pk=article.pk).exists()
</pre>
</div>
</div>
</div>
<div id="outline-container-org52f9b5d" class="outline-3">
<h3 id="org52f9b5d"><span class="section-number-3">13.2.</span> ArticleFavoriteView</h3>
<div class="outline-text-3" id="text-13-2">
<p>
In <code>articles/views.py</code>:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #0000FF;">from</span> django.views.generic <span style="color: #0000FF;">import</span> (
    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">...</span>
    RedirectView
)

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">...</span>
<span style="color: #0000FF;">class</span> <span style="color: #6434A3;">ArticleFavoriteView</span>(RedirectView):
    <span style="color: #BA36A5;">pattern_name</span> = <span style="color: #008000;">"article_detail"</span>

    <span style="color: #0000FF;">def</span> <span style="color: #006699;">get_redirect_url</span>(<span style="color: #0000FF;">self</span>, *args, **kwargs):
        <span style="color: #BA36A5;">url</span> = <span style="color: #0000FF;">self</span>.request.POST.get(<span style="color: #008000;">"next"</span>, <span style="color: #D0372D;">None</span>)
        <span style="color: #0000FF;">if</span> url:
            <span style="color: #0000FF;">return</span> url
        <span style="color: #0000FF;">else</span>:
            <span style="color: #0000FF;">return</span> <span style="color: #006FE0;">super</span>().get_redirect_url(*args, **kwargs)

    <span style="color: #0000FF;">def</span> <span style="color: #006699;">post</span>(<span style="color: #0000FF;">self</span>, request, *args, **kwargs):
        <span style="color: #BA36A5;">slug</span> = <span style="color: #0000FF;">self</span>.kwargs.get(<span style="color: #008000;">"slug"</span>, <span style="color: #D0372D;">None</span>)
        <span style="color: #BA36A5;">article</span> = get_object_or_404(Article, slug=slug)
        <span style="color: #0000FF;">if</span> request.user.profile.has_favorited(article):
            request.user.profile.unfavorite(article)
        <span style="color: #0000FF;">else</span>:
            request.user.profile.favorite(article)
        <span style="color: #0000FF;">return</span> <span style="color: #006FE0;">super</span>().post(request, *args, **kwargs)
</pre>
</div>

<p>
In <code>articles/urls.py</code>:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">...</span>
<span style="color: #0000FF;">from</span> django.shortcuts <span style="color: #0000FF;">import</span> redirect, get_object_or_404
<span style="color: #0000FF;">from</span> .views <span style="color: #0000FF;">import</span> (
    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">...</span>
    ArticleFavoriteView
)

<span style="color: #BA36A5;">urlpatterns</span> = [
    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">...</span>
    path(
        <span style="color: #008000;">"article/&lt;slug:slug&gt;/favorite"</span>,
        ArticleFavoriteView.as_view(),
        name=<span style="color: #008000;">"article_favorite"</span>,
    ),
]
</pre>
</div>
</div>
</div>
<div id="outline-container-org301fa03" class="outline-3">
<h3 id="org301fa03"><span class="section-number-3">13.3.</span> ArticleDetailView</h3>
<div class="outline-text-3" id="text-13-3">
<p>
We don&rsquo;t need to modify the views for this: the logic can happen in the templates.
</p>

<p>
In <code>templates/article_detail.html</code>:
</p>

<div class="org-src-container">
<pre class="src src-html">{% if user == article.author.user %}
  &lt;<span style="color: #006699;">span</span>&gt;
    &lt;<span style="color: #006699;">a</span>
      <span style="color: #BA36A5;">href</span>=<span style="color: #008000;">"{% url 'editor_update' slug=article.slug %}"</span>
      <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"btn btn-outline-secondary btn-sm"</span>
    &gt;
      &lt;<span style="color: #006699;">span</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"ion-edit"</span>&gt;
        Edit Article
      &lt;/<span style="color: #006699;">span</span>&gt;
    &lt;/<span style="color: #006699;">a</span>&gt;
    {% include 'article_delete.html' %}
  &lt;/<span style="color: #006699;">span</span>&gt;
{% else %}
  &lt;<span style="color: #006699;">span</span>&gt;
    {% include 'profile_follow.html' with profile=article.author %}
    {% include 'article_favorite.html' %}           <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">new </span><span style="color: #8D8D84;">--&gt;</span>
  &lt;/<span style="color: #006699;">span</span>&gt;
{% endif %}
</pre>
</div>

<p>
In <code>templates/article_favorite.html</code>:
</p>

<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #006699;">form</span>
    <span style="color: #BA36A5;">method</span>=<span style="color: #008000;">"post"</span>
    <span style="color: #BA36A5;">action</span>=<span style="color: #008000;">"{% url 'article_favorite' slug=article.slug %}"</span>
    <span style="color: #BA36A5;">style</span>=<span style="color: #008000;">"display:inline"</span>
&gt;
  &lt;<span style="color: #006699;">input</span> <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"hidden"</span> <span style="color: #BA36A5;">name</span>=<span style="color: #008000;">"next"</span> <span style="color: #BA36A5;">value</span>=<span style="color: #008000;">"{{ request.path }}"</span>&gt;
  {% csrf_token %}
  &lt;<span style="color: #006699;">button</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"btn btn-sm action-btn</span>
<span style="color: #008000;">                 {% if article in user.profile.favorites.all %}</span>
<span style="color: #008000;">                 btn-primary</span>
<span style="color: #008000;">                 {% else %}</span>
<span style="color: #008000;">                 btn-outline-primary</span>
<span style="color: #008000;">                 {% endif %}"</span>
  &gt;
    &lt;<span style="color: #006699;">span</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"ion-heart"</span>&gt;
      {% if article in user.profile.favorites.all %}
        Unfavorite
      {% else %}
        Favorite
      {% endif %} Article ({{ article.favorited_by.count }})
    &lt;/<span style="color: #006699;">span</span>&gt;
  &lt;/<span style="color: #006699;">button</span>&gt;
&lt;/<span style="color: #006699;">form</span>&gt;
</pre>
</div>

<p>
Checking if an article is in a user&rsquo;s <code>favorites</code> should be done in the view (or, even better, the model) instead of the template, but we would have to change our templates&rsquo; structure and write new views if we wanted to include a <code>Favorite</code> button in the <code>article_preview.html</code> template.
</p>
</div>
</div>
<div id="outline-container-orgbaec4bd" class="outline-3">
<h3 id="orgbaec4bd"><span class="section-number-3">13.4.</span> ArticlePreviewView</h3>
<div class="outline-text-3" id="text-13-4">
<p>
In <code>templates/article_preview.html</code>:
</p>

<div class="org-src-container">
<pre class="src src-html">            &lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"info"</span>&gt;
                &lt;<span style="color: #006699;">a</span> <span style="color: #BA36A5;">href</span>=<span style="color: #008000;">"{% url 'profile_detail' username=article.author.user.username %}"</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"author"</span>&gt;
                    {{ article.author.user.username }}
                &lt;/<span style="color: #006699;">a</span>&gt;
                &lt;<span style="color: #006699;">span</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"date"</span>&gt;
                    {{ article.created_at|date:"D M d Y" }}
                &lt;/<span style="color: #006699;">span</span>&gt;
            &lt;/<span style="color: #006699;">div</span>&gt;
            &lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"pull-xs-right"</span>&gt;                 <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">new </span><span style="color: #8D8D84;">--&gt;</span>
                {% include 'article_favorite.html' %}   <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">new </span><span style="color: #8D8D84;">--&gt;</span>
            &lt;/<span style="color: #006699;">div</span>&gt;                                      <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">new </span><span style="color: #8D8D84;">--&gt;</span>
</pre>
</div>

<p>
In <code>templates/article_favorite.html</code>
</p>

<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #006699;">form</span>
    <span style="color: #BA36A5;">method</span>=<span style="color: #008000;">"post"</span>
    <span style="color: #BA36A5;">action</span>=<span style="color: #008000;">"{% url 'article_favorite' slug=article.slug %}"</span>
    <span style="color: #BA36A5;">style</span>=<span style="color: #008000;">"display:inline"</span>
&gt;
  &lt;<span style="color: #006699;">input</span> <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"hidden"</span> <span style="color: #BA36A5;">name</span>=<span style="color: #008000;">"next"</span> <span style="color: #BA36A5;">value</span>=<span style="color: #008000;">"{{ request.path }}"</span>&gt;
  {% csrf_token %}
  &lt;<span style="color: #006699;">button</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"btn btn-sm action-btn</span>
<span style="color: #008000;">                 {% if article in user.profile.favorites.all %}</span>
<span style="color: #008000;">                 btn-primary</span>
<span style="color: #008000;">                 {% else %}</span>
<span style="color: #008000;">                 btn-outline-primary</span>
<span style="color: #008000;">                 {% endif %}"</span>
  &gt;
    &lt;<span style="color: #006699;">span</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"ion-heart"</span>&gt;
      {% if request.path|truncatechars:7 == 'article' %}  <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">new </span><span style="color: #8D8D84;">--&gt;</span>
        {% if article in user.profile.favorites.all %}
          Unfavorite
        {% else %}
          Favorite
        {% endif %} Article ({{ article.favorited_by.count }})
      {% else  %}                                         <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">new </span><span style="color: #8D8D84;">--&gt;</span>
        {{ article.favorited_by.count }}                  <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">new </span><span style="color: #8D8D84;">--&gt;</span>
      {% endif %}                                         <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">new </span><span style="color: #8D8D84;">--&gt;</span>
    &lt;/<span style="color: #006699;">span</span>&gt;
  &lt;/<span style="color: #006699;">button</span>&gt;
&lt;/<span style="color: #006699;">form</span>&gt;
</pre>
</div>


<div id="org0f7a21f" class="figure">
<p><img src="./assets/home - favorite - before.png" alt="home - favorite - before.png" width="600" />
</p>
<p><span class="figure-number">Figure 10: </span>favorite - before</p>
</div>

<div id="orgbbd2b83" class="figure">
<p><img src="./assets/home - favorite.png" alt="home - favorite.png" width="600" />
</p>
<p><span class="figure-number">Figure 11: </span>favorite - after</p>
</div>
</div>
</div>
<div id="outline-container-org77f29ed" class="outline-3">
<h3 id="org77f29ed"><span class="section-number-3">13.5.</span> Feeds</h3>
<div class="outline-text-3" id="text-13-5">
<p>
Now, we need to do something with this <code>Favorite</code> feature: we&rsquo;ll display a user&rsquo;s favorited articles on their profile.
</p>

<p>
In <code>users/views.py</code>:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #0000FF;">class</span> <span style="color: #6434A3;">ProfileDetailView</span>(DetailView):
    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">...</span>

    <span style="color: #0000FF;">def</span> <span style="color: #006699;">get_context_data</span>(<span style="color: #0000FF;">self</span>, **kwargs):
        <span style="color: #BA36A5;">context</span> = <span style="color: #006FE0;">super</span>().get_context_data(**kwargs)
        <span style="color: #0000FF;">if</span> <span style="color: #0000FF;">self</span>.request.user.is_authenticated:
            <span style="color: #BA36A5;">context</span>[<span style="color: #008000;">"my_articles"</span>] = <span style="color: #0000FF;">self</span>.<span style="color: #006FE0;">object</span>.articles.order_by(<span style="color: #008000;">"-created_at"</span>)
            <span style="color: #BA36A5;">context</span>[<span style="color: #008000;">"is_following"</span>] = <span style="color: #0000FF;">self</span>.<span style="color: #006FE0;">object</span>.is_following(<span style="color: #0000FF;">self</span>.<span style="color: #006FE0;">object</span>)
            <span style="color: #BA36A5;">context</span>[<span style="color: #008000;">"favorited_articles"</span>] = <span style="color: #0000FF;">self</span>.<span style="color: #006FE0;">object</span>.favorites.order_by(         <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">new</span>
                <span style="color: #008000;">"-created_at"</span>                       <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">new</span>
            )                                       <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">new</span>
        <span style="color: #0000FF;">return</span> context
</pre>
</div>

<p>
In <code>users/urls.py</code>:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #BA36A5;">urlpatterns</span> = [
    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">...</span>
    path(
        <span style="color: #008000;">"profile/@&lt;str:username&gt;/favorites"</span>,
        ProfileDetailView.as_view(),
        name=<span style="color: #008000;">"profile_favorites"</span>,
    ),
]
</pre>
</div>

<p>
In <code>templates/profile_detail.html</code>:
</p>

<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"container"</span>&gt;
  &lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"row"</span>&gt;
    &lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"col-xs-12 col-md-10 offset-md-1"</span>&gt;
      &lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"articles-toggle"</span>&gt;
        &lt;<span style="color: #006699;">ul</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"nav nav-pills outline-active"</span>&gt;
          &lt;<span style="color: #006699;">li</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"nav-item"</span>&gt;
            {% url 'profile_detail' username=profile.user.username as profile_detail %}
            &lt;<span style="color: #006699;">a</span>
              <span style="color: #BA36A5;">href</span>=<span style="color: #008000;">"{{ profile_detail }}"</span>
              <span style="color: #BA36A5;">rel</span>=<span style="color: #008000;">"prefetch"</span>
              <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"nav-link</span>
<span style="color: #008000;">                     {% if request.path == profile_detail %}active{% endif %}"</span>
            &gt;
              My Articles
            &lt;/<span style="color: #006699;">a</span>&gt;
          &lt;/<span style="color: #006699;">li</span>&gt;
          &lt;<span style="color: #006699;">li</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"nav-item"</span>&gt;
            {% url 'profile_favorites' username=profile.user.username as profile_favorites %}
            &lt;<span style="color: #006699;">a</span>
              <span style="color: #BA36A5;">href</span>=<span style="color: #008000;">"{{ profile_favorites }}"</span>
              <span style="color: #BA36A5;">rel</span>=<span style="color: #008000;">"prefetch"</span>
              <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"nav-link</span>
<span style="color: #008000;">                     {% if request.path == profile_favorites %}active{% endif %}"</span>
            &gt;
              Favorited Articles
            &lt;/<span style="color: #006699;">a</span>&gt;
          &lt;/<span style="color: #006699;">li</span>&gt;
        &lt;/<span style="color: #006699;">ul</span>&gt;
      &lt;/<span style="color: #006699;">div</span>&gt;
      {% if request.path == profile_detail %}
        {% include 'article_list.html' with articles=my_articles %}
      {% elif request.path == profile_favorites %}
        {% include 'article_list.html' with articles=favorited_articles %}
      {% endif %}
    &lt;/<span style="color: #006699;">div</span>&gt;
  &lt;/<span style="color: #006699;">div</span>&gt;
&lt;/<span style="color: #006699;">div</span>&gt;
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org6fe587b" class="outline-2">
<h2 id="org6fe587b"><span class="section-number-2">14.</span> Tags</h2>
<div class="outline-text-2" id="text-14">
</div>
<div id="outline-container-orgfd2e22a" class="outline-3">
<h3 id="orgfd2e22a"><span class="section-number-3">14.1.</span> Model</h3>
<div class="outline-text-3" id="text-14-1">
<p>
The very last feature that we need to implement is tags.
</p>

<p>
First, we create the <code>Tag</code> object itself.
</p>

<p>
In <code>articles/models.py</code>:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #0000FF;">class</span> <span style="color: #6434A3;">Tag</span>(models.Model):
    <span style="color: #BA36A5;">tag</span> = models.CharField(max_length=<span style="color: #D0372D;">100</span>)
    <span style="color: #BA36A5;">slug</span> = models.SlugField(unique=<span style="color: #D0372D;">True</span>)

    <span style="color: #0000FF;">def</span> <span style="color: #006699;">__str__</span>(<span style="color: #0000FF;">self</span>):
        <span style="color: #0000FF;">return</span> <span style="color: #0000FF;">self</span>.tag
</pre>
</div>

<p>
The <code>tag</code> field will contain the tag itself, while <code>slug</code> is just a way for us to retrieve it more easily.
</p>

<p>
Now, we need a way to assign tags to an article: we can achieve this by  wadding a <code>ForeignKey</code> to the <code>Article</code> model. In <code>articles/models.py</code>:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">...</span>
<span style="color: #0000FF;">from</span> django.utils.text <span style="color: #0000FF;">import</span> slugify

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">...</span>
<span style="color: #0000FF;">class</span> <span style="color: #6434A3;">Article</span>(models.Model):
    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">...</span>
    <span style="color: #BA36A5;">tags</span> = models.ManyToManyField(<span style="color: #008000;">"articles.Tag"</span>, related_name= <span style="color: #008000;">"articles"</span>, blank=<span style="color: #D0372D;">True</span>)

    <span style="color: #0000FF;">def</span> <span style="color: #006699;">add_tag</span>(<span style="color: #0000FF;">self</span>, tag):
        <span style="color: #BA36A5;">slug</span> = slugify(tag)
        <span style="color: #BA36A5;">tag_object</span>, <span style="color: #BA36A5;">created</span> = Tag.objects.get_or_create(tag=tag, slug=slug)
        <span style="color: #0000FF;">self</span>.tags.add(tag_object)

    <span style="color: #0000FF;">def</span> <span style="color: #006699;">remove_tag</span>(<span style="color: #0000FF;">self</span>, tag):
        <span style="color: #BA36A5;">tag_object</span> = Tag.objects.get(tag=tag)
        <span style="color: #0000FF;">self</span>.tags.remove(tag_object)

    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">...</span>
</pre>
</div>

<p>
We have modified the models: we need to <code>makemigrations</code> and <code>migrate</code>.
</p>
</div>
</div>
<div id="outline-container-org6ecff5d" class="outline-3">
<h3 id="org6ecff5d"><span class="section-number-3">14.2.</span> Views</h3>
<div class="outline-text-3" id="text-14-2">
<p>
We will now enable users to specify the tags for their article in the editor.
</p>

<p>
In <code>articles/views.py</code>:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #0000FF;">class</span> <span style="color: #6434A3;">EditorCreateView</span>(LoginRequiredMixin, CreateView):
    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">...</span>
    <span style="color: #BA36A5;">fields</span> = [<span style="color: #008000;">"title"</span>, <span style="color: #008000;">"description"</span>, <span style="color: #008000;">"body"</span>, <span style="color: #008000;">"tags"</span>]


<span style="color: #0000FF;">class</span> <span style="color: #6434A3;">EditorUpdateView</span>(LoginRequiredMixin, UpdateView):
    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">...</span>
    <span style="color: #BA36A5;">fields</span> = [<span style="color: #008000;">"title"</span>, <span style="color: #008000;">"description"</span>, <span style="color: #008000;">"body"</span>, <span style="color: #008000;">"tags"</span>]
</pre>
</div>

<p>
Now, we want to be able to add and remove tags straight in the editor, like in the following video:
</p>

<p width="600">
<a href="./assets/editor - tags.mp4" width="600">./assets/editor - tags.mp4</a>
</p>

<p>
We&rsquo;ll have to do a bit of a hack here, to achieve this kind of functionality: we&rsquo;ll include a separate form for tags into the editor form, and this form will update the page whenever a tag is added or removed.
</p>

<p>
We create <code>templates/article_tags.html</code>:
</p>

<div class="org-src-container">
<pre class="src src-html">
</pre>
</div>

<p>
We include this new template into <code>templates/editor.html</code>:
</p>

<div class="org-src-container">
<pre class="src src-html"><span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">... </span><span style="color: #8D8D84;">--&gt;</span>
&lt;<span style="color: #006699;">fieldset</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"form-group"</span>&gt;
  &lt;<span style="color: #006699;">textarea</span>
    <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"form-control"</span>
    <span style="color: #BA36A5;">rows</span>=<span style="color: #008000;">"8"</span>
    <span style="color: #BA36A5;">placeholder</span>=<span style="color: #008000;">"Write your article (in markdown)"</span>
    <span style="color: #BA36A5;">name</span>=<span style="color: #008000;">"{{ form.body.name }}"</span>
  &gt;{{ form.body.value|default_if_none:'' }}&lt;/<span style="color: #006699;">textarea</span>&gt;
&lt;/<span style="color: #006699;">fieldset</span>&gt;
{{ form.body.errors }}
{% include 'article_tag.html' with article_slug=article.slug %} <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">new </span><span style="color: #8D8D84;">--&gt;</span>
&lt;<span style="color: #006699;">button</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"btn btn-lg pull-xs-right btn-primary"</span>&gt;
  Publish Article
&lt;/<span style="color: #006699;">button</span>&gt;
<span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">... </span><span style="color: #8D8D84;">--&gt;</span>
</pre>
</div>

<p>
In <code>articles/views.py</code>:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">...</span>
<span style="color: #0000FF;">from</span> .models <span style="color: #0000FF;">import</span> Article, Comment, Tag

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">...</span>
</pre>
</div>

<p>
In <code>articles/urls.py</code>:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">...</span>
<span style="color: #0000FF;">from</span> .views <span style="color: #0000FF;">import</span> (
    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">...</span>
    TagAddView,
    TagDeleteView
)

<span style="color: #BA36A5;">urlpatterns</span> = [
    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">...</span>
    path(
        <span style="color: #008000;">"article/&lt;slug:article_slug&gt;/tag"</span>,
        ArticleTagView.as_view(),
        name=<span style="color: #008000;">"article_tag"</span>,
    ),
    path(
        <span style="color: #008000;">"article/&lt;slug:article_slug&gt;/tag/&lt;slug:tag_slug&gt;/delete"</span>,
        TagDeleteView.as_view(),
        name=<span style="color: #008000;">"tag_delete"</span>,
    ),
]
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Created: 2022-01-17 Mon 09:03</p>
</div>
</body>
</html>
